{"componentChunkName":"component---src-templates-blog-post-js","path":"/en/blog/2020/2020-01-16-Kubernetes_my_personal_cheat_sheet/","result":{"data":{"site":{"siteMetadata":{"title":null,"siteUrl":"https://vcrmartinez.com","social":{"twitter":"vcrmartinez","github":"victormartinez","linkedin":"vcrmartinez","speakerdeck":"victormartinez"}}},"markdownRemark":{"id":"732aa501-b3f7-52cd-a3ab-580b394ae053","excerpt":"If your infrastructure is comprised of a Kubernetes cluster you probably have a set of commands at hand for common tasks. Google doc provides a handy Cheat…","html":"<p>If your infrastructure is comprised of a Kubernetes cluster you probably have a set of commands at hand for common tasks. Google doc provides a handy <a href=\"https://kubernetes.io/docs/reference/kubectl/cheatsheet/\">Cheat Sheet</a> that you should have a look. However, in this post I will share some commands that I use/have used.</p>\n<h2>Gcloud Commands</h2>\n<ul>\n<li>Get credentials: <code class=\"language-text\">gcloud container clusters get-credentials &lt;CLUSTER-NAME&gt; --zone &lt;ZONE&gt; --project &lt;PROJECT-ID&gt;</code></li>\n<li>Get images you have uploaded: <code class=\"language-text\">gcloud container images list-tags gcr.io/&lt;project-id&gt;/&lt;image-name&gt; [--limit &lt;N&gt;]</code></li>\n<li>Get the last image on your registry: <code class=\"language-text\">gcloud container images list-tags gcr.io/&lt;project-id&gt;/&lt;image-name&gt; --limit 1 | tail -1 | awk &#39;{print $2}&#39;</code></li>\n</ul>\n<h2>Basic commands</h2>\n<ul>\n<li>Check the current cluster context (better to use <a href=\"https://github.com/ahmetb/kubectx/\">kubectx</a>): <code class=\"language-text\">kubectl config current-context</code></li>\n<li>Did you start any job? Better to check: <code class=\"language-text\">kubectl get jobs,pods [-n &lt;NAMESPACE&gt; | --all-namespaces | -o wide]</code></li>\n<li>How many nodes in the cluster? <code class=\"language-text\">kubectl get nodes [-o wide]</code></li>\n<li>Get resources: <code class=\"language-text\">kubectl get all,svc,deploy,configmaps,secrets,ingress,hpa [-n &lt;NAMESPACE&gt; | --all-namespaces]</code></li>\n<li>What namespaces does your cluster have? <code class=\"language-text\">kubectl get namespaces</code></li>\n<li>Export a deployment (useful to debug the yaml): <code class=\"language-text\">kubectl get deploy &lt;NAME&gt; -o yaml --export</code></li>\n<li>Get your Ingress managed certificate: <code class=\"language-text\">kubectl describe managedcertificate [-n &lt;NAMESPACE&gt;]</code></li>\n<li>Port forward: <code class=\"language-text\">kubectl port-forward [-n &lt;NAMESPACE&gt;] svc/&lt;SERVICE-NAME&gt; &lt;LOCAL-PORT&gt;:&lt;REMOTE-PORT&gt;</code></li>\n<li>Suspend CronJob: <code class=\"language-text\">kubectl patch cronjobs &lt;cronjob-name&gt; -p &#39;{&quot;spec&quot; : {&quot;suspend&quot; : true }}&#39; [-n &lt;NAMESPACE&gt;]</code></li>\n<li>Create a job from Cronjob: <code class=\"language-text\">kubectl create job --from=cronjob/&lt;YOUR-CRONJOB-NAME&gt; &lt;GIVE-A-NAME&gt;</code></li>\n</ul>\n<p><em>Hint:</em> prefix your commands with <code class=\"language-text\">watch</code> to keep an eye on the output. For instance, if you have deployed a new image, check the progress by running <code class=\"language-text\">watch kubectl get pods [-n namespace]</code>.</p>\n<h2>Deploy</h2>\n<ul>\n<li>Check all deployments: <code class=\"language-text\">kubectl get deployments --all-namespaces</code></li>\n<li>Creating or deleting a deploy is quite easy: <code class=\"language-text\">kubectl [apply|delete] -f &lt;FOLDER-OR-FILE&gt;</code></li>\n<li>Scaling it as well: <code class=\"language-text\">kubectl scale deploy &lt;DEPLOY-NAME&gt; [-n &lt;NAMESPACE&gt;] --replicas=&lt;N&gt;</code></li>\n<li>Rollback a deployment: <code class=\"language-text\">kubectl rollout undo deployment/&lt;DEPLOY-NAME&gt; [-n &lt;NAMESPACE&gt;]</code></li>\n<li>Delete evicted pods: <code class=\"language-text\">kubectl [-n &lt;NAMESPACE&gt;] delete pods --field-selector=status.phase=Failed</code></li>\n<li>Delete all pods: <code class=\"language-text\">kubectl delete --all pods [-n &lt;NAMESPACE&gt;]</code></li>\n<li>Restart pods: <code class=\"language-text\">kubectl rollout restart deployment &lt;DEPLOY-NAME&gt; [-n &lt;NAMESPACE&gt;]</code></li>\n</ul>\n<p><em>Hints:</em></p>\n<ol>\n<li><del>Never use</del> Avoid to use <code class=\"language-text\">scale deploy</code> command because you will end up differing from the yaml files and it will be a mess to determine the diff between the cluster and the yaml files. It is OK to use it in an emergency scenario but remember to update the deploy or the HPA file(s). In a normal scenario, keep your yamls updated and apply them to change the cluster state.</li>\n<li>Setting <code class=\"language-text\">--replicas=0</code> is a nice way to stop the service for a period of time since you do not delete the deployment (but consider the advice previously).</li>\n</ol>\n<h2>Troubleshooting</h2>\n<ul>\n<li>Get an overview of the deployment: <code class=\"language-text\">kubectl describe deploy &lt;DEPLOY-NAME&gt; [-n &lt;NAMESPACE&gt;]</code></li>\n<li>Get an overview of the pod: <code class=\"language-text\">kubectl describe pod &lt;POD-NAME&gt; [-n &lt;NAMESPACE&gt;]</code></li>\n<li>Check logs: <code class=\"language-text\">kubectl logs -f &lt;POD-NAME&gt; [-n &lt;NAMESPACE&gt;] [--tail=&lt;N&gt;]</code></li>\n<li>Check logs of a previous container: <code class=\"language-text\">kubectl logs &lt;POD-NAME&gt; -c &lt;CONTAINER-NAME&gt; --previous</code></li>\n<li>Check logs of all containers matching a label: <code class=\"language-text\">kubectl logs -f -l &lt;KEY&gt;=&lt;VALUE&gt; --all-containers</code></li>\n<li>Get an interactive shell: <code class=\"language-text\">kubectl exec -it &lt;POD-NAME&gt; [-n &lt;NAMESPACE&gt;] -- /bin/bash</code></li>\n<li>Get memory and cpu stats of your:\n** Nodes: <code class=\"language-text\">kubectl top nodes</code>\n** Node: <code class=\"language-text\">kubectl top node &lt;NODE-NAME&gt;</code>\n** Pod: <code class=\"language-text\">kubectl top pod &lt;POD-NAME&gt; [-n &lt;NAMESPACE&gt;]</code></li>\n</ul>\n<h2>Scheduling / Migration</h2>\n<ul>\n<li>Mark a node unschedulable: <code class=\"language-text\">kubectl cordon &lt;NODE-NAME&gt;</code></li>\n<li>Mark a node schedulable: <code class=\"language-text\">kubectl uncordon &lt;NODE-NAME&gt;</code></li>\n</ul>\n<h2>Helm</h2>\n<ul>\n<li>Solve error due to incompatible versions client: <code class=\"language-text\">helm init --upgrade</code></li>\n<li>List helm deployments: <code class=\"language-text\">helm ls</code></li>\n<li>Delete a helm deploy: <code class=\"language-text\">helm delete &lt;NAME&gt; --purge</code></li>\n<li>Install a chart: <code class=\"language-text\">helm install &lt;CHART-NAME&gt; --name &lt;YOUR-DEPLOY-NAME&gt; -f &lt;YAML-FILE&gt; [--namespace &lt;NAMESPACE&gt;]</code></li>\n<li>Update a chart: <code class=\"language-text\">helm upgrade &lt;NAME&gt; &lt;CHART&gt; -f &lt;YAML-FILE&gt;</code></li>\n</ul>\n<p>That’s all folks. As I use more commands I update this post.</p>","frontmatter":{"title":"Kubernetes: my personal cheat sheet","date":"2020-01-16T00:00:00","description":null,"tags":["kubernetes","devops","cheat","sheet","commands","k8s"],"rating":null,"image_url":null,"image_author":null,"image":{"publicURL":"/static/3e9278fbf345d1c50bb5a0aff63f85bc/featured.png"}},"fields":{"slug":"/2020/2020-01-16-Kubernetes_my_personal_cheat_sheet/"},"timeToRead":4}},"pageContext":{"id":"732aa501-b3f7-52cd-a3ab-580b394ae053","language":"en","intl":{"language":"en","languages":["en","pt"],"messages":{"of":"of","or":"or","Next":"Next","Previous":"Previous","reading":"reading","Comments":"Comments","Featured_image_credits":"Featured image credits","Not_Found":"Not Found","Not_Found_Text":"The page you are looking for might have been removed, had its name changed or is temporarily unavailable.","Not_Found_Nav":"You can go to","Warning_deprecated":"Attention: this post was written some time ago and may not be valid anymore, ok?"},"routed":true,"originalPath":"/blog/2020/2020-01-16-Kubernetes_my_personal_cheat_sheet/","redirect":true,"defaultLanguage":"en"}}},"staticQueryHashes":["4061151221"]}