<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Untitled RSS Feed]]></title><description><![CDATA[Untitled RSS Feed]]></description><link>https://vcrmartinez.com</link><generator>GatsbyJS</generator><lastBuildDate>Fri, 21 Jan 2022 01:31:28 GMT</lastBuildDate><item><title><![CDATA[Dados geolocalizados com Redis]]></title><description><![CDATA[TL;DR; Vamos usar o Redis para armazenar dados geolocalizados. Quando falamos em Redis invariavelmente pensamos em cache. Por√©m ele evoluiu‚Ä¶]]></description><link>https://vcrmartinez.com/2022/2022-01-20-Dados_geolocalizados_com_Redis/</link><guid isPermaLink="false">https://vcrmartinez.com/2022/2022-01-20-Dados_geolocalizados_com_Redis/</guid><pubDate>Thu, 20 Jan 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;TL;DR;&lt;/em&gt; Vamos usar o Redis para armazenar dados geolocalizados.&lt;/p&gt;
&lt;p&gt;Quando falamos em Redis invariavelmente pensamos em cache. Por√©m ele evoluiu e hoje √© considerado um servidor que armazena diferentes estruturas de dados (hashes, sets, lists, etc).&lt;/p&gt;
&lt;p&gt;No post de hoje vamos sair do uso comum e entender de que forma o Redis nos ajuda com quando precisamos trabalhar dados geolocalizados (para mais info, vide &lt;a href=&quot;https://redis.io/commands#geo&quot;&gt;documenta√ß√£o&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Configura√ß√£o do ambiente&lt;/h2&gt;
&lt;p&gt;Para replicar os comandos voc√™ vai precisar configurar um ambiente local. Estou usando o &lt;a href=&quot;https://www.docker.com/&quot;&gt;docker&lt;/a&gt; e o &lt;a href=&quot;https://redis.io/topics/rediscli&quot;&gt;redis-cli&lt;/a&gt;. O CLI vem com a instala√ß√£o do Redis mas eu gosto de t√™-lo separado (veja este &lt;a href=&quot;https://codewithhugo.com/install-just-redis-cli-on-ubuntu-debian-jessie/&quot;&gt;tutorial&lt;/a&gt;). Ent√£o, basta executar os comandos abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ docker run --name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;my-redis --rm -p &lt;span class=&quot;token string&quot;&gt;&quot;6379:6379&quot;&lt;/span&gt; redis:6 redis-server
$ redis-cli

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Estrutura de Dados&lt;/h2&gt;
&lt;p&gt;Armazenar qualquer coisa no Redis requer a utiliza√ß√£o de √≠ndices. De forma simples, √© uma chave &lt;em&gt;string&lt;/em&gt; que aponta para alguma estrutura de dados. Para lidar com dados geolocalizados o Redis utiliza a estrutura de &lt;em&gt;sorted set&lt;/em&gt; (conjunto ordenado) de forma que cada ponto (lat/long) √© rotulado com uma &lt;strong&gt;string&lt;/strong&gt;. A imagem abaixo ilustra de forma simplificada essa arquitetura:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB70lEQVQoz42TTU9TQRSG+w/cGhM3JibuWPpvgKSCgQU2bmzA+B/cQP1gQSQY1GBitLoxSixIrU0wUQkItKKUaL8ohd47d+bexzO3vaUmRDzJuedjZt77znsysfxInNcXzpG53Mfzs2eob6xjAOW6KKXwPK8bo9zXNlf83j9CS89o2/dotVrEivNzvOq7RPriefKJUXTzgNB8H4Lg2MXaX2iqgMm3P0nMb3A/U8LV7RVHSMTkGDtfPrP5bpFK4wAdRMf+tkD6vt9em10sMHhvlcTcVwYkPs7thf2W4wigMThCW9s/CGVfa3S5jCqVuq6r1S7wkfKZeJBnKLXM6HSOuMSJJ2toYaaUMLSbrA6BMe2bCmhx7BrbV4bYHb/Jdv8AhRtJqgK6X6uw8ukbyZk8w3eWGZn+QHwyw/XZVSqHGiO6hoBWbN9qZgElb2YyVNNpvi8sUEu/pLmSxRg/VLHccBif+chwaomrd98Tn1oi+WiNQ2HuRQx7ASMFbdUQTaI66Fm7/WKdwVSWMWHaP5Ul9WanPRTnJEARP7B5VEsM3Q6lM7CtikPyaYHRh5vcelZkt+4eDyUCDE6Y7r96xb0a6dwWP37Vuzdw3R6GRoZiWf6ve66DajXlATiYzg2ciKEFczsvw/ppeRjDl6PD2Nv/A5eAKmFqZMPsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Ilustra√ß√£o simplificada da estrutura de dados.&quot;
        title=&quot;Ilustra√ß√£o simplificada da estrutura de dados.&quot;
        data-src=&quot;/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/15d25/redis-geoloc-architecture.png&quot;
        data-srcset=&quot;/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/8ff5a/redis-geoloc-architecture.png 240w,
/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/e85cb/redis-geoloc-architecture.png 480w,
/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/15d25/redis-geoloc-architecture.png 497w&quot;
        sizes=&quot;(max-width: 497px) 100vw, 497px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;No exemplo, criamos um √≠ndice chamado &lt;em&gt;Salvador&lt;/em&gt; (cidade em que sou nascido e criado üòä) que aponta para um conjunto de pontos.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Aten√ß√£o:&lt;/strong&gt; como o Redis utiliza a estrutura de conjuntos n√£o √© poss√≠vel existir no mesmo √≠ndice dois pontos com o mesmo nome. A inser√ß√£o de um ponto com o mesmo nome corresponde a uma atualiza√ß√£o das coordenadas (opera√ß√£o de &lt;em&gt;upsert&lt;/em&gt;).&lt;/p&gt;
&lt;h2&gt;M√£os √† obra&lt;/h2&gt;
&lt;p&gt;O Redis nos fornece uma API com os seguintes comandos: &lt;code class=&quot;language-text&quot;&gt;GEOADD&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;GEODIST&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEOHASH&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEOPOS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEOSEARCH&lt;/code&gt;. Vamos iniciar adicionando alguns pontos ao √≠ndice &lt;code class=&quot;language-text&quot;&gt;location:salvador&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Aten√ß√£o:&lt;/strong&gt; Os comandos logo ser√£o depreciados: &lt;code class=&quot;language-text&quot;&gt;GEOMEMBER&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUS_RO&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUSBYMEMBER&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUSBYMEMBER_RO&lt;/code&gt;. Por isso, n√£o vamos explor√°-los neste post.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOADD location:salvador -38.5139209 -12.9730385 mercadomodelo -38.5329599 -13.0101531 faroldabarra -38.5260635 -13.0107505 morrodocristo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Aqui, duas observa√ß√µes &lt;strong&gt;importantes&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;O redis recebe &lt;strong&gt;primeiro&lt;/strong&gt; a longitude e depois a latitude.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;CMD &amp;lt;set-name&amp;gt; &amp;lt;long&amp;gt; &amp;lt;lat&amp;gt; &amp;lt;member-name&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Como vamos manipular os pontos dentro do √≠ndice eu optei por adotar um padr√£o &lt;em&gt;lowercase&lt;/em&gt; nas strings e no √≠ndice. Isso evita erros na busca e tamb√©m torna suficientemente leg√≠vel os dados armazenados (veja a se√ß√£o &lt;em&gt;Redis keys&lt;/em&gt; da &lt;a href=&quot;https://redis.io/topics/data-types-intro&quot;&gt;documenta√ß√£o&lt;/a&gt;).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Uma vez inseridos os pontos, podemos brincar com a API. Vamos a alguns casos de uso.&lt;/p&gt;
&lt;h3&gt;Obter longitude e latitude de um ou mais pontos&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOPOS location:salvador faroldabarra

&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.53296071290969849&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.01015213126540715&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.52607816457748413&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.0107807421129209&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Calcular a dist√¢ncia, em metros, entre dois pontos&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEODIST location:salvador faroldabarra morrodocristo

&lt;span class=&quot;token string&quot;&gt;&quot;749.1386&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;OBS:&lt;/em&gt; Voc√™ pode passar, no final, a m√©trica de dist√¢ncia que voc√™ quer (m, km, ft, mi).&lt;/p&gt;
&lt;h3&gt;Atualizar um ponto&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOADD location:salvador -38 -12 elevadorlacerda

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOADD location:salvador -38.5159605 -12.9740495 elevadorlacerda

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOPOS location:salvador elevadorlacerda&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;OBS:&lt;/em&gt; Como estamos trabalhando com conjuntos a atualiza√ß√£o de um ponto se d√° por inserir um ponto com a mesma string (itens repetidos n√£o s√£o permitidos).&lt;/p&gt;
&lt;h3&gt;Buscar&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Pontos em um raio de 1600 metros a uma determinada longitude/latitude&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCH location:salvador FROMLONLAT -38.5175291 -13.0060716 BYRADIUS &lt;span class=&quot;token number&quot;&gt;1600&lt;/span&gt; m
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Pontos em um raio de 200 km de um ponto existente&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCH location:salvador FROMMEMBER faroldabarra BYRADIUS &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; km
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;elevadorlacerda&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# A mesma query acima por√©m com as coordenadas e a dist√¢ncia&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCH location:salvador FROMMEMBER faroldabarra BYRADIUS &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; km WITHCOORD WITHDIST
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.0000&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.53296071290969849&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.01015213126540715&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.7491&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.52607816457748413&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.0107807421129209&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;elevadorlacerda&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4.4180&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.51596087217330933&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-12.97405009779294005&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4.6149&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.51392239332199097&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-12.97303874405036339&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Observa√ß√µes:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GEOSEARCH&lt;/code&gt; tamb√©m permite restringir a quantidade de resultados por meio do par√¢metro &lt;code class=&quot;language-text&quot;&gt;COUNT&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Substitua o &lt;code class=&quot;language-text&quot;&gt;BYRADIUS 200 km&lt;/code&gt; por &lt;code class=&quot;language-text&quot;&gt;BYBOX 200 200 km&lt;/code&gt; e o Redis ir√° considerar um ret√¢ngulo ao inv√©s de uma √°rea circular.&lt;/li&gt;
&lt;li&gt;√â poss√≠vel retornar os valores ordenados pela dist√¢ncia. Basta adicionar &lt;code class=&quot;language-text&quot;&gt;ASC&lt;/code&gt; ou &lt;code class=&quot;language-text&quot;&gt;DESC&lt;/code&gt; ao final da busca.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Armazenar os resultados da busca&lt;/h3&gt;
&lt;p&gt;O redis permite que voc√™ fa√ßa uma busca e armazene em um √≠ndice espec√≠fico. No exemplo abaixo buscamos em &lt;code class=&quot;language-text&quot;&gt;location:salvador&lt;/code&gt; e armazenamos em &lt;code class=&quot;language-text&quot;&gt;location:results:salvador&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCHSTORE location:results:salvador location:salvador FROMMEMBER faroldabarra BYRADIUS &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; km

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; KEYS *
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;location:salvador&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;location:results:salvador&quot;&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZRANGE location:results:salvador &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; -1
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Geohash&lt;/h3&gt;
&lt;p&gt;Redis usa a representa√ß√£o em Geohash, string de 11 caracteres, para representar os pontos no conjunto de forma que ela pode ser traduzida em uma coordenada (lat / long). &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOHASH location:salvador morrodocristo faroldabarra
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;7jstgr6nvs0&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;7jstgpt4kg0&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Voc√™ pode verificar esse mapeamento geohash ‚Üî lat/long por meio do site &lt;em&gt;&lt;a href=&quot;https://geohash.org/&quot;&gt;https://geohash.org/&lt;/a&gt;&lt;coloque-aqui-o-geohash&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;h3&gt;Opera√ß√µes com &lt;em&gt;Sorted Set&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;Como o Redis armazena essa estrutura na forma de &lt;em&gt;sorted sets&lt;/em&gt; ent√£o √© poss√≠vel acessar esses dados usando APIs dessa estrutura de dados. Vejamos alguns exemplos (todos os comandos est√£o na &lt;a href=&quot;https://redis.io/commands#sorted-set&quot;&gt;documenta√ß√£o&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZRANGE location:salvador &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; -1
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;elevadorlacerda&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZREM location:salvador elevadorlacerda
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZCARD location:salvador
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZCOUNT location:salvador -inf +inf
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Considera√ß√µes Finais&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Pense no Redis al√©m da chave-valor. Existem outras estruturas de dados para voc√™ brincar.&lt;/li&gt;
&lt;li&gt;Cuidado com o nome do √≠ndice e dos pontos. Voc√™ vai precisar busc√°-los de uma forma inteligente e que evite erros de digita√ß√£o.&lt;/li&gt;
&lt;li&gt;Antes de inserir todos os pontos pense em como voc√™ vai buscar os dados. Ser√° que faz sentido todos os pontos estarem no mesmo √≠ndice? E se voc√™ precisar fazer &lt;em&gt;sharding&lt;/em&gt;?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;E ai, curtiu o post?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Geolocated data with Redis]]></title><description><![CDATA[TL;DR; We are going to use Redis to store geolocated data. Talking about Redis invariably makes us think about cache. However, it evolved‚Ä¶]]></description><link>https://vcrmartinez.com/2022/2022-01-20-Geolocated_data_with_Redis/</link><guid isPermaLink="false">https://vcrmartinez.com/2022/2022-01-20-Geolocated_data_with_Redis/</guid><pubDate>Thu, 20 Jan 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;TL;DR;&lt;/em&gt; We are going to use Redis to store geolocated data.&lt;/p&gt;
&lt;p&gt;Talking about Redis invariably makes us think about cache. However, it evolved and today it is considered a server that stores different data structures (hashes, sets, lists, etc).&lt;/p&gt;
&lt;p&gt;In today‚Äôs post we are going to stay out of common usage and understand how Redis helps us to work with geolocated data (for more information, check the &lt;a href=&quot;https://redis.io/commands#geo&quot;&gt;docs&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Setting up environment&lt;/h2&gt;
&lt;p&gt;You need to set up an environment if you want to execute the commands. I‚Äôm using &lt;a href=&quot;https://www.docker.com/&quot;&gt;docker&lt;/a&gt; and &lt;a href=&quot;https://redis.io/topics/rediscli&quot;&gt;redis-cli&lt;/a&gt;. The latter comes after installing Redis but I like to have it apart (check this &lt;a href=&quot;https://codewithhugo.com/install-just-redis-cli-on-ubuntu-debian-jessie/&quot;&gt;tutorial&lt;/a&gt;). Then, just execute the commands below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ docker run --name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;my-redis --rm -p &lt;span class=&quot;token string&quot;&gt;&quot;6379:6379&quot;&lt;/span&gt; redis:6 redis-server
$ redis-cli

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Data structure&lt;/h2&gt;
&lt;p&gt;Storing anything in Redis requires usage of index. In a simple manner, it is a &lt;em&gt;string&lt;/em&gt; that points to a data structure. To handle geolocated data Redis uses the structure &lt;em&gt;sorted set&lt;/em&gt; in such way that each point (lat/long) is labeled by a &lt;strong&gt;string&lt;/strong&gt;. The simplified image below illustrates the architecture:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 57.08333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAB70lEQVQoz42TTU9TQRSG+w/cGhM3JibuWPpvgKSCgQU2bmzA+B/cQP1gQSQY1GBitLoxSixIrU0wUQkItKKUaL8ohd47d+bexzO3vaUmRDzJuedjZt77znsysfxInNcXzpG53Mfzs2eob6xjAOW6KKXwPK8bo9zXNlf83j9CS89o2/dotVrEivNzvOq7RPriefKJUXTzgNB8H4Lg2MXaX2iqgMm3P0nMb3A/U8LV7RVHSMTkGDtfPrP5bpFK4wAdRMf+tkD6vt9em10sMHhvlcTcVwYkPs7thf2W4wigMThCW9s/CGVfa3S5jCqVuq6r1S7wkfKZeJBnKLXM6HSOuMSJJ2toYaaUMLSbrA6BMe2bCmhx7BrbV4bYHb/Jdv8AhRtJqgK6X6uw8ukbyZk8w3eWGZn+QHwyw/XZVSqHGiO6hoBWbN9qZgElb2YyVNNpvi8sUEu/pLmSxRg/VLHccBif+chwaomrd98Tn1oi+WiNQ2HuRQx7ASMFbdUQTaI66Fm7/WKdwVSWMWHaP5Ul9WanPRTnJEARP7B5VEsM3Q6lM7CtikPyaYHRh5vcelZkt+4eDyUCDE6Y7r96xb0a6dwWP37Vuzdw3R6GRoZiWf6ve66DajXlATiYzg2ciKEFczsvw/ppeRjDl6PD2Nv/A5eAKmFqZMPsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Simplified architecture of geoloc data structure.&quot;
        title=&quot;Simplified architecture of geoloc data structure.&quot;
        data-src=&quot;/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/15d25/redis-geoloc-architecture.png&quot;
        data-srcset=&quot;/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/8ff5a/redis-geoloc-architecture.png 240w,
/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/e85cb/redis-geoloc-architecture.png 480w,
/static/411523fdcb3ebd9c49ad3bc74f2cf8d9/15d25/redis-geoloc-architecture.png 497w&quot;
        sizes=&quot;(max-width: 497px) 100vw, 497px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In the example we have an index named &lt;em&gt;Salvador&lt;/em&gt; (city I‚Äôm born and bred üòä) that points to a set of points.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Attention:&lt;/strong&gt; as redis uses sorted set it is not possible to store two points with the same label. The insertion of a point correspond to an update of coordinates (&lt;strong&gt;upsert&lt;/strong&gt;).&lt;/p&gt;
&lt;h2&gt;Getting the hands dirty&lt;/h2&gt;
&lt;p&gt;Redis gives us an API with the following commands: &lt;code class=&quot;language-text&quot;&gt;GEOADD&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;GEODIST&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEOHASH&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEOPOS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEOSEARCH&lt;/code&gt;. Let‚Äôs start by adding some points to the index &lt;code class=&quot;language-text&quot;&gt;location:salvador&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Attention:&lt;/strong&gt; The commands will soon be deprecated: &lt;code class=&quot;language-text&quot;&gt;GEOMEMBER&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUS_RO&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUSBYMEMBER&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GEORADIUSBYMEMBER_RO&lt;/code&gt;. Due to that we won‚Äôt use them in this post.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOADD location:salvador -38.5139209 -12.9730385 mercadomodelo -38.5329599 -13.0101531 faroldabarra -38.5260635 -13.0107505 morrodocristo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Two &lt;strong&gt;important&lt;/strong&gt; observations:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Redis takes &lt;strong&gt;first&lt;/strong&gt; the longitude.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;CMD &amp;lt;set-name&amp;gt; &amp;lt;long&amp;gt; &amp;lt;lat&amp;gt; &amp;lt;member-name&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;We are going to handle points inside an index and, thus, I used the &lt;em&gt;lowercase&lt;/em&gt; pattern for labels and index. That avoids some typos during the search and makes it legible enough (see &lt;em&gt;Redis keys&lt;/em&gt; section in &lt;a href=&quot;https://redis.io/topics/data-types-intro&quot;&gt;docs&lt;/a&gt;).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Once we have the points inserted, we can play with the API. Let‚Äôs dive into some use cases.&lt;/p&gt;
&lt;h3&gt;Get longitude and latitude&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOPOS location:salvador faroldabarra

&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.53296071290969849&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.01015213126540715&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.52607816457748413&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.0107807421129209&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Calc distance (in meters) between two points&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEODIST location:salvador faroldabarra morrodocristo

&lt;span class=&quot;token string&quot;&gt;&quot;749.1386&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;OBS&lt;/em&gt;: You can provide, at the end, the distance metric you want to use (m, km, ft, mi).&lt;/p&gt;
&lt;h3&gt;Update a point&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOADD location:salvador -38 -12 elevadorlacerda

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOADD location:salvador -38.5159605 -12.9740495 elevadorlacerda

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOPOS location:salvador elevadorlacerda&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;OBS:&lt;/em&gt; Since we are working with a set, updating a point occurs by adding a new point with the same label.&lt;/p&gt;
&lt;h3&gt;Search&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Points in a radius of 1600 meters from a specific coordinate&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCH location:salvador FROMLONLAT -38.5175291 -13.0060716 BYRADIUS &lt;span class=&quot;token number&quot;&gt;1600&lt;/span&gt; m
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Points in a radius of 200 km from an existing point&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCH location:salvador FROMMEMBER faroldabarra BYRADIUS &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; km
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;elevadorlacerda&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Same query above but retrieving coords and distance&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCH location:salvador FROMMEMBER faroldabarra BYRADIUS &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; km WITHCOORD WITHDIST
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.0000&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.53296071290969849&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.01015213126540715&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0.7491&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.52607816457748413&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-13.0107807421129209&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;elevadorlacerda&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4.4180&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.51596087217330933&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-12.97405009779294005&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4.6149&quot;&lt;/span&gt;
   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-38.51392239332199097&quot;&lt;/span&gt;
      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-12.97303874405036339&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;OBS:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;GEOSEARCH&lt;/code&gt; allows to constraint the quantity of results by receiving the &lt;code class=&quot;language-text&quot;&gt;COUNT&lt;/code&gt; parameter.&lt;/li&gt;
&lt;li&gt;Replace &lt;code class=&quot;language-text&quot;&gt;BYRADIUS 200 km&lt;/code&gt; by &lt;code class=&quot;language-text&quot;&gt;BYBOX 200 200 km&lt;/code&gt; and Redis will consider a rectangle rather than a circular area.&lt;/li&gt;
&lt;li&gt;It‚Äôs possible to retrieve values sorted by distance: add &lt;code class=&quot;language-text&quot;&gt;ASC&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;DESC&lt;/code&gt; to the end of the query.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Store the search results&lt;/h3&gt;
&lt;p&gt;Redis allows you to search and store the result in a specific index of your choice. In the example belo we search in &lt;code class=&quot;language-text&quot;&gt;location:salvador&lt;/code&gt; and store the results into &lt;code class=&quot;language-text&quot;&gt;location:results:salvador&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOSEARCHSTORE location:results:salvador location:salvador FROMMEMBER faroldabarra BYRADIUS &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; km

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; KEYS *
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;location:salvador&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;location:results:salvador&quot;&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZRANGE location:results:salvador &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; -1
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Geohash&lt;/h3&gt;
&lt;p&gt;Redis uses a Geohash (string comprised of 11 chars) to represent points in such way that it can be translated to a coord (lat / long).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; GEOHASH location:salvador morrodocristo faroldabarra
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;7jstgr6nvs0&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;7jstgpt4kg0&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can verify the transation geohash ‚Üî lat/long by the website &lt;em&gt;&lt;a href=&quot;https://geohash.org/&quot;&gt;https://geohash.org/&lt;/a&gt;&lt;coloque-aqui-o-geohash&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;em&gt;Sorted Set&lt;/em&gt; operations&lt;/h3&gt;
&lt;p&gt;Since Redis stores the geoloc in the form of a sorted set, it it is possible to access the data using the API provided to handle sorted sets. Let‚Äôs see some examples (all commands are available in the &lt;a href=&quot;https://redis.io/commands#sorted-set&quot;&gt;docs&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZRANGE location:salvador &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; -1
&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;faroldabarra&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;morrodocristo&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;elevadorlacerda&quot;&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mercadomodelo&quot;&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZREM location:salvador elevadorlacerda
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZCARD location:salvador
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1:637&lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;9&lt;/span&gt;&gt;&lt;/span&gt; ZCOUNT location:salvador -inf +inf
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;integer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Final thoughts&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Think about Redis beyond the key-value store. There are other data structures for you to play with.&lt;/li&gt;
&lt;li&gt;Be careful naming index and the points. You will need to retrieve them in a intelligent way that avoids typos.&lt;/li&gt;
&lt;li&gt;Before inserting all the points take a time to consider how you will search the data. Does it make sense to store all points in a single index? What if you need to do &lt;em&gt;sharding&lt;/em&gt;?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That‚Äôs it. Did you like the post?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Usando a fun√ß√£o Postgres::array_agg para agregar colunas de string]]></title><description><![CDATA[Gra√ßas a @copquevictor eu aprendi uma fun√ß√£o de agrega√ß√£o muito √∫til do Posgres: array_agg. Para entend√™-la, vamos supor que voc√™ tenha que‚Ä¶]]></description><link>https://vcrmartinez.com/2021/2021-01-12-Usando_a_funcao_Postgres_array_agg_para_agregar_colunas_de_string/</link><guid isPermaLink="false">https://vcrmartinez.com/2021/2021-01-12-Usando_a_funcao_Postgres_array_agg_para_agregar_colunas_de_string/</guid><pubDate>Tue, 12 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Gra√ßas a &lt;a href=&quot;https://twitter.com/copquevictor&quot;&gt;@copquevictor&lt;/a&gt; eu aprendi uma fun√ß√£o de agrega√ß√£o muito √∫til do Posgres: &lt;strong&gt;array_agg&lt;/strong&gt;. Para entend√™-la, vamos supor que voc√™ tenha que notificar interessados em relat√≥rios e sua query fornece a tabela abaixo como sa√≠da:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;&lt;span class=&quot;token table&quot;&gt;&lt;span class=&quot;token table-header-row&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-header important&quot;&gt; Report    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-header important&quot;&gt; Email                  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token table-line&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;---------&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;----------------------&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token table-data-rows&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #1 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; johndoe@gmail.com      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #1 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; jack@gmail.com         &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #2 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; contact@lisadesign.com &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #3 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; harry@hogwarts.com     &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #3 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; anderson@gmail.com     &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Como voc√™ pode ver, n√≥s temos uma rela√ß√£o Um-para-Muitos: um relat√≥rio √© de interesse de um ou mais emails. Voc√™ pode notificar os emails por meio (i) da itera√ß√£o dos registros (um por um) &lt;strong&gt;OU&lt;/strong&gt; (ii) voc√™ pode agrupar os emails por relat√≥rio. Para o segundo caso, n√£o seria legal obter os resultados abaixo?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;| Report    | Email                                    |
|-----------|------------------------------------------|
| Report #1 | [johndoe@gmail.com, jack@gmail.com]      |
| Report #2 | [contact@lisadesign.com]                 |
| Report #3 | [harry@hogwarts.com, anderson@gmail.com] |&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Gra√ßas a &lt;strong&gt;&lt;a href=&quot;https://www.postgresql.org/docs/13/functions-aggregate.html&quot;&gt;array_agg&lt;/a&gt;&lt;/strong&gt; isso pode ser realizado. Para nossa tabela fict√≠cia, a query seria algo parecido com a query abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; reports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; array_agg&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stakeholders&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; reports
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; stakeholders &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; reports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stakeholders&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;report_id
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; reports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Preste aten√ß√£o que voc√™ &lt;strong&gt;tem que fornecer a cl√°usula GROUP BY&lt;/strong&gt; a fim de agregar os emails.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sqlalchemy &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; String
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sqlalchemy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;functions &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; array_agg
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sqlalchemy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dialects&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;postgresql &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ARRAY

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; models &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Stakeholder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Report

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    emails_agg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; array_agg&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Stakeholder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type_&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ARRAY&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;emails&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;session&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Report&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; emails_agg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Stakeholder&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;group_by&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Report&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Bem √∫til, n√£o acha?&lt;/p&gt;
&lt;h3&gt;Refer√™ncias:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/23261944/sqlalchemy-postgresql-and-array-agg-how-to-select-items-from-array-agg&quot;&gt;Stackoverflow: SQLAlchemy, PostgreSQL and array&lt;em&gt;agg: How to select items from array&lt;/em&gt;agg?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Using Postgres::array_agg function to aggregate string columns]]></title><description><![CDATA[Thanks to @copquevictor I learned a very handy Postgres aggregate function: array_agg. To understand it, suppose you have to notify‚Ä¶]]></description><link>https://vcrmartinez.com/2021/2021-01-12-Using_Postgres_array_agg_function_to_aggregate_string_columns/</link><guid isPermaLink="false">https://vcrmartinez.com/2021/2021-01-12-Using_Postgres_array_agg_function_to_aggregate_string_columns/</guid><pubDate>Tue, 12 Jan 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Thanks to &lt;a href=&quot;https://twitter.com/copquevictor&quot;&gt;@copquevictor&lt;/a&gt; I learned a very handy Postgres aggregate function: &lt;strong&gt;array_agg&lt;/strong&gt;. To understand it, suppose you have to notify stakeholders of reports and your query outputs the table below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;&lt;span class=&quot;token table&quot;&gt;&lt;span class=&quot;token table-header-row&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-header important&quot;&gt; Report    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-header important&quot;&gt; Email                  &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token table-line&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;---------&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;----------------------&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;token table-data-rows&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #1 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; johndoe@gmail.com      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #1 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; jack@gmail.com         &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #2 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; contact@lisadesign.com &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #3 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; harry@hogwarts.com     &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; Report #3 &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token table-data&quot;&gt; anderson@gmail.com     &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, we have a One-to-Many relationship: one report is of interest of one or more emails. You can notify the emails by (i) iterating over the rows (one by one) &lt;strong&gt;OR&lt;/strong&gt; (ii) you can group the emails by the report. For the second case, wouldn‚Äôt it be nice to obtain the result below?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;| Report    | Email                                    |
|-----------|------------------------------------------|
| Report #1 | [johndoe@gmail.com, jack@gmail.com]      |
| Report #2 | [contact@lisadesign.com]                 |
| Report #3 | [harry@hogwarts.com, anderson@gmail.com] |&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Thanks &lt;strong&gt;&lt;a href=&quot;https://www.postgresql.org/docs/13/functions-aggregate.html&quot;&gt;array_agg&lt;/a&gt;&lt;/strong&gt; that can be accomplished. For our fictional table, the query would be something like the query below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; reports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; array_agg&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stakeholders&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; reports
&lt;span class=&quot;token keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;JOIN&lt;/span&gt; stakeholders &lt;span class=&quot;token keyword&quot;&gt;ON&lt;/span&gt; reports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; stakeholders&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;report_id
&lt;span class=&quot;token keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; reports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pay attention that you &lt;strong&gt;must provide a GROUP BY&lt;/strong&gt; clause in order to aggregate the emails.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sqlalchemy &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; String
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sqlalchemy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sql&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;functions &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; array_agg
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; sqlalchemy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dialects&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;postgresql &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ARRAY

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; models &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Stakeholder&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Report

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    emails_agg &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; array_agg&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Stakeholder&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;email&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type_&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ARRAY&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;emails&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;session&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Report&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; emails_agg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Stakeholder&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;group_by&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Report&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pretty handy, right?&lt;/p&gt;
&lt;h3&gt;References:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/23261944/sqlalchemy-postgresql-and-array-agg-how-to-select-items-from-array-agg&quot;&gt;Stackoverflow: SQLAlchemy, PostgreSQL and array&lt;em&gt;agg: How to select items from array&lt;/em&gt;agg?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Do Jekyll para o Gatsby]]></title><description><![CDATA[Durante os √∫tlimos meses eu tenho estudado desenvolvimento front-end e um dos primeiros projetos para praticar foi migrar meu site do Jekyll‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-12-24-Do_Jekyll_para_o_Gatsby/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-12-24-Do_Jekyll_para_o_Gatsby/</guid><pubDate>Thu, 24 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Durante os √∫tlimos meses eu tenho estudado desenvolvimento front-end e um dos primeiros projetos para praticar foi migrar meu site do &lt;a href=&quot;https://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt; para o &lt;a href=&quot;https://www.gatsbyjs.com/&quot;&gt;Gatsby&lt;/a&gt;. S√≥ por isso eu j√° achei a migra√ß√£o vantajosa mas acabei descobrindo outros benef√≠cios √† medida que eu desenvolvia as funcionalidades do site.&lt;/p&gt;
&lt;h2&gt;Requisitos&lt;/h2&gt;
&lt;p&gt;Eu acredito que a melhor ferramenta para manter um site √© o Wordpress. Por√©m, quem escolhe geradores de sites est√°ticos n√£o quer se preocupar com: (i) hospedagem; (ii) banco de dados; (iii) manuten√ß√£o de plugins / terceiros.&lt;/p&gt;
&lt;p&gt;Al√©m disso, no meu caso, eu queria usar o &lt;a href=&quot;https://pages.github.com/&quot;&gt;Github Pages&lt;/a&gt; pela praticidade da ferramenta e por me permitir focar mais no texto do que com a gest√£o do blog.&lt;/p&gt;
&lt;h2&gt;Vantagens&lt;/h2&gt;
&lt;p&gt;Para mim, algumas vantagens ficaram bem claras:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Praticar desenvolvimento front-end&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Neste site eu tive contato com React, Styled Components, HTML, CSS, Vanilla Javascript, Media Queries (e responsividade) e GraphQL.&lt;/p&gt;
&lt;p&gt;Aqui cabe o &lt;em&gt;disclaimer&lt;/em&gt;: um desenvolvedor n√£o front-ender pode sentir dificuldade pois √© necess√°rio entender (ainda que minimamente) de diversas tecnologias que talvez em outra ferramenta esteja presente de forma transparente.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Plugins poderosos&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;O Gatsby tem &lt;a href=&quot;https://www.gatsbyjs.com/plugins&quot;&gt;plugins&lt;/a&gt; muito poderosos que permitem trabalhar com: PWA, Internacionaliza√ß√£o, Otimiza√ß√£o de Imagens, Performance, e um muito mais!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Build separado do Github Pages&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Como o Github Pages faz o build do seu site criado com Jekyll, por quest√µes de seguran√ßa ele n√£o aceita alguns plugins e, com isso, voc√™ fica um pouco limitado. Isso n√£o acontece com o Gatsby porque voc√™ executa o build e s√≥ disponibiliza a pasta &lt;code class=&quot;language-text&quot;&gt;public&lt;/code&gt; para o Github Pages. Assim, como o output √© apenas HTML, CSS e Javascript, seu site dificilmente ter√° alguma incompatibilidade com o Github.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Internacionaliza√ß√£o&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Com o Jekyll eu tive muita dificuldade em criar um blog que suportasse dois idiomas at√© que desisti da ideia. Com o Gatsby, encontrei plugins e materiais que me ajudaram bastante no processo e, hoje, finalmente, tenho um site com dois idiomas.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Alta possibilidade de customiza√ß√£o&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Como o Gatsby utiliza React, voc√™ pode criar seus pr√≥prios componentes. Por exemplo, criei um componente que exibe um alerta caso a postagem seja muito antiga.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Aplicabilidade no mercado&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Eu confesso que n√£o me sentia motivado a estudar como o Jekyll funcionava pois n√£o via aplicabilidade pr√°tica no mercado. J√° o Gatsby, por ser mais recentes, te coloca em contato com diversas tecnologias utilizadas no mercado (vide o primeiro item desta listagem).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Performance&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;√â n√≠tida a preocupa√ß√£o que o Gatsby tem com performance. Isso vai desde fazer o prefetch das p√°ginas enquanto o usu√°rio navega at√© o uso de plugins que otimizam imagens para a web.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;E a√≠, o que achou do site? Cr√≠ticas e sugest√µes s√£o bem-vindas!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[From Jekyll to Gatsby]]></title><description><![CDATA[During the last few months I have been studying front-end development and migrating from Jekyll to Gatsby was one of my personal projects‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-12-24-From_Jekyll_to_Gatsby/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-12-24-From_Jekyll_to_Gatsby/</guid><pubDate>Thu, 24 Dec 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;During the last few months I have been studying front-end development and migrating from &lt;a href=&quot;https://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt; to &lt;a href=&quot;https://www.gatsbyjs.com/&quot;&gt;Gatsby&lt;/a&gt; was one of my personal projects. For that reason alone I already considered the process worthwhile but I ended up discovering other benefits while I developed the features.&lt;/p&gt;
&lt;h2&gt;Requirements&lt;/h2&gt;
&lt;p&gt;I believe the best tool to maintain a website is Wordpress. However, people that choose a static website generator do not want to worry about: (i) hosting; (ii) database; (iii) maintaining plugins / third-party.&lt;/p&gt;
&lt;p&gt;Besides, in my situation, I wanted to use &lt;a href=&quot;https://pages.github.com/&quot;&gt;Github Pages&lt;/a&gt; due to practicality that provides and its focus on the content over the blog maintenance.&lt;/p&gt;
&lt;h2&gt;Advantages&lt;/h2&gt;
&lt;p&gt;In my opinion, some advantages became crystal clear:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Practice front-end development&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For my blog I got in contact with React, Styled Components, HTML, CSS, Vanilla Javascript, Media Queries (and responsiveness) and GraphQL.&lt;/p&gt;
&lt;p&gt;Here goes the &lt;em&gt;disclaimer&lt;/em&gt;: a non front-end developer might face hard times because it is necessary to understand (even a little bit) about several technologies that might be transparent in other tools.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Powerful Plugins&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Gatsby makes available powerful &lt;a href=&quot;https://www.gatsbyjs.com/plugins&quot;&gt;plugins&lt;/a&gt; that allow working with: PWA, i18n, Images Optimization, Performance, and much more!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Separated build from Github Pages&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As Github Pages builds your website created with Jekyll, for security reasons it does not accept some plugins and, thus, you get limited. That does not happen with Gatsby because you execute the build phase and makes available the &lt;code class=&quot;language-text&quot;&gt;public&lt;/code&gt; directory to Github Pages. Therefore, since the output corresponds to HTML, CSS and Javascript, your website will be hardly affected by any incompatibility with Github.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Internationalization&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I went through hard times trying to create a multilingual blog with Jekyll and I gave up on that. Gatsby allowed me to use plugins and find materials that helped me a lot in the proccess and, finally, I have a blog that supports english and portuguese blog posts.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Customization&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Since Gatsby uses React, you can create your own components. For instance, I created a component that exhibits an alert in case of an old blog post.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Influential Technologies&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I confess that I did not fell motivated to study how Jekyll works because I did not see any aplicability to the labor market. Gatsby makes you get in touch with several technologies that are influential in the current job market (check the first item of this list).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Performance&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;It‚Äôs crystal clear the performance concern. That goes from doing prefetch of the pages while the user navigates until the usage of plugins that optimize images for web.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So, what do you think about the website? Any critics and suggestions are welcome!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[O Manual do Trabalho Remoto]]></title><link>https://vcrmartinez.com/2020/2020-11-09-O-Manual-do-Trabalho-Remoto/2020-11-09-O-Manual-do-Trabalho-Remoto/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-11-09-O-Manual-do-Trabalho-Remoto/2020-11-09-O-Manual-do-Trabalho-Remoto/</guid><pubDate>Mon, 09 Nov 2020 03:00:00 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Point Alembic and SQLAlchemy to a different schema]]></title><description><![CDATA[A while ago I developed a backend project that used a shared instance of Postgres. If you use Flask, as I did, probably your migration layer‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-10-02-Pointing_alembic_and_sqlalchemy_to_a_different_schema/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-10-02-Pointing_alembic_and_sqlalchemy_to_a_different_schema/</guid><pubDate>Fri, 02 Oct 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A while ago I developed a backend project that used a shared instance of Postgres. If you use Flask, as I did, probably your migration layer is dealt by Alembic and the ORM of choice is SQLAlchemy. Due to architectural constraints, the project used a different schema (&lt;em&gt;public&lt;/em&gt; was not available). &lt;strong&gt;After the first migration, any change in the model was not identified by Alembic and all tables were generated again.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;The scenario&lt;/h2&gt;
&lt;p&gt;In order to address a new database schema I specified table arguments in the models as illustrated by the example below.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Model&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    __tablename__ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;project_users&quot;&lt;/span&gt;
    __table_args__ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;schema&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Column&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Integer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; primary_key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    email &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Column&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; unique&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, that is just one thing that must be done. The other is to &lt;strong&gt;properly configure Alembic to watch the new schema.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;The solution&lt;/h2&gt;
&lt;p&gt;It was unclear to me what was happening but &lt;a href=&quot;https://stackoverflow.com/questions/26275041/alembic-sqlalchemy-does-not-detect-existing-tables&quot;&gt;this issue&lt;/a&gt; in StackOverflow clarified. To sum up:&lt;/p&gt;
&lt;p&gt;(1) It is necessary to allow Alembic to scan all schemas in database. It is done by setting &lt;code class=&quot;language-text&quot;&gt;EnvironmentContext.configure.include_schemas&lt;/code&gt; in the configuration context. Thus, the database dialect (Postgres in this scenario) executes the query below to retrieve the schemas:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; nspname &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; pg_namespace &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; nspname &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pg_%&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; nspname&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(2) The query above brings the schemas but we are interested in the one our application uses. By setting &lt;code class=&quot;language-text&quot;&gt;EnvironmentContext.configure.include_object&lt;/code&gt;, we can specify a callable responsible for filtering which database objects should be considered.&lt;/p&gt;
&lt;h2&gt;Code Snippet&lt;/h2&gt;
&lt;p&gt;After running the init command, &lt;code class=&quot;language-text&quot;&gt;migrations/env.py&lt;/code&gt; is generated. Since it specifies the configuration object, we will need to modify it a little bit. The code bellow illustrates that.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;include_object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reflected&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; compare_to&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;hasattr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;schema&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;table&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run_migrations_offline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token triple-quoted-string string&quot;&gt;&quot;&quot;&quot;Run migrations in &apos;offline&apos; mode.
    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don&apos;t even need a DBAPI to be available.
    Calls to context.execute() here emit the given string to the
    script output.
    &quot;&quot;&quot;&lt;/span&gt;
    url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get_main_option&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sqlalchemy.url&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; target_metadata&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; literal_binds&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        version_table_schema&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        include_schemas&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        include_object&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;include_object&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;begin_transaction&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run_migrations&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run_migrations_online&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token triple-quoted-string string&quot;&gt;&quot;&quot;&quot;Run migrations in &apos;online&apos; mode.
    In this scenario we need to create an Engine
    and associate a connection with the context.
    &quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# this callback is used to prevent an auto-migration from being generated&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# when there are no changes to the schema&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;process_revision_directives&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; revision&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; directives&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;getattr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd_opts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;autogenerate&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            script &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; directives&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; script&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;upgrade_ops&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_empty&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                directives&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;No changes in schema detected.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    connectable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; engine_from_config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get_section&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config_ini_section&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        prefix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sqlalchemy.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        poolclass&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;pool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NullPool&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; connectable&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connect&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; connection&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            connection&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;connection&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            target_metadata&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            version_table_schema&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            include_schemas&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            process_revision_directives&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;process_revision_directives&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            include_object&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;include_object&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;current_app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;extensions&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;migrate&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure_args
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;begin_transaction&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run_migrations&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Lines 21 and 55&lt;/strong&gt; set &lt;code class=&quot;language-text&quot;&gt;include_schema=True&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Lines 22 and 57&lt;/strong&gt; pass a callable &lt;code class=&quot;language-text&quot;&gt;include_object&lt;/code&gt; that corresponds to the function at 4th line.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Line 3&lt;/strong&gt; is our callable that specifies whether Alembic should consider or not the object in question. Pay attention that in the 5th line we check whether the object has a schema attribute. Finally lines 6 and 7 compare the schema with the one configured in the SQLAlchemy models.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Configure o Alembic e o SQLAlchemy para um schema diferente]]></title><description><![CDATA[H√° algum tempo, desenvolvi um projeto de back-end que usava uma inst√¢ncia compartilhada do Postgres. Se voc√™ usar o Flask, como eu fiz‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-10-02-Configure_o_Alembic_e_o_SQLAlchemy_para_um_schema_diferente/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-10-02-Configure_o_Alembic_e_o_SQLAlchemy_para_um_schema_diferente/</guid><pubDate>Fri, 02 Oct 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;H√° algum tempo, desenvolvi um projeto de back-end que usava uma inst√¢ncia compartilhada do Postgres. Se voc√™ usar o Flask, como eu fiz, provavelmente sua camada de migra√ß√£o √© tratada pelo Alembic e o ORM de escolha sendo o SQLAlchemy. Devido a restri√ß√µes da arquitetura, o projeto usou um esquema diferente (&lt;em&gt;public&lt;/em&gt; n√£o estava dispon√≠vel). &lt;strong&gt;Ap√≥s a primeira migra√ß√£o, qualquer altera√ß√£o no modelo n√£o foi identificada pelo Alembic e todas as tabelas foram geradas novamente.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;O Cen√°rio&lt;/h2&gt;
&lt;p&gt;Para lidar com um novo schema de banco de dados, especifiquei os argumentos nos models, conforme ilustrado pelo exemplo abaixo.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Model&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    __tablename__ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;project_users&quot;&lt;/span&gt;
    __table_args__ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;schema&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Column&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Integer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; primary_key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    email &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Column&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; unique&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;No entanto, isso √© apenas uma coisa que deve ser feita. A outra √© &lt;strong&gt;configurar corretamente o Alembic apontar para o novo esquema.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;A solu√ß√£o&lt;/h2&gt;
&lt;p&gt;N√£o estava claro para mim o que estava acontecendo mas &lt;a href=&quot;https://stackoverflow.com/questions/26275041/alembic-sqlalchemy-does-not-detect-existing-tables&quot;&gt;esta thread&lt;/a&gt; no StackOverflow tornou claro. Em resumo:&lt;/p&gt;
&lt;p&gt;(1) √â necess√°rio permitir ao Alembic escanear todos os schemas do banco de dados. Isso √© feito atrav√©s da configura√ß√£o &lt;code class=&quot;language-text&quot;&gt;EnvironmentContext.configure.include_schemas&lt;/code&gt;. Assim, o dialeto de banco de dados (Postgres neste cen√°rio) executa a query abaixo para obter todos os schemas:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; nspname &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; pg_namespace &lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; nspname &lt;span class=&quot;token operator&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pg_%&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;BY&lt;/span&gt; nspname&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(2) A query acima retorna os schemas mas n√≥s estamos interessados apenas naquele que nossa aplica√ß√£o usa. Ao configurar &lt;code class=&quot;language-text&quot;&gt;EnvironmentContext.configure.include_object&lt;/code&gt;, n√≥s podemos especificar um &lt;em&gt;callable&lt;/em&gt; respons√°vel por filtrar quais objetos do banco de dados devem ser considerados.&lt;/p&gt;
&lt;h2&gt;Trecho de c√≥digo&lt;/h2&gt;
&lt;p&gt;Ap√≥s executar o comando de init, &lt;code class=&quot;language-text&quot;&gt;migrations/env.py&lt;/code&gt; √© gerado. Uma vez que ele especifica o objeto de configura√ß√£o, n√≥s vamos precisar modific√°-lo um pouco. O trecho de c√≥digo abaixo ilustra isso.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;include_object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reflected&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; compare_to&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;hasattr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;schema&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;table&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run_migrations_offline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token triple-quoted-string string&quot;&gt;&quot;&quot;&quot;Run migrations in &apos;offline&apos; mode.
    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don&apos;t even need a DBAPI to be available.
    Calls to context.execute() here emit the given string to the
    script output.
    &quot;&quot;&quot;&lt;/span&gt;
    url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get_main_option&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sqlalchemy.url&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; target_metadata&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; literal_binds&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        version_table_schema&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        include_schemas&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        include_object&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;include_object&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;begin_transaction&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run_migrations&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run_migrations_online&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token triple-quoted-string string&quot;&gt;&quot;&quot;&quot;Run migrations in &apos;online&apos; mode.
    In this scenario we need to create an Engine
    and associate a connection with the context.
    &quot;&quot;&quot;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# this callback is used to prevent an auto-migration from being generated&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# when there are no changes to the schema&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# reference: http://alembic.zzzcomputing.com/en/latest/cookbook.html&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;process_revision_directives&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; revision&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; directives&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;getattr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cmd_opts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;autogenerate&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            script &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; directives&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; script&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;upgrade_ops&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_empty&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                directives&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;No changes in schema detected.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    connectable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; engine_from_config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get_section&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config_ini_section&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        prefix&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;sqlalchemy.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        poolclass&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;pool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;NullPool&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; connectable&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connect&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; connection&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            connection&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;connection&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            target_metadata&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            version_table_schema&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;target_metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;schema&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            include_schemas&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            process_revision_directives&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;process_revision_directives&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            include_object&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;include_object&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;current_app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;extensions&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;migrate&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure_args
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;begin_transaction&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run_migrations&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Linhas 21 e 55&lt;/strong&gt; configuram &lt;code class=&quot;language-text&quot;&gt;include_schema=True&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Linhas 22 e 57&lt;/strong&gt; passam o &lt;em&gt;callable&lt;/em&gt; &lt;code class=&quot;language-text&quot;&gt;include_object&lt;/code&gt; que corresponde a fun√ß√£o da 4¬™ linha.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Linha 3&lt;/strong&gt; corresponde ao nosso &lt;em&gt;callable&lt;/em&gt; que especifica se o Alembic deve considerar ou n√£o o objeto em quest√£o. Preste aten√ß√£o que na 5¬™ linha n√≥s verificamos se o objeto tem um atributo &lt;code class=&quot;language-text&quot;&gt;schema&lt;/code&gt;. Finalmente, as linhas 6 e 7 comparam o schema com aquele configurado nos models do SQLAlchemy.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Cr√≠tica: Monolith to Microservices]]></title><description><![CDATA[Microsservi√ßos tem sido um t√≥pico acalorado nos √∫ltimos anos e muitos desenvolvedores imprudentes desejam migrar seus mon√≥litos legados para‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-05-26-Critica_Monolith_to_Microservices/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-05-26-Critica_Monolith_to_Microservices/</guid><pubDate>Tue, 26 May 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Microsservi√ßos tem sido um t√≥pico acalorado nos √∫ltimos anos e muitos desenvolvedores &lt;del&gt;imprudentes&lt;/del&gt; desejam migrar seus mon√≥litos legados para essa arquitetura. No entanto, o processo de quebrar os bancos de dados e o c√≥digo-fonte exige cautela, compreens√£o do dom√≠nio e uma base t√©cnica s√≥lida para dar suporte √† nova arquitetura. Monolith to Microservices, de Sam Newman, √© essencial para entender os padr√µes que podem ajud√°-lo na transi√ß√£o.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABCklEQVQoz5WR7UuDQACH998HfShoxcZAssKCoBdqX9aClady2dJzu5xWLDX2QTgTUqgzXzo2iMho+nw4uLvfc8f9rlGUIWHhzIoP+r2QzykHG7/mLDJBBobqk20bhoEx9jzP9/3FEUvkLMsURTnvdgEA/YseEEUIoSxJQRBUuDnPLTyRrwBG4xsFoqGGhrqu6ZZlLZcZNH6PyVscRin9zNM/nvqfzEizDKuozx9fCqf23TihtFph89DoVt9ebx21d0+aO2edg5epW6mwBcq1JGxy3MoGv7rFr7U1Wa0hu8+u2Bscdvb2m5zQ4s3RfQ2ZfVj4GjpTx8Tmg/2Y0KRGYT8riKKIEMLG8u4XJI9tzMY3C0EAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Monolith to Microservices&quot;
        title=&quot;Monolith to Microservices&quot;
        data-src=&quot;/static/29c7f1336ec92a18dc956fb05a00dde7/d9199/featured.png&quot;
        data-srcset=&quot;/static/29c7f1336ec92a18dc956fb05a00dde7/8ff5a/featured.png 240w,
/static/29c7f1336ec92a18dc956fb05a00dde7/e85cb/featured.png 480w,
/static/29c7f1336ec92a18dc956fb05a00dde7/d9199/featured.png 960w,
/static/29c7f1336ec92a18dc956fb05a00dde7/b5a09/featured.png 1360w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;O autor inicia o livro com conceitos fundamentais como &lt;em&gt;information hiding&lt;/em&gt;, design orientado a dom√≠nio (DDD), acoplamento, &lt;em&gt;delivery contention&lt;/em&gt;, etc. Ele desempenha um papel importante, pois exp√µe aspectos que voc√™ deve compreender para modelar adequadamente uma arquitetura orientada a microsservi√ßos.&lt;/p&gt;
&lt;p&gt;Em seguida, o livro mergulha nos padr√µes de como dividir seu c√≥digo e banco de dados. Apresenta muitos desafios que voc√™ provavelmente enfrentar√° e prop√µe solu√ß√µes que voc√™ deve avaliar de acordo com sua realidade.&lt;/p&gt;
&lt;p&gt;Finalmente, Sam Newman discute pontos comuns de dor ao crescer de alguns servi√ßos para centenas. Ele cobre problemas t√©cnicos (por exemplo, rastreabilidade e observabilidade) e aspectos n√£o t√©cnicos (por exemplo, &lt;em&gt;ownership&lt;/em&gt; e experi√™ncia do desenvolvedor).&lt;/p&gt;
&lt;p&gt;Na minha opini√£o, Monolith to Microservices vale a pena ler porque traz solu√ß√µes para problemas que voc√™ n√£o conhece at√© enfrentar. Al√©m disso, os desafios apresentados fazem voc√™ pensar sobre os requisitos para avan√ßar em dire√ß√£o a uma nova arquitetura. √â importante destacar que ele n√£o defende uma arquitetura de microsservi√ßo - nem diz que voc√™ deve manter seu mon√≥lito. Como voc√™ entende os fundamentos e tem maturidade suficiente para avaliar sua situa√ß√£o, isso mostra padr√µes para facilitar a transi√ß√£o.&lt;/p&gt;
&lt;p&gt;Apesar de saber que um Monolito Modular ou uma arquitetura orientada a macroservi√ßos ser√£o apropriados para muitos casos, vale a pena conhecer os padr√µes para decompor bancos de dados e sistemas. Com os desafios em m√£os, voc√™ pode criar sistemas mais f√°ceis de manter, evoluir e decompor.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Review: Monolith to Microservices]]></title><description><![CDATA[Microservice has been a heated topic in the past few years and many reckless developers urge to migrate their legacy monoliths to that‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-05-26-Review_Monolith_to_Microservices/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-05-26-Review_Monolith_to_Microservices/</guid><pubDate>Tue, 26 May 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Microservice has been a heated topic in the past few years and many &lt;del&gt;reckless&lt;/del&gt; developers urge to migrate their legacy monoliths to that architecture. However, the process of breaking down databases and source code demands cautiousness, domain understanding and a strong technical foundation to support the new architecture. Monolith to Microservices, by Sam Newman, is a must to understand patterns that can help you with the transition.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABCklEQVQoz5WR7UuDQACH998HfShoxcZAssKCoBdqX9aClady2dJzu5xWLDX2QTgTUqgzXzo2iMho+nw4uLvfc8f9rlGUIWHhzIoP+r2QzykHG7/mLDJBBobqk20bhoEx9jzP9/3FEUvkLMsURTnvdgEA/YseEEUIoSxJQRBUuDnPLTyRrwBG4xsFoqGGhrqu6ZZlLZcZNH6PyVscRin9zNM/nvqfzEizDKuozx9fCqf23TihtFph89DoVt9ebx21d0+aO2edg5epW6mwBcq1JGxy3MoGv7rFr7U1Wa0hu8+u2Bscdvb2m5zQ4s3RfQ2ZfVj4GjpTx8Tmg/2Y0KRGYT8riKKIEMLG8u4XJI9tzMY3C0EAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Monolith to Microservices&quot;
        title=&quot;Monolith to Microservices&quot;
        data-src=&quot;/static/29c7f1336ec92a18dc956fb05a00dde7/d9199/featured.png&quot;
        data-srcset=&quot;/static/29c7f1336ec92a18dc956fb05a00dde7/8ff5a/featured.png 240w,
/static/29c7f1336ec92a18dc956fb05a00dde7/e85cb/featured.png 480w,
/static/29c7f1336ec92a18dc956fb05a00dde7/d9199/featured.png 960w,
/static/29c7f1336ec92a18dc956fb05a00dde7/b5a09/featured.png 1360w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The author starts the book with fundamental concepts like Information Hiding, Domain Driven Design, Coupling, Delivery Contention, etc. It plays an important role as it exposes aspects that you must understand to properly model a microservice-driven architecture.&lt;/p&gt;
&lt;p&gt;Then, the book dives into the patterns on how to split your code and database. It presents many challenges that you will probably face and proposes solutions you must assess according to your reality.&lt;/p&gt;
&lt;p&gt;Finally, Sam Newman discusses common pain points when growing from a few services to hundreads of them. He covers bother technical (&lt;em&gt;e.g.&lt;/em&gt; traceability &amp;#x26; observability) and non-technical aspects (&lt;em&gt;e.g&lt;/em&gt;. ownership and developer experience).&lt;/p&gt;
&lt;p&gt;In my opinion, Monolith to Microservices worth reading because it brings solutions for problems you don‚Äôt know until you face. Moreover, the challenges presented make you think about the requirements to move towards a new architecture. It is important to highlight that it does not advocate for a microservice architecture - neither tells you that you should keep your monolith. Since you understand the foundations and you are mature enough to assess your situation, it shows you patterns to ease the transition.&lt;/p&gt;
&lt;p&gt;Despite knowing that a Modular Monolith or a macroservice-driven architecture will be appropriate for many cases, it worth knowing patterns to decompose databases and systems. With the challenges at hand you can create systems easier to maintain, evolve and decompose.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Nginx + Certbox straight to the point]]></title><description><![CDATA[Working in a team with no DevOps expertise forces you to manage to get things done regarding infrastructure. We had to install and configure‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-04-23-Nginx_with_certbot/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-04-23-Nginx_with_certbot/</guid><pubDate>Thu, 23 Apr 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Working in a team with no DevOps expertise forces you to manage to get things done regarding infrastructure. We had to install and configure a &lt;a href=&quot;https://www.rabbitmq.com/&quot;&gt;RabbitMQ&lt;/a&gt; instance behind a &lt;a href=&quot;https://www.nginx.com/&quot;&gt;Nginx&lt;/a&gt; with HTTPS. This is a straighforward post on how to install and configure the reverse proxy with &lt;a href=&quot;https://letsencrypt.org&quot;&gt;Let‚Äôs Encrypt&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Nginx&lt;/h2&gt;
&lt;p&gt;In this tutorial Nginx works as a Reverse Proxy by forwarding external requests from the Internet to the internal service. Let‚Äôs get started.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Create an &lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt; record in your DNS provider:&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;Type&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;Name&lt;/th&gt;
&lt;th&gt;Content&lt;/th&gt;
&lt;th&gt;TTL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;A&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;yourwebsite&lt;/td&gt;
&lt;td&gt;123.456.78.91&lt;/td&gt;
&lt;td&gt;Auto&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;2. Install Nginx and enable it:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; nginx-full
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Manage your nginx instance with the commands below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl restart nginx
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl reload nginx
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3. Create a configuration file in the directory&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;/etc/nginx/sites-available/&lt;/code&gt;&lt;strong&gt;. A nice pattern is to name the file according to the DNS of your service:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;/etc/nginx/sites-available/yourwebsite.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;4. Replace the content below according to your necessities:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name &amp;lt;YOUR-DNS&amp;gt;;
  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;
  location / {
          client_body_buffer_size 128k;
          proxy_send_timeout   90;
          proxy_read_timeout   90;
          proxy_buffer_size    4k;
          proxy_buffers     16 32k;
          proxy_busy_buffers_size 64k;
          proxy_temp_file_write_size 64k;
          proxy_connect_timeout 30s;
          proxy_pass   http://&amp;lt;YOUR-LOCAL&amp;gt;:&amp;lt;PORT&amp;gt;;
          proxy_set_header   Host   $host;
          proxy_set_header   X-Real-IP  $remote_addr;
          proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;5. Create a symbolic link to the sites-enabled folder:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -s /etc/nginx/sites-available/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-filename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/nginx/sites-enabled/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-filename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;6. Load the configuration and check the status:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl reload nginx
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The output below illustrates that our Nginx is working properly (sensitive data was ommited).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; nginx.service - A high performance web server and a reverse proxy server
   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2019-08-13 18:18:09 UTC; 3 months 7 days ago
     Docs: man:nginx(8)
 Main PID: 6027 (nginx)
    Tasks: 5 (limit: 4915)
   CGroup: /system.slice/nginx.service
           ‚îú‚îÄ5198 nginx: worker process
           ‚îú‚îÄ5199 nginx: worker process
           ‚îú‚îÄ5200 nginx: worker process
           ‚îú‚îÄ5201 nginx: worker process
           ‚îî‚îÄ6027 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;

Aug 13 18:18:09 systemd[1]: Starting A high performance web server and a reverse proxy server...
Aug 13 18:18:09 systemd[1]: Started A high performance web server and a reverse proxy server.
Aug 13 18:53:04 systemd[1]: Reloading A high performance web server and a reverse proxy server.
Aug 13 18:53:04 systemd[1]: Reloaded A high performance web server and a reverse proxy server.
Aug 13 18:58:21 systemd[1]: Reloading A high performance web server and a reverse proxy server.
Aug 13 18:58:21 systemd[1]: Reloaded A high performance web server and a reverse proxy server.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Certbot&lt;/h2&gt;
&lt;p&gt;To enable HTTPS on your website, you need to get a certificate from a Certificate Authority (CA). We can use Let‚Äôs Encrypt and the Certbot client to setup the environment.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Install Certbot with nginx plugin:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; python-certbot-nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2. Execute certbot passing your domain as parameter:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; certbot --nginx -d &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR-DOMAIN&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3. Ensure autorenew is configured in the Linux cronjob:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/cron.d/certbot&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Voil√†!&lt;/p&gt;
&lt;h2&gt;Links&lt;/h2&gt;
&lt;p&gt;You might find useful the links below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://tecadmin.net/auto-renew-lets-encrypt-certificates/&quot;&gt;Certbot.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tecadmin.net/auto-renew-lets-encrypt-certificates/&quot;&gt;Techmonger: Certbot Auto Renew/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tecadmin.net/auto-renew-lets-encrypt-certificates/&quot;&gt;Tecadmin: Auto renew lets encrypt certificates&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Nginx + Certbox: direto ao ponto]]></title><description><![CDATA[Trabalhar em uma equipe sem experi√™ncia em DevOps obriga voc√™ a gerenciar para fazer as coisas em rela√ß√£o √† infraestrutura. Tivemos que‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-04-23-Nginx_com_certbot_direto_ao_ponto/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-04-23-Nginx_com_certbot_direto_ao_ponto/</guid><pubDate>Thu, 23 Apr 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Trabalhar em uma equipe sem experi√™ncia em DevOps obriga voc√™ a gerenciar para fazer as coisas em rela√ß√£o √† infraestrutura. Tivemos que instalar e configurar uma inst√¢ncia do &lt;a href=&quot;https://www.rabbitmq.com/&quot;&gt;RabbitMQ&lt;/a&gt; atr√°s de um &lt;a href=&quot;https://www.nginx.com/&quot;&gt;Nginx&lt;/a&gt; com HTTPS. Esta √© uma postagem direta sobre como instalar e configurar o proxy reverso com &lt;a href=&quot;https://letsencrypt.org&quot;&gt;Let‚Äôs Encrypt&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Nginx&lt;/h2&gt;
&lt;p&gt;Neste tutorial, o Nginx funciona como um proxy reverso, encaminhando solicita√ß√µes externas da Internet para o servi√ßo interno. Vamos come√ßar.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Crie um registro &lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt; em seu provedor de DNS:&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;Type&lt;/th&gt;
&lt;th align=&quot;center&quot;&gt;Name&lt;/th&gt;
&lt;th&gt;Content&lt;/th&gt;
&lt;th&gt;TTL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;A&lt;/td&gt;
&lt;td align=&quot;center&quot;&gt;yourwebsite&lt;/td&gt;
&lt;td&gt;123.456.78.91&lt;/td&gt;
&lt;td&gt;Auto&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;2. Instale o Nginx e habilite-o:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; nginx-full
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Gerencie a sua inst√¢ncia do nginx com os comandos abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl restart nginx
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl reload nginx
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3. Crie um arquivo de configura√ß√£o no diret√≥rio&lt;/strong&gt; &lt;code class=&quot;language-text&quot;&gt;/etc/nginx/sites-available/&lt;/code&gt;&lt;strong&gt;. Um bom padr√£o √© nome√°-lo de acordo com o DNS do seu servi√ßo:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;/etc/nginx/sites-available/yourwebsite.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;4. Substitua o conte√∫do abaixo de acordo com suas necessidades:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name &amp;lt;YOUR-DNS&amp;gt;;
  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;
  location / {
          client_body_buffer_size 128k;
          proxy_send_timeout   90;
          proxy_read_timeout   90;
          proxy_buffer_size    4k;
          proxy_buffers     16 32k;
          proxy_busy_buffers_size 64k;
          proxy_temp_file_write_size 64k;
          proxy_connect_timeout 30s;
          proxy_pass   http://&amp;lt;YOUR-LOCAL&amp;gt;:&amp;lt;PORT&amp;gt;;
          proxy_set_header   Host   $host;
          proxy_set_header   X-Real-IP  $remote_addr;
          proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;5. Crie um link simb√≥lico para o diret√≥rio sites-enabled:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ln&lt;/span&gt; -s /etc/nginx/sites-available/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-filename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/nginx/sites-enabled/&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-filename&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;6. Carregue a configura√ß√£o e cheque o status:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl reload nginx
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A sa√≠da abaixo ilustra que nosso Nginx est√° funcionando corretamente (dados sens√≠veis foram omitidos).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; nginx.service - A high performance web server and a reverse proxy server
   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2019-08-13 18:18:09 UTC; 3 months 7 days ago
     Docs: man:nginx(8)
 Main PID: 6027 (nginx)
    Tasks: 5 (limit: 4915)
   CGroup: /system.slice/nginx.service
           ‚îú‚îÄ5198 nginx: worker process
           ‚îú‚îÄ5199 nginx: worker process
           ‚îú‚îÄ5200 nginx: worker process
           ‚îú‚îÄ5201 nginx: worker process
           ‚îî‚îÄ6027 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;

Aug 13 18:18:09 systemd[1]: Starting A high performance web server and a reverse proxy server...
Aug 13 18:18:09 systemd[1]: Started A high performance web server and a reverse proxy server.
Aug 13 18:53:04 systemd[1]: Reloading A high performance web server and a reverse proxy server.
Aug 13 18:53:04 systemd[1]: Reloaded A high performance web server and a reverse proxy server.
Aug 13 18:58:21 systemd[1]: Reloading A high performance web server and a reverse proxy server.
Aug 13 18:58:21 systemd[1]: Reloaded A high performance web server and a reverse proxy server.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Certbot&lt;/h2&gt;
&lt;p&gt;Para permitir HTTPs no seu website voc√™ precisa ter um certificado de um Autoridade Certificadora (CA - Certificate Authority). N√≥s podemos usar o Let‚Äôs Encrypt e o cliente do Certbot para configurar o ambiente.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Instale o Certbot com o plugin do Nginx:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; python-certbot-nginx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;2. Execute o certbot passando seu dom√≠nio como par√¢metro:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; certbot --nginx -d &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR-DOMAIN&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;3. Garanta que a renova√ß√£o autom√°tica est√° configurada no cronjob do Linux:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/cron.d/certbot&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Voil√†!&lt;/p&gt;
&lt;h2&gt;Links&lt;/h2&gt;
&lt;p&gt;Voc√™ pode achar √∫til os links abaixo:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://tecadmin.net/auto-renew-lets-encrypt-certificates/&quot;&gt;Certbot.org&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tecadmin.net/auto-renew-lets-encrypt-certificates/&quot;&gt;Techmonger: Certbot Auto Renew/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tecadmin.net/auto-renew-lets-encrypt-certificates/&quot;&gt;Tecadmin: Auto renew lets encrypt certificates&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Dica r√°pida: kubectx para trocar facilmente entre clusters]]></title><description><![CDATA[Depentendo da sua empresa, manter mais de um cluster Kubernetes pode ser uma atividade comum. Entretando, digitar  e  para listar os‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-03-28-Dica_rapida_kubectx_para_trocar_facilmente_entre_clusters/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-03-28-Dica_rapida_kubectx_para_trocar_facilmente_entre_clusters/</guid><pubDate>Sat, 28 Mar 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Depentendo da sua empresa, manter mais de um cluster Kubernetes pode ser uma atividade comum. Entretando, digitar &lt;code class=&quot;language-text&quot;&gt;kubectl config get-contexts&lt;/code&gt; e &lt;code class=&quot;language-text&quot;&gt;kubectl config use-context&lt;/code&gt; para listar os contextos e trocar, respectivamente, (i) √© chato, (ii) demanda esfor√ßo e (iii) n√£o √© intuitivo. Gra√ßas ao &lt;a href=&quot;https://github.com/ahmetb/kubectx/&quot;&gt;kubectx&lt;/a&gt; voc√™ pode facilmente trocar entre contextos.&lt;/p&gt;
&lt;p&gt;Na &lt;a href=&quot;http://onyo.com/&quot;&gt;Onyo&lt;/a&gt;, n√≥s temos que trocar entre tr√™s clusters. Portanto, os comandos abaixo s√£o comumente usados:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectx             : list the contexts
kubectx -           : switch to the previous context
kubectx &amp;lt;NAME&amp;gt;      : switch to context &amp;lt;NAME&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;O README do &lt;em&gt;kubectx&lt;/em&gt; apresenta outros comandos que podem ser √∫teis para voc√™:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectx -c, --current     : show the current context name
kubectx &amp;lt;NEW_NAME&amp;gt;=&amp;lt;NAME&amp;gt; : rename context &amp;lt;NAME&amp;gt; to &amp;lt;NEW_NAME&amp;gt;
kubectx &amp;lt;NEW_NAME&amp;gt;=.      : rename current-context to &amp;lt;NEW_NAME&amp;gt;
kubectx -d &amp;lt;NAME&amp;gt;         : delete context &amp;lt;NAME&amp;gt; (&amp;#39;.&amp;#39; for current-context)
                            (this command won&amp;#39;t delete the user/cluster entry
                            that is used by the context)
kubectx -u, --unset       : unset the current context&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;PS:&lt;/strong&gt; Se voc√™ tiver &lt;a href=&quot;https://github.com/junegunn/fzf&quot;&gt;fzf&lt;/a&gt; instalado voc√™ tem um maravilhoso menu interativo com busca fuzzy sempre que digitar &lt;code class=&quot;language-text&quot;&gt;kubectx&lt;/code&gt; ou &lt;code class=&quot;language-text&quot;&gt;kubens&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Por hoje √© tudo, pessoal!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Quick tip: kubectx for easy switch between clusters]]></title><description><![CDATA[Depending on your company, maintaining more than one Kubernetes cluster can be quite usual. However, typing  and  to list the contexts and‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-03-28-Quick_tip_kubectx_easy_switch_between_k8s_clusters/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-03-28-Quick_tip_kubectx_easy_switch_between_k8s_clusters/</guid><pubDate>Sat, 28 Mar 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Depending on your company, maintaining more than one Kubernetes cluster can be quite usual. However, typing &lt;code class=&quot;language-text&quot;&gt;kubectl config get-contexts&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;kubectl config use-context&lt;/code&gt; to list the contexts and switch, respectively, (i) is boring, (ii) demands effort and (iii) is not intuitive. Thanks to &lt;a href=&quot;https://github.com/ahmetb/kubectx/&quot;&gt;kubectx&lt;/a&gt; you can easily switch between contexts.&lt;/p&gt;
&lt;p&gt;At &lt;a href=&quot;http://onyo.com/&quot;&gt;Onyo&lt;/a&gt;, we have to switch among three clusters. Therefore, the commands below are often used:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectx             : list the contexts
kubectx -           : switch to the previous context
kubectx &amp;lt;NAME&amp;gt;      : switch to context &amp;lt;NAME&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;em&gt;kubectx&lt;/em&gt; README presents other commands that can be helpful to you:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;kubectx -c, --current     : show the current context name
kubectx &amp;lt;NEW_NAME&amp;gt;=&amp;lt;NAME&amp;gt; : rename context &amp;lt;NAME&amp;gt; to &amp;lt;NEW_NAME&amp;gt;
kubectx &amp;lt;NEW_NAME&amp;gt;=.      : rename current-context to &amp;lt;NEW_NAME&amp;gt;
kubectx -d &amp;lt;NAME&amp;gt;         : delete context &amp;lt;NAME&amp;gt; (&amp;#39;.&amp;#39; for current-context)
                            (this command won&amp;#39;t delete the user/cluster entry
                            that is used by the context)
kubectx -u, --unset       : unset the current context&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;PS:&lt;/strong&gt; If you have &lt;a href=&quot;https://github.com/junegunn/fzf&quot;&gt;fzf&lt;/a&gt; installed you get a wonderful interactive menu with fuzzy searching by typing &lt;code class=&quot;language-text&quot;&gt;kubectx&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;kubens&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;That‚Äôs all folks!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Escalando pods no cluster Kubernetes de acordo com o per√≠odo do dia]]></title><description><![CDATA[Existem empresas que dependem fortemente de per√≠odos espec√≠ficos do dia para obter lucro. Empresas de food service, por exemplo, tendem a‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-02-01-Escalando_pods_no_cluster_Kubernetes_de_acordo_com_o_periodo_do_dia/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-02-01-Escalando_pods_no_cluster_Kubernetes_de_acordo_com_o_periodo_do_dia/</guid><pubDate>Sat, 01 Feb 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Existem empresas que dependem fortemente de per√≠odos espec√≠ficos do dia para obter lucro. Empresas de &lt;em&gt;food service&lt;/em&gt;, por exemplo, tendem a ter uma opera√ß√£o aquecida ao meio-dia e o comportamento oposto nos demais per√≠odos do dia. Em rela√ß√£o √† infraestrutura, o fen√¥meno √© particularmente interessante porque em um determinado per√≠odo do dia a aplica√ß√£o recebe uma quantidade impressionante de solicita√ß√µes e o cluster deve ser capaz de escalar muito r√°pido. Uma escala lenta traria erros e lentid√£o para o cliente e, ent√£o, resultaria em aumento do churn. O gr√°fico abaixo exemplifica o cen√°rio.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 851px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACdklEQVQoz2Pg5ZNS5RdUUOHlk5Tn5BJkYQACfj5xEMWwKSSAAQaWBwWD6cj6w2A6vO4wV2TjcQM14yABLm5xMTFpAzawBC+/tCy/oLyqgJC8FD+/FNhABi4Jhj2hvmDmrlA/1nXBgbwg9tKgEIYtawrA4huX5fJvWVnoYmtjIc7GIS0rLqnGzYAM+PgkRfj4pVhBbHdVDYb5gWGMIPaq4GC7tcFBYcsDg8FyG+L8weq3Jnnz70z1d7ZS15Nk45WVERFREoS5EKwRaJgozMApHh4QVwQHigFdZQ50oTTQUH2Q2NrAILD6KRrBjDO1I9l1JQ2YuYTkWYRFVJkYoAYxoBu40M8XrAloiCHQpYpnwj3ZgWxbkBgoKJbaBDBgAwLCStgNTLILAoutDAp2m+IfyQH2anCgPZDPBw7LkFCGGgZHhn1tYQy75oUwbprpz5gWYcmA4UJgTLP+//8fzF8fEiS3JCjEEmb7puAAmfXBgeYg9rTkcqbJ8ycyIrvuwLIohgNLI4FJREAabqCymgU7TMGqwECPif4R/CB2u6snI9SVDjs97MRgap7ttGE9vjpC5/S6MFm4yTw8omAaaLAoTKypZr7JvJgMI/Qw+u+rwja5sN0tee4DyZ75m8UPrUz0PrEmRuPyliizS5sjjcGK5NUswLSQiIJkUNYkl5jyxf6h+TMdGBhEOYT5Jbj4BGS4gEHBJSOhAkpnbFq++ULhRQvsU8one6YkR8Fcxryk10dWUUGVg0FYTBmSfPgkOdX0XaRUdB0lQElbgEdUkF9ARggYFGAMlBcUFZEXBqZ8UDBwATEnKKTUVFSFREVlZBhZxF34BOTkAfm3kSrHsjYIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Daypart behavior&quot;
        title=&quot;Daypart behavior&quot;
        data-src=&quot;/static/1d3e515b8ddc6f09df6bedcf7558a0ce/0fcea/daypart_behavior_chart.png&quot;
        data-srcset=&quot;/static/1d3e515b8ddc6f09df6bedcf7558a0ce/8ff5a/daypart_behavior_chart.png 240w,
/static/1d3e515b8ddc6f09df6bedcf7558a0ce/e85cb/daypart_behavior_chart.png 480w,
/static/1d3e515b8ddc6f09df6bedcf7558a0ce/0fcea/daypart_behavior_chart.png 851w&quot;
        sizes=&quot;(max-width: 851px) 100vw, 851px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Voc√™ pode se perguntar se o problema pode ser resolvido com um mecanismo simples de escalonamento autom√°tico. Bem, isso funciona para ~95% dos clientes, mas ~5% ter√£o problemas. A velocidade de expans√£o da infraestrutura pode n√£o ser r√°pida o suficiente para lidar com a avalanche de solicita√ß√µes. Felizmente, uma boa solu√ß√£o (at√© agora) √© dimensionar as m√°quinas de antem√£o. Se voc√™ tiver um cluster Kubernetes, a solu√ß√£o √© mais f√°cil do que voc√™ pensa: uma combina√ß√£o de escalonamento autom√°tico horizontal de pod e CronJobs resolve o problema.&lt;/p&gt;
&lt;p&gt;Um agradecimento especial a &lt;a href=&quot;https://www.linkedin.com/in/robsonpeixoto/&quot;&gt;Robson Peixoto&lt;/a&gt; por me guiar nessa tarefa.&lt;/p&gt;
&lt;h2&gt;Visao geral&lt;/h2&gt;
&lt;p&gt;A ideia √© criar um CronJob com as permiss√µes corretas para editar as propriedades de escalonamento autom√°tico e, portanto, aumentar ou diminuir o n√∫mero de pods dispon√≠veis. A imagem abaixo ilustra o cen√°rio.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 372px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 110.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAAFMUlEQVQ4y41UW2wUVRgeCOHaAilQukQT0cSgoJj44IP6xgNplfjog/qgEiMXRWMsRgkVTdVEKia8+mq5GWFbpZdtafc2e5u9zv2yM7OzO7uzbdndrtTuzuz8ntmCVuCBk3wzX/7z58uc//vmYNh/a92Gzduf2bhl53ObO7v3rqpjnVtdHZ2dro2ra+s3bd+7qWPnCxs692xaXceewF5cCxhgT2IH1+/q2vdsT9eB/T3dB566u73WeXR1Pd6xZUv3ZocfxX5Y88b6D9bu2rZv7+4dB/bve+xQp1N/GzvT7sW4LBuQSnxIKgh4YSE3m68oM/pc3muUjGCpVMrwvPij0zd2c+JVKS+ExSKPSxqPa/Oqt1DJzcgFMSjqfCBbFMlbM8F3MakkwFTKA0yRBLZIt3mprkNjuQHOymbVKUcwQSRe50oMeJKToFREiMsEBBg/5GoyeOKToNazEMSJQYxT2Yaf9LYYjbRIJW0FKL+VKytWtVptNJtNkCRlxBGMRqK9pJy2A5TPEoucGRcIK8KFHW4FMr6GclsCnz96FhM13hTmGBCLrJ0ti8CVaUCCdq1as1qtliP4hyMY9ON9Mtrny7Qt6ZwtlXkQDAakIo9qjDm3XITZ2fAARioZ81fPMISFkB1igjA8OQxoDA8IJhPJvggXguGJYZsupG1PbBLcvhvA6iRcnrxkprQE4KHEACYprClkCZA1xpaKAmqgIT+n2dX7BEPBUB8yBGg9g/p4m0N9bJFqfyFdyJjlZX3lCxcuXmws7tjZqr/3vlW7s2TVKlWrilCpVBqm2Z7haFsQD/cyGmWHONzidcbKqCkrJkbbM4zwoZUZ+tAMl74bhHkMg+bhw2AjVy3LhJZlQbO54rKs5Noup5KpI/dc1hZlILIxCLB+yNcVmCDGQVtSIBRODGLSmMdb/v48nr90DZeVAi5nc22guPgR0vE4OeQIjo7efJkSaDwtZHCSp4KkQOEZgUS8XfPTEp0eGZk+ihEs9Xuqoo8kNcmdZtLujJBxkwzlFnjpOgq1hyBSZxzBq1d+e4lkSTclUu4Mg3p4yo1EESed93VKoKZGRj1vYoohQZCeBdGJwDyPjuGDuTsGmE1z5cjyypHjRPxIdkEAP+sFDYWZLKQhlo1AoZ4DP+0FfVlDLscHMVohG2ORP1spOW7FxZg1ERu3ZENCxtQazVWmEFGiNyHE7PHomMXplBWkAtZs6hbitDURGWs4+fUHYmexbEEy84sqKGXJ1uYVyFVlKDwkNgFfoE9bUNGvpthyCfVWEK8ooJQk0KqKWbUWYGYmhIItp83L05cgwuN2mMPhyvSVhwY7EU/0Rfkw2r9sUyjY0/EpGA26gdEzcG36qpkuOMGOD2BCjjNjYgT4AmOzGg2EGAWtrD4gGAlF+rg8A4QUsdHtZGeUFKTkRDvYhBgx9b808PoiA5hhGM16fdFGQW6hC6FVq9VaDkdomqb57wzxYKiX11lIqvGWoLMWW6BamVyqhQRbKTXRdMbm9SLB+fl5WF5ehqWlpf+hXq/fc3n87r/8WlpNwgjuBnGORcnww1TCA9kFHtz+GyDcZp1gf4Opaq5QLBplXS8Z96FYLJaWKIofdgRvTc8eYhW2TCmkwamcwSiMQau0wSmcQcqkzmvc3xMTvn7s+Mmvu48dP+c6duJcD4JrFXo+PD6w59PPftq+Zk1nx/MHX9n27Ve/dH9+4ryr/9SFnv6Ph1z9J4dcpz/52XX6o6GeL05d2PPWO19uxR5l7e55egOGdax7lN5/ALaBtuORmw4BAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Diagram illustrating before and after scenarios&quot;
        title=&quot;Diagram illustrating before and after scenarios&quot;
        data-src=&quot;/static/327602690cb30d205aea37e575e74666/98b6e/before_after_cronscale.png&quot;
        data-srcset=&quot;/static/327602690cb30d205aea37e575e74666/8ff5a/before_after_cronscale.png 240w,
/static/327602690cb30d205aea37e575e74666/98b6e/before_after_cronscale.png 372w&quot;
        sizes=&quot;(max-width: 372px) 100vw, 372px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Embora a imagem ilustre um processo de aumento de pods, o oposto tamb√©m pode ser realizado: voc√™ pode querer diminuir o n√∫mero de pods durante a madrugada, por exemplo, para diminuir o n√∫mero de n√≥s e, portanto, o custo de infraestrutura.&lt;/p&gt;
&lt;h2&gt;Horizontal Pod Autoscaler&lt;/h2&gt;
&lt;p&gt;Como o CronJob vai &lt;strong&gt;editar&lt;/strong&gt; as propriedades de escalonamento autom√°tico, precisamos de um Horizontal Pod Autoscaler dispon√≠vel. O c√≥digo yaml abaixo ilustra o escalonamento de uma aplica√ß√£o back-end localizada dentro do namespace &lt;code class=&quot;language-text&quot;&gt;backend&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HorizontalPodAutoscaler
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; autoscaling/v2beta1
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;autoscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;scaleTargetRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;web
  &lt;span class=&quot;token key atrule&quot;&gt;minReplicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;maxReplicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;metrics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Resource
      &lt;span class=&quot;token key atrule&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cpu
        &lt;span class=&quot;token key atrule&quot;&gt;targetAverageValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 120m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Permiss√µes&lt;/h2&gt;
&lt;p&gt;Agora √© hora de configurar as permiss√µes do CronJob. Para fazer isso, usamos o RBAC para conceder acesso √† API Kubernetes e garantir que ele tenha apenas permiss√£o para acessar o recurso de escalonamento autom√°tico. Eu uso o termo &lt;code class=&quot;language-text&quot;&gt;cronscale&lt;/code&gt; para identificar o processo de dimensionamento de acordo com o CronJob.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceAccount
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRole
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;autoscaling&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;horizontalpodautoscalers&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;get&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;list&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;patch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRoleBinding
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io
  &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRole
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
&lt;span class=&quot;token key atrule&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceAccount
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
    &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Aplica√ß√£o&lt;/h2&gt;
&lt;p&gt;Antes de criar o CronJob, precisamos criar a imagem / aplica√ß√£o respons√°vel por atualizar as propriedades de escalonamento autom√°tico. Para isso, sugiro usar o &lt;a href=&quot;https://github.com/kubernetes-client/python&quot;&gt;cliente python&lt;/a&gt;. O snippet de c√≥digo abaixo √© apenas um exemplo de implementa√ß√£o que voc√™ pode usar. Fique √† vontade para mudar de acordo com suas necessidades.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# settings.py&lt;/span&gt;

PROJECTS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;backend&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;HPA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;NAMESPACE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backend&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;NAME&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backend-autoscale&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;TARGET&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backend-web&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Em vez de manter strings hardcoded no c√≥digo, utilizo um arquivo &lt;code class=&quot;language-text&quot;&gt;settings&lt;/code&gt; para armazenar as propriedades relacionadas a cada projeto ‚Ä¶&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# hpa.py&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; kubernetes &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; config

config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;load_incluster_config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; kubernetes &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; client
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; kubernetes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v2beta1_horizontal_pod_autoscaler &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    V2beta1HorizontalPodAutoscaler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; settings


&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    project_name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; min_replicas&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; max_replicas&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; V2beta1HorizontalPodAutoscaler&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PROJECTS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;project_name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;HPA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    api_client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AutoscalingV2beta1Api&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ApiClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    v2beta1_hpa &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; api_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_namespaced_horizontal_pod_autoscaler&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAMESPACE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    v2beta1_hpa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;min_replicas &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; min_replicas
    v2beta1_hpa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;max_replicas &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; max_replicas
    v2beta1_hpa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; api_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;patch_namespaced_horizontal_pod_autoscaler&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAMESPACE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v2beta1_hpa
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;‚Ä¶ ent√£o eu posso passar como par√¢metro o nome do projeto (&lt;code class=&quot;language-text&quot;&gt;backend&lt;/code&gt;) para a fun√ß√£o &lt;code class=&quot;language-text&quot;&gt;scale&lt;/code&gt; e ela saber√° onde obter as propriedades.&lt;/p&gt;
&lt;h2&gt;CronJob&lt;/h2&gt;
&lt;p&gt;Agora que temos as permiss√µes, √© hora de criar o CronJob. Preste aten√ß√£o √† 12¬™ linha, pois ela permite que o kubernetes execute o pod com as permiss√µes que configuramos anteriormente.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v9beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CronJob
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cronscale&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;midday
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;YOUR-CRON-GOES-HERE&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# UTC&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;jobTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
          &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never
          &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; job
              &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &amp;lt;YOUR&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;IMAGE&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;AND&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;VERSION&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;GOES&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;HERE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; IfNotPresent
              &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&amp;lt;YOUR&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;COMMAND&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;GOES&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;HERE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Considera√ß√µes Importantes&lt;/h2&gt;
&lt;p&gt;It is important to be carefull regarding some points:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;UTC vs LocalTime:&lt;/strong&gt; Configure the Dockerfile to use UTC time and consider it in the &lt;code class=&quot;language-text&quot;&gt;schedule&lt;/code&gt; property.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Click:&lt;/strong&gt; You can wrap the python code with &lt;a href=&quot;https://click.palletsprojects.com/en/7.x/&quot;&gt;Click&lt;/a&gt; to create an easy to use command line interface.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Configmaps:&lt;/strong&gt; The settings module use hardcoded values but it could easily take the values from a ConfigMap.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Non-root user:&lt;/strong&gt; Do not use root user for the Dockerfile. You can take the Dockerfile below as a starting point:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;√â importante ter cuidado com alguns pontos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;UTC vs LocalTime:&lt;/strong&gt; Configure o Dockerfile para usar o hor√°rio UTC e considere-o na propriedade &lt;code class=&quot;language-text&quot;&gt;schedule&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Click:&lt;/strong&gt; Voc√™ pode usar o &lt;a href=&quot;https://click.palletsprojects.com/en/7.x/&quot;&gt;Click&lt;/a&gt; para criar uma CLI f√°cil de usar.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Configmaps&lt;/strong&gt; O arquivo &lt;em&gt;settings&lt;/em&gt; usa valores fixos (hardcoded), mas pode utilizar Configmaps se n√£o gostar da abordagem.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Usu√°rio n√£o root:&lt;/strong&gt; N√£o use usu√°rio root para o Dockerfile. Voc√™ pode usar o Dockerfile abaixo como ponto de partida:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; python&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;3.7

&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; PYTHONUNBUFFERED=1

&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; TZ=UTC

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; useradd &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ms /bin/bash app

&lt;span class=&quot;token keyword&quot;&gt;USER&lt;/span&gt; app

&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /home/app

&lt;span class=&quot;token keyword&quot;&gt;ADD&lt;/span&gt; . /home/app

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; pip install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;upgrade pip &amp;amp;&amp;amp; pip install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;r requirements.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Scaling pods in Kubernetes cluster according to daypart]]></title><description><![CDATA[There are businesses that heavily rely on specific periods of day to make profit. Food ordering companies, for example, tend to have a‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-02-01-Scaling_pods_in_kubernetes_cluster_according_to_daypart/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-02-01-Scaling_pods_in_kubernetes_cluster_according_to_daypart/</guid><pubDate>Sat, 01 Feb 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;There are businesses that heavily rely on specific periods of day to make profit. Food ordering companies, for example, tend to have a heated operation during midday and the opposite behavior in other dayparts. Regarding the infrastructure, the phenomenon is particularly interesting because in a specific period of day the application receives an impressive amount of requests and the cluster must be able to scale really fast. A slow scale would bring errors and slowness to customer and, then, result into churn increase. The chart below exemplifies the scenario.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 851px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 55.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACdklEQVQoz2Pg5ZNS5RdUUOHlk5Tn5BJkYQACfj5xEMWwKSSAAQaWBwWD6cj6w2A6vO4wV2TjcQM14yABLm5xMTFpAzawBC+/tCy/oLyqgJC8FD+/FNhABi4Jhj2hvmDmrlA/1nXBgbwg9tKgEIYtawrA4huX5fJvWVnoYmtjIc7GIS0rLqnGzYAM+PgkRfj4pVhBbHdVDYb5gWGMIPaq4GC7tcFBYcsDg8FyG+L8weq3Jnnz70z1d7ZS15Nk45WVERFREoS5EKwRaJgozMApHh4QVwQHigFdZQ50oTTQUH2Q2NrAILD6KRrBjDO1I9l1JQ2YuYTkWYRFVJkYoAYxoBu40M8XrAloiCHQpYpnwj3ZgWxbkBgoKJbaBDBgAwLCStgNTLILAoutDAp2m+IfyQH2anCgPZDPBw7LkFCGGgZHhn1tYQy75oUwbprpz5gWYcmA4UJgTLP+//8fzF8fEiS3JCjEEmb7puAAmfXBgeYg9rTkcqbJ8ycyIrvuwLIohgNLI4FJREAabqCymgU7TMGqwECPif4R/CB2u6snI9SVDjs97MRgap7ttGE9vjpC5/S6MFm4yTw8omAaaLAoTKypZr7JvJgMI/Qw+u+rwja5sN0tee4DyZ75m8UPrUz0PrEmRuPyliizS5sjjcGK5NUswLSQiIJkUNYkl5jyxf6h+TMdGBhEOYT5Jbj4BGS4gEHBJSOhAkpnbFq++ULhRQvsU8one6YkR8Fcxryk10dWUUGVg0FYTBmSfPgkOdX0XaRUdB0lQElbgEdUkF9ARggYFGAMlBcUFZEXBqZ8UDBwATEnKKTUVFSFREVlZBhZxF34BOTkAfm3kSrHsjYIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Daypart behavior&quot;
        title=&quot;Daypart behavior&quot;
        data-src=&quot;/static/1d3e515b8ddc6f09df6bedcf7558a0ce/0fcea/daypart_behavior_chart.png&quot;
        data-srcset=&quot;/static/1d3e515b8ddc6f09df6bedcf7558a0ce/8ff5a/daypart_behavior_chart.png 240w,
/static/1d3e515b8ddc6f09df6bedcf7558a0ce/e85cb/daypart_behavior_chart.png 480w,
/static/1d3e515b8ddc6f09df6bedcf7558a0ce/0fcea/daypart_behavior_chart.png 851w&quot;
        sizes=&quot;(max-width: 851px) 100vw, 851px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You might wonder whether the problem can be solved with a simple autoscaling mechanism. Well, that works for ~95% of the customers but ~5% will have issues. The velocity of scaling up the infrastructure might not be fast enought to address the avalanche of requests. Luckily, a nice solution (so far) is to scale the machines beforehand. If you have a Kubernetes cluster the solution is easier than you think: a combination of Horizontal Pod Autoscaling and CronJobs does the trick.&lt;/p&gt;
&lt;p&gt;A special thanks to &lt;a href=&quot;https://www.linkedin.com/in/robsonpeixoto/&quot;&gt;Robson Peixoto&lt;/a&gt; for providing me guidance to accomplish the task.&lt;/p&gt;
&lt;h2&gt;General Overview&lt;/h2&gt;
&lt;p&gt;The idea is to create a CronJob with the right permissions to edit autoscaling properties and, therefore, increase or decrese the number of pods available. The image below illustrates the scenario.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 372px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 110.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAAFMUlEQVQ4y41UW2wUVRgeCOHaAilQukQT0cSgoJj44IP6xgNplfjog/qgEiMXRWMsRgkVTdVEKia8+mq5GWFbpZdtafc2e5u9zv2yM7OzO7uzbdndrtTuzuz8ntmCVuCBk3wzX/7z58uc//vmYNh/a92Gzduf2bhl53ObO7v3rqpjnVtdHZ2dro2ra+s3bd+7qWPnCxs692xaXceewF5cCxhgT2IH1+/q2vdsT9eB/T3dB566u73WeXR1Pd6xZUv3ZocfxX5Y88b6D9bu2rZv7+4dB/bve+xQp1N/GzvT7sW4LBuQSnxIKgh4YSE3m68oM/pc3muUjGCpVMrwvPij0zd2c+JVKS+ExSKPSxqPa/Oqt1DJzcgFMSjqfCBbFMlbM8F3MakkwFTKA0yRBLZIt3mprkNjuQHOymbVKUcwQSRe50oMeJKToFREiMsEBBg/5GoyeOKToNazEMSJQYxT2Yaf9LYYjbRIJW0FKL+VKytWtVptNJtNkCRlxBGMRqK9pJy2A5TPEoucGRcIK8KFHW4FMr6GclsCnz96FhM13hTmGBCLrJ0ti8CVaUCCdq1as1qtliP4hyMY9ON9Mtrny7Qt6ZwtlXkQDAakIo9qjDm3XITZ2fAARioZ81fPMISFkB1igjA8OQxoDA8IJhPJvggXguGJYZsupG1PbBLcvhvA6iRcnrxkprQE4KHEACYprClkCZA1xpaKAmqgIT+n2dX7BEPBUB8yBGg9g/p4m0N9bJFqfyFdyJjlZX3lCxcuXmws7tjZqr/3vlW7s2TVKlWrilCpVBqm2Z7haFsQD/cyGmWHONzidcbKqCkrJkbbM4zwoZUZ+tAMl74bhHkMg+bhw2AjVy3LhJZlQbO54rKs5Noup5KpI/dc1hZlILIxCLB+yNcVmCDGQVtSIBRODGLSmMdb/v48nr90DZeVAi5nc22guPgR0vE4OeQIjo7efJkSaDwtZHCSp4KkQOEZgUS8XfPTEp0eGZk+ihEs9Xuqoo8kNcmdZtLujJBxkwzlFnjpOgq1hyBSZxzBq1d+e4lkSTclUu4Mg3p4yo1EESed93VKoKZGRj1vYoohQZCeBdGJwDyPjuGDuTsGmE1z5cjyypHjRPxIdkEAP+sFDYWZLKQhlo1AoZ4DP+0FfVlDLscHMVohG2ORP1spOW7FxZg1ERu3ZENCxtQazVWmEFGiNyHE7PHomMXplBWkAtZs6hbitDURGWs4+fUHYmexbEEy84sqKGXJ1uYVyFVlKDwkNgFfoE9bUNGvpthyCfVWEK8ooJQk0KqKWbUWYGYmhIItp83L05cgwuN2mMPhyvSVhwY7EU/0Rfkw2r9sUyjY0/EpGA26gdEzcG36qpkuOMGOD2BCjjNjYgT4AmOzGg2EGAWtrD4gGAlF+rg8A4QUsdHtZGeUFKTkRDvYhBgx9b808PoiA5hhGM16fdFGQW6hC6FVq9VaDkdomqb57wzxYKiX11lIqvGWoLMWW6BamVyqhQRbKTXRdMbm9SLB+fl5WF5ehqWlpf+hXq/fc3n87r/8WlpNwgjuBnGORcnww1TCA9kFHtz+GyDcZp1gf4Opaq5QLBplXS8Z96FYLJaWKIofdgRvTc8eYhW2TCmkwamcwSiMQau0wSmcQcqkzmvc3xMTvn7s+Mmvu48dP+c6duJcD4JrFXo+PD6w59PPftq+Zk1nx/MHX9n27Ve/dH9+4ryr/9SFnv6Ph1z9J4dcpz/52XX6o6GeL05d2PPWO19uxR5l7e55egOGdax7lN5/ALaBtuORmw4BAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Diagram illustrating before and after scenarios&quot;
        title=&quot;Diagram illustrating before and after scenarios&quot;
        data-src=&quot;/static/327602690cb30d205aea37e575e74666/98b6e/before_after_cronscale.png&quot;
        data-srcset=&quot;/static/327602690cb30d205aea37e575e74666/8ff5a/before_after_cronscale.png 240w,
/static/327602690cb30d205aea37e575e74666/98b6e/before_after_cronscale.png 372w&quot;
        sizes=&quot;(max-width: 372px) 100vw, 372px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;While image illustrates a scaling up process, the opposite could also be accomplished: you might want to decrease the number of pods during the dawn, for example, to diminish the number of nodes and, therefore, the cost.&lt;/p&gt;
&lt;h2&gt;Horizontal Pod Autoscaler&lt;/h2&gt;
&lt;p&gt;Since the CronJob is going to &lt;strong&gt;edit&lt;/strong&gt; the autoscaling properties we need a basic Horizontal Pod Autoscaler available. The yaml code below illustrates the scaling of a backend application located inside the namespace &lt;code class=&quot;language-text&quot;&gt;backend&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HorizontalPodAutoscaler
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; autoscaling/v2beta1
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;autoscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;scaleTargetRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
    &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;web
  &lt;span class=&quot;token key atrule&quot;&gt;minReplicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;maxReplicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;metrics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Resource
      &lt;span class=&quot;token key atrule&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cpu
        &lt;span class=&quot;token key atrule&quot;&gt;targetAverageValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 120m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Permissions&lt;/h2&gt;
&lt;p&gt;Now, it is time to configure CronJob permissions. To do so, we use the RBAC to grant access to Kubernetes API and make sure it has only permission to access the autoscaling resource. I use the term &lt;code class=&quot;language-text&quot;&gt;cronscale&lt;/code&gt; to identify the process of scaling according to the CronJob.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceAccount
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRole
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;apiGroups&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;autoscaling&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;horizontalpodautoscalers&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;verbs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;get&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;list&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;patch&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRoleBinding
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;roleRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;apiGroup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rbac.authorization.k8s.io
  &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterRole
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
&lt;span class=&quot;token key atrule&quot;&gt;subjects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ServiceAccount
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
    &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Application&lt;/h2&gt;
&lt;p&gt;Before creating the CronJob, we need to create the image/application responsible for updating the autoscaling properties. For that, I suggest using the &lt;a href=&quot;https://github.com/kubernetes-client/python&quot;&gt;python client&lt;/a&gt;. The code snippet below is just an example of implementation that you can use. Feel free to change according to your necessities.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# settings.py&lt;/span&gt;

PROJECTS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;backend&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;HPA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;NAMESPACE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backend&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;NAME&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backend-autoscale&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;TARGET&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;backend-web&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Instead of keeping string floating around the code, I use a settings module to store the properties related to each project‚Ä¶&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# hpa.py&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; kubernetes &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; config

config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;load_incluster_config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; kubernetes &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; client
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; kubernetes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;v2beta1_horizontal_pod_autoscaler &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    V2beta1HorizontalPodAutoscaler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; settings


&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    project_name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; min_replicas&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; max_replicas&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; V2beta1HorizontalPodAutoscaler&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PROJECTS&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;project_name&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;HPA&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

    api_client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AutoscalingV2beta1Api&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ApiClient&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    v2beta1_hpa &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; api_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_namespaced_horizontal_pod_autoscaler&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAMESPACE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    v2beta1_hpa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;min_replicas &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; min_replicas
    v2beta1_hpa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;spec&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;max_replicas &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; max_replicas
    v2beta1_hpa&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; api_client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;patch_namespaced_horizontal_pod_autoscaler&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAMESPACE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v2beta1_hpa
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;‚Ä¶ then I can pass the project name (&lt;code class=&quot;language-text&quot;&gt;backend&lt;/code&gt;) to the &lt;code class=&quot;language-text&quot;&gt;scale&lt;/code&gt; function and it knows where to get the properties.&lt;/p&gt;
&lt;h2&gt;CronJob&lt;/h2&gt;
&lt;p&gt;Now that we have the permissions, it is time to create the CronJob. Pay attention to the 12th line because it allows kubernetes to run the pod with the permissions we have setup before.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v9beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CronJob
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cronscale&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;midday
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;YOUR-CRON-GOES-HERE&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# UTC&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;jobTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;serviceAccountName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronscale
          &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never
          &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; job
              &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &amp;lt;YOUR&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;IMAGE&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;AND&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;VERSION&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;GOES&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;HERE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;imagePullPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; IfNotPresent
              &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&amp;lt;YOUR&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;COMMAND&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;GOES&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;HERE&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Important Considerations&lt;/h2&gt;
&lt;p&gt;It is important to be carefull regarding some points:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;UTC vs LocalTime:&lt;/strong&gt; Configure the Dockerfile to use UTC time and consider it in the &lt;code class=&quot;language-text&quot;&gt;schedule&lt;/code&gt; property.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Click:&lt;/strong&gt; You can wrap the python code with &lt;a href=&quot;https://click.palletsprojects.com/en/7.x/&quot;&gt;Click&lt;/a&gt; to create an easy to use command line interface.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Configmaps:&lt;/strong&gt; The settings module use hardcoded values but it could easily take the values from a ConfigMap.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Non-root user:&lt;/strong&gt; Do not use root user for the Dockerfile. You can take the Dockerfile below as a starting point:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; python&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;3.7

&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; PYTHONUNBUFFERED=1

&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; TZ=UTC

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; useradd &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ms /bin/bash app

&lt;span class=&quot;token keyword&quot;&gt;USER&lt;/span&gt; app

&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /home/app

&lt;span class=&quot;token keyword&quot;&gt;ADD&lt;/span&gt; . /home/app

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; pip install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;upgrade pip &amp;amp;&amp;amp; pip install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;r requirements.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Kubernetes: meu cheat sheet pessoal]]></title><description><![CDATA[Se sua infraestrutura √© composta por um cluster Kubernetes, voc√™ provavelmente tem um conjunto de comandos em m√£os para tarefas comuns. A‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-01-16-Kubernetes_meu_cheat_sheet_pessoal/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-01-16-Kubernetes_meu_cheat_sheet_pessoal/</guid><pubDate>Thu, 16 Jan 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Se sua infraestrutura √© composta por um cluster Kubernetes, voc√™ provavelmente tem um conjunto de comandos em m√£os para tarefas comuns. A documenta√ß√£o do Google fornece um &lt;a href=&quot;https://kubernetes.io/docs/reference/kubectl/cheatsheet/&quot;&gt;cheat sheet&lt;/a&gt; √∫til que voc√™ deve dar uma olhada. Por√©m, neste post irei compartilhar alguns comandos que uso / tenho usado.&lt;/p&gt;
&lt;h2&gt;Comandos Gcloud&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Obter credenciais: &lt;code class=&quot;language-text&quot;&gt;gcloud container clusters get-credentials &amp;lt;CLUSTER-NAME&amp;gt; --zone &amp;lt;ZONE&amp;gt; --project &amp;lt;PROJECT-ID&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Obter imagens que voc√™ fez upload: &lt;code class=&quot;language-text&quot;&gt;gcloud container images list-tags gcr.io/&amp;lt;project-id&amp;gt;/&amp;lt;image-name&amp;gt; [--limit &amp;lt;N&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Obter a √∫ltima imagem do registry: &lt;code class=&quot;language-text&quot;&gt;gcloud container images list-tags gcr.io/&amp;lt;project-id&amp;gt;/&amp;lt;image-name&amp;gt; --limit 1 | tail -1 | awk &amp;#39;{print $2}&amp;#39;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Comandos B√°sicos&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Verifique o contexto atual (melhor usar &lt;a href=&quot;https://github.com/ahmetb/kubectx/&quot;&gt;kubectx&lt;/a&gt;): &lt;code class=&quot;language-text&quot;&gt;kubectl config current-context&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Voc√™ iniciou algum job? Melhor verificar: &lt;code class=&quot;language-text&quot;&gt;kubectl get jobs,pods [-n &amp;lt;NAMESPACE&amp;gt; | --all-namespaces | -o wide]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Quantos n√≥s no cluster? &lt;code class=&quot;language-text&quot;&gt;kubectl get nodes [-o wide]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Liste os recursos: &lt;code class=&quot;language-text&quot;&gt;kubectl get all,svc,deploy,configmaps,secrets,ingress,hpa [-n &amp;lt;NAMESPACE&amp;gt; | --all-namespaces]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Quais namespaces seu cluster tem? &lt;code class=&quot;language-text&quot;&gt;kubectl get namespaces&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Exporte um deployment (√∫til para debugar o yaml): &lt;code class=&quot;language-text&quot;&gt;kubectl get deploy &amp;lt;NAME&amp;gt; -o yaml --export&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Obtenha o Managed Certificate: &lt;code class=&quot;language-text&quot;&gt;kubectl describe managedcertificate [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fa√ßa encaminhamento de porta: &lt;code class=&quot;language-text&quot;&gt;kubectl port-forward [-n &amp;lt;NAMESPACE&amp;gt;] svc/&amp;lt;SERVICE-NAME&amp;gt; &amp;lt;LOCAL-PORT&amp;gt;:&amp;lt;REMOTE-PORT&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Suspenda um CronJob: &lt;code class=&quot;language-text&quot;&gt;kubectl patch cronjobs &amp;lt;cronjob-name&amp;gt; -p &amp;#39;{&amp;quot;spec&amp;quot; : {&amp;quot;suspend&amp;quot; : true }}&amp;#39; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Crie um job a partir de um Cronjob: &lt;code class=&quot;language-text&quot;&gt;kubectl create job --from=cronjob/&amp;lt;YOUR-CRONJOB-NAME&amp;gt; &amp;lt;GIVE-A-NAME&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Dica:&lt;/em&gt; prefixes seus comandos com &lt;code class=&quot;language-text&quot;&gt;watch&lt;/code&gt; para ficar de olho no output. Por exemplo, se voc√™ fez deploy de uma nova imagem, verifique o progresso com o comando &lt;code class=&quot;language-text&quot;&gt;watch kubectl get pods [-n namespace]&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Deploy&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Liste todos os deployments: &lt;code class=&quot;language-text&quot;&gt;kubectl get deployments --all-namespaces&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Criar ou deletar um deploy √© f√°cil: &lt;code class=&quot;language-text&quot;&gt;kubectl [apply|delete] -f &amp;lt;FOLDER-OR-FILE&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Escale: &lt;code class=&quot;language-text&quot;&gt;kubectl scale deploy &amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;] --replicas=&amp;lt;N&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fa√ßa rollback de um deploy: &lt;code class=&quot;language-text&quot;&gt;kubectl rollout undo deployment/&amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Delete evicted pods: &lt;code class=&quot;language-text&quot;&gt;kubectl [-n &amp;lt;NAMESPACE&amp;gt;] delete pods --field-selector=status.phase=Failed&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Delete todos os pods: &lt;code class=&quot;language-text&quot;&gt;kubectl delete --all pods [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Restart nos pods: &lt;code class=&quot;language-text&quot;&gt;kubectl rollout restart deployment &amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dicas:_&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;del&gt;Nunca use&lt;/del&gt; Evite usar o comando &lt;code class=&quot;language-text&quot;&gt;scale deploy&lt;/code&gt; pois voc√™ vai acabar criando uma diferen√ßa entre os arquivos yaml files e o que est√° aplicado no cluster, tornando uma bagun√ßa descobrir o que est√° correto. Tudo bem usar em um cen√°rio de emerg√™ncia mas lembre-se de sempre atualizar o arquivo yaml ou os arquivos de HPA. No cen√°rio normal, mantenha seus arquivos yaml atualizados e aplique-os para mudar o estado do cluster.&lt;/li&gt;
&lt;li&gt;Configurando &lt;code class=&quot;language-text&quot;&gt;--replicas=0&lt;/code&gt; √© uma boa forma de parar o servi√ßo por um per√≠odo de tempo uma vez que voc√™ n√£o deleta o deployment (mas releia a dica anterior).&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Solu√ß√£o de problemas&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Tenha uma vis√£o geral dos deployments: &lt;code class=&quot;language-text&quot;&gt;kubectl describe deploy &amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Tenha uma vis√£o geral do pod: &lt;code class=&quot;language-text&quot;&gt;kubectl describe pod &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Verifique os logs: &lt;code class=&quot;language-text&quot;&gt;kubectl logs -f &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;] [--tail=&amp;lt;N&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Verifique os logs de um container anterior: &lt;code class=&quot;language-text&quot;&gt;kubectl logs &amp;lt;POD-NAME&amp;gt; -c &amp;lt;CONTAINER-NAME&amp;gt; --previous&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Verifique os logs de todos os containers que possuem uma label: &lt;code class=&quot;language-text&quot;&gt;kubectl logs -f -l &amp;lt;KEY&amp;gt;=&amp;lt;VALUE&amp;gt; --all-containers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Obtenha uma shell interativo: &lt;code class=&quot;language-text&quot;&gt;kubectl exec -it &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;] -- /bin/bash&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fa√ßa o dump de um recurso para um arquivo yaml: `kubectl get &lt;OBJECT&gt; &lt;OBJECT-NAME&gt; -o yaml &gt; &lt;filename&gt;.yaml&lt;/li&gt;
&lt;li&gt;Obtenha as m√©tricas de mem√≥ria e cpu memory:
** Todos os n√≥s: &lt;code class=&quot;language-text&quot;&gt;kubectl top nodes&lt;/code&gt;
** Um n√≥: &lt;code class=&quot;language-text&quot;&gt;kubectl top node &amp;lt;NODE-NAME&amp;gt;&lt;/code&gt;
** Pod: &lt;code class=&quot;language-text&quot;&gt;kubectl top pod &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Escalonamento / Migra√ß√£o&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Marque um n√≥ n√£o-escal√°vel: &lt;code class=&quot;language-text&quot;&gt;kubectl cordon &amp;lt;NODE-NAME&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Marque um n√≥ escal√°vel: &lt;code class=&quot;language-text&quot;&gt;kubectl uncordon &amp;lt;NODE-NAME&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Helm&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Solucione o erro devido a vers√µes incompat√≠veis de client: &lt;code class=&quot;language-text&quot;&gt;helm init --upgrade&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Liste os deployments do Helm: &lt;code class=&quot;language-text&quot;&gt;helm ls&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Delete um deploy do helm: &lt;code class=&quot;language-text&quot;&gt;helm delete &amp;lt;NAME&amp;gt; --purge&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Instale um chart: &lt;code class=&quot;language-text&quot;&gt;helm install &amp;lt;CHART-NAME&amp;gt; --name &amp;lt;YOUR-DEPLOY-NAME&amp;gt; -f &amp;lt;YAML-FILE&amp;gt; [--namespace &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Atualize um chart: &lt;code class=&quot;language-text&quot;&gt;helm upgrade &amp;lt;NAME&amp;gt; &amp;lt;CHART&amp;gt; -f &amp;lt;YAML-FILE&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Isso √© tudo, pessoal! √Ä medida que eu utilizar mais comandos eu atualizo este post.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Kubernetes: my personal cheat sheet]]></title><description><![CDATA[If your infrastructure is comprised of a Kubernetes cluster you probably have a set of commands at hand for common tasks. Google doc‚Ä¶]]></description><link>https://vcrmartinez.com/2020/2020-01-16-Kubernetes_my_personal_cheat_sheet/</link><guid isPermaLink="false">https://vcrmartinez.com/2020/2020-01-16-Kubernetes_my_personal_cheat_sheet/</guid><pubDate>Thu, 16 Jan 2020 03:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If your infrastructure is comprised of a Kubernetes cluster you probably have a set of commands at hand for common tasks. Google doc provides a handy &lt;a href=&quot;https://kubernetes.io/docs/reference/kubectl/cheatsheet/&quot;&gt;Cheat Sheet&lt;/a&gt; that you should have a look. However, in this post I will share some commands that I use/have used.&lt;/p&gt;
&lt;h2&gt;Gcloud Commands&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Get credentials: &lt;code class=&quot;language-text&quot;&gt;gcloud container clusters get-credentials &amp;lt;CLUSTER-NAME&amp;gt; --zone &amp;lt;ZONE&amp;gt; --project &amp;lt;PROJECT-ID&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get images you have uploaded: &lt;code class=&quot;language-text&quot;&gt;gcloud container images list-tags gcr.io/&amp;lt;project-id&amp;gt;/&amp;lt;image-name&amp;gt; [--limit &amp;lt;N&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get the last image on your registry: &lt;code class=&quot;language-text&quot;&gt;gcloud container images list-tags gcr.io/&amp;lt;project-id&amp;gt;/&amp;lt;image-name&amp;gt; --limit 1 | tail -1 | awk &amp;#39;{print $2}&amp;#39;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Basic commands&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Check the current cluster context (better to use &lt;a href=&quot;https://github.com/ahmetb/kubectx/&quot;&gt;kubectx&lt;/a&gt;): &lt;code class=&quot;language-text&quot;&gt;kubectl config current-context&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Did you start any job? Better to check: &lt;code class=&quot;language-text&quot;&gt;kubectl get jobs,pods [-n &amp;lt;NAMESPACE&amp;gt; | --all-namespaces | -o wide]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;How many nodes in the cluster? &lt;code class=&quot;language-text&quot;&gt;kubectl get nodes [-o wide]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get resources: &lt;code class=&quot;language-text&quot;&gt;kubectl get all,svc,deploy,configmaps,secrets,ingress,hpa [-n &amp;lt;NAMESPACE&amp;gt; | --all-namespaces]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;What namespaces does your cluster have? &lt;code class=&quot;language-text&quot;&gt;kubectl get namespaces&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Export a deployment (useful to debug the yaml): &lt;code class=&quot;language-text&quot;&gt;kubectl get deploy &amp;lt;NAME&amp;gt; -o yaml --export&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get your Ingress managed certificate: &lt;code class=&quot;language-text&quot;&gt;kubectl describe managedcertificate [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Port forward: &lt;code class=&quot;language-text&quot;&gt;kubectl port-forward [-n &amp;lt;NAMESPACE&amp;gt;] svc/&amp;lt;SERVICE-NAME&amp;gt; &amp;lt;LOCAL-PORT&amp;gt;:&amp;lt;REMOTE-PORT&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Suspend CronJob: &lt;code class=&quot;language-text&quot;&gt;kubectl patch cronjobs &amp;lt;cronjob-name&amp;gt; -p &amp;#39;{&amp;quot;spec&amp;quot; : {&amp;quot;suspend&amp;quot; : true }}&amp;#39; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Create a job from Cronjob: &lt;code class=&quot;language-text&quot;&gt;kubectl create job --from=cronjob/&amp;lt;YOUR-CRONJOB-NAME&amp;gt; &amp;lt;GIVE-A-NAME&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Hint:&lt;/em&gt; prefix your commands with &lt;code class=&quot;language-text&quot;&gt;watch&lt;/code&gt; to keep an eye on the output. For instance, if you have deployed a new image, check the progress by running &lt;code class=&quot;language-text&quot;&gt;watch kubectl get pods [-n namespace]&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Deploy&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Check all deployments: &lt;code class=&quot;language-text&quot;&gt;kubectl get deployments --all-namespaces&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Creating or deleting a deploy is quite easy: &lt;code class=&quot;language-text&quot;&gt;kubectl [apply|delete] -f &amp;lt;FOLDER-OR-FILE&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Scaling it as well: &lt;code class=&quot;language-text&quot;&gt;kubectl scale deploy &amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;] --replicas=&amp;lt;N&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Rollback a deployment: &lt;code class=&quot;language-text&quot;&gt;kubectl rollout undo deployment/&amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Delete evicted pods: &lt;code class=&quot;language-text&quot;&gt;kubectl [-n &amp;lt;NAMESPACE&amp;gt;] delete pods --field-selector=status.phase=Failed&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Delete all pods: &lt;code class=&quot;language-text&quot;&gt;kubectl delete --all pods [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Restart pods: &lt;code class=&quot;language-text&quot;&gt;kubectl rollout restart deployment &amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Hints:&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;del&gt;Never use&lt;/del&gt; Avoid to use &lt;code class=&quot;language-text&quot;&gt;scale deploy&lt;/code&gt; command because you will end up differing from the yaml files and it will be a mess to determine the diff between the cluster and the yaml files. It is OK to use it in an emergency scenario but remember to update the deploy or the HPA file(s). In a normal scenario, keep your yamls updated and apply them to change the cluster state.&lt;/li&gt;
&lt;li&gt;Setting &lt;code class=&quot;language-text&quot;&gt;--replicas=0&lt;/code&gt; is a nice way to stop the service for a period of time since you do not delete the deployment (but consider the advice previously).&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Troubleshooting&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Get an overview of the deployment: &lt;code class=&quot;language-text&quot;&gt;kubectl describe deploy &amp;lt;DEPLOY-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get an overview of the pod: &lt;code class=&quot;language-text&quot;&gt;kubectl describe pod &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Check logs: &lt;code class=&quot;language-text&quot;&gt;kubectl logs -f &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;] [--tail=&amp;lt;N&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Check logs of a previous container: &lt;code class=&quot;language-text&quot;&gt;kubectl logs &amp;lt;POD-NAME&amp;gt; -c &amp;lt;CONTAINER-NAME&amp;gt; --previous&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Check logs of all containers matching a label: &lt;code class=&quot;language-text&quot;&gt;kubectl logs -f -l &amp;lt;KEY&amp;gt;=&amp;lt;VALUE&amp;gt; --all-containers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get an interactive shell: &lt;code class=&quot;language-text&quot;&gt;kubectl exec -it &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;] -- /bin/bash&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Get memory and cpu stats of your:
** Nodes: &lt;code class=&quot;language-text&quot;&gt;kubectl top nodes&lt;/code&gt;
** Node: &lt;code class=&quot;language-text&quot;&gt;kubectl top node &amp;lt;NODE-NAME&amp;gt;&lt;/code&gt;
** Pod: &lt;code class=&quot;language-text&quot;&gt;kubectl top pod &amp;lt;POD-NAME&amp;gt; [-n &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Scheduling / Migration&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Mark a node unschedulable: &lt;code class=&quot;language-text&quot;&gt;kubectl cordon &amp;lt;NODE-NAME&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Mark a node schedulable: &lt;code class=&quot;language-text&quot;&gt;kubectl uncordon &amp;lt;NODE-NAME&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Helm&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Solve error due to incompatible versions client: &lt;code class=&quot;language-text&quot;&gt;helm init --upgrade&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;List helm deployments: &lt;code class=&quot;language-text&quot;&gt;helm ls&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Delete a helm deploy: &lt;code class=&quot;language-text&quot;&gt;helm delete &amp;lt;NAME&amp;gt; --purge&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Install a chart: &lt;code class=&quot;language-text&quot;&gt;helm install &amp;lt;CHART-NAME&amp;gt; --name &amp;lt;YOUR-DEPLOY-NAME&amp;gt; -f &amp;lt;YAML-FILE&amp;gt; [--namespace &amp;lt;NAMESPACE&amp;gt;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Update a chart: &lt;code class=&quot;language-text&quot;&gt;helm upgrade &amp;lt;NAME&amp;gt; &amp;lt;CHART&amp;gt; -f &amp;lt;YAML-FILE&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That‚Äôs all folks. As I use more commands I update this post.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Getting Started with Recommender Systems: Part II]]></title><description><![CDATA[In the previous post I introduced the RecSys field and the levels of personalization. Today I will discuss about the recommendation pipeline‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-09-07-Getting_Started_with_Recommender_Systems_Part_II/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-09-07-Getting_Started_with_Recommender_Systems_Part_II/</guid><pubDate>Sat, 07 Sep 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In the &lt;a href=&quot;/en/blog/2019/2019-08-13-Getting_Started_with_Recommender_Systems_Part_I/&quot;&gt;previous&lt;/a&gt; post I introduced the RecSys field and the levels of personalization. Today I will discuss about the recommendation pipeline and how it works.&lt;/p&gt;
&lt;p&gt;If you missed the other posts, check them out:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/en/blog/2019/2019-08-13-Getting_Started_with_Recommender_Systems_Part_I/&quot;&gt;Part I: Introduction and Levels of Personalization&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Part II: How it Works&lt;/li&gt;
&lt;li&gt;Part III: Techniques&lt;/li&gt;
&lt;li&gt;Part IV: Metrics&lt;/li&gt;
&lt;li&gt;Part V: Challenges&lt;/li&gt;
&lt;li&gt;Part VI: References and Further Reading&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;How it works&lt;/h2&gt;
&lt;p&gt;There are lots of work to be done before doing recommendation per se. Collecting data, preprocessing and designing the model, for example, are important phases. Generally speaking, it is possible to visualize the process as a pipeline comprised of phases illustrated in the figure below.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 755px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABkUlEQVQY0yWRbU/TYBiF+2NN/Oof0ET8IDEY3NaVbsRSEEVmwJi2e9EZsrEwRiSRLYKOOanSCnvpOtZ1yiaX28NJTu7kJOfKSW7p3OvScBy6o5DJvwk3N+BceJx+dzhtunS8gJnCv2Na/Wsav1q4XshVeC3ygd/BseucT91yz5C+JlQqzxZpv92m6/7G77Xo29u4X3QuTp4zutyh3Rvinx1wmX/Iz9wj3Nx9/BMLr9dj/7iNnm2ylmvwpuggGfOPMRcW+CjL+O0OQeBTTEexNucwNh7wubzJZLraPi7zLnIXQ7nH1tM7VAspsfB9qcZ8wuRJ0mBpYwdJ0TRUfYW1VIpgOGQ0+oO++hplSSMSW8ZMfxDFeuMHcnKVxMoroqpOce9A5HulAloyjrassJV6ibRbLFDaLVIpl6ewEWEYsr7+AlVVUOIy2WzmFlj/RjwWJS7HiEYWRWemZrPJp8ND4WqthhQEA4bDgH7fZzweC2g+n8eyLAzDoFLZF0XbtjFNg0wmLfJq9ej2KYMr4Rlndv8DUG+XRqscS6AAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Recommender System Pipeline&quot;
        title=&quot;Recommender System Pipeline&quot;
        data-src=&quot;/static/445881097e2f93831b80b7d8dbcb42a0/cab43/recsys_phases.png&quot;
        data-srcset=&quot;/static/445881097e2f93831b80b7d8dbcb42a0/8ff5a/recsys_phases.png 240w,
/static/445881097e2f93831b80b7d8dbcb42a0/e85cb/recsys_phases.png 480w,
/static/445881097e2f93831b80b7d8dbcb42a0/cab43/recsys_phases.png 755w&quot;
        sizes=&quot;(max-width: 755px) 100vw, 755px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In the next sections we will dive into each phase.&lt;/p&gt;
&lt;h3&gt;Data Collection&lt;/h3&gt;
&lt;p&gt;The most important aspect of RecSys is the understand of users‚Äôs preferences. Therefore, everything starts with the collected data resulting from the interaction between users and items. Depending on the data collected you will have &lt;strong&gt;implicit&lt;/strong&gt; or &lt;strong&gt;explicit&lt;/strong&gt; feedbacks regarding the preferences of your users.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Explicit:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The user explicitly indicates how much they like/dislike a product. For instance, ratings ranging from 1 to 5 (e.g. Amazon) or like/dislike (e.g. Facebook, Netflix).&lt;/p&gt;
&lt;p&gt;Working with explicit data ease the process of understanding the users‚Äô preferences but brings some challenges: (i) once rating items requires user effort, not all users rate the items consumed; (ii) people rate items differently due to different factors (some people are more demanding than others); (iii) there are biased people regarding specific items/categories/products.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Implicit:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Implicit feedback, as the name suggests, does not explicit preferences with ratings. Instead, it represents actions or characteristics that indicate how much a given user likes a given product. For example, you might not like a video on Youtube but watch it from start to end. Despite not givin a like to the video (explicit feedback) you watched the whole video (implicit feedback) and, therefore, it is highly likely you enjoyed it.&lt;/p&gt;
&lt;p&gt;Other examples that are considered implicit feedback:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† i. Place items to the shopping cart&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† ii. Number of times you searched for an item&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† iii. How much time you spent reading an article&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Hybrid:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;There are approaches that take both feedbacks into consideration in order to provide more accurate recommendations. Once they use both explicit and implicit feedback, it is said the algorithm uses hybrid feedback. Certainly it is a more powerful approach because in the real world the users will not explicitly like/dislike all items (the Youtube example aforementioned illustrates the scenario).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Discussion: use or not hybrid feedbacks?&lt;/strong&gt;
Not using hybrid feedback does not imply in a bad RecSys engine because each business domain requires specific approaches. The best way to develop a good engine is to start small and keep iterating until you reach satisfactory results and a reasonable maintenance cost. Sometimes, a very complex architecture does not pay off and, thus, a simple yet robust approach does a wonderful job.&lt;/p&gt;
&lt;h3&gt;Preprocessing&lt;/h3&gt;
&lt;p&gt;Preprocessing is as important as the collecting phase. In real world scenario you can not fit the raw data directly into the algorithms without analysis and preprocessing. Noisy elements and data format are common issues that need to be addressed. Other questions might require a special attention:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† i. How to transform implicit data into feasible numbers to your model?&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† ii. Is there any feature that does not contribute to the model?&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† iii. How are you going to structure the data before training the models? (csv? buckets? files? memory?)&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† iv. How are you going to do data ingestion through your model?&lt;/p&gt;
&lt;p&gt;If you follow some tutorials in the Internet you might not perceive the preprocessing step and that‚Äôs because they usually use free-to-use datasets like &lt;a href=&quot;https://grouplens.org/datasets/movielens/&quot;&gt;Movielens&lt;/a&gt;. In such cases, the data had already been preprocessed to a common pattern (&lt;em&gt;e.g.&lt;/em&gt; CSV, TSV, SSV, etc) like &lt;code class=&quot;language-text&quot;&gt;user_id;item_id;rating;timestamp&lt;/code&gt; and you do have to worry about that. However, in real world scenarios preprocessing is a common step towards a better RecSys engine. The figure in &lt;em&gt;How it works&lt;/em&gt; section lists some techniques like &lt;em&gt;OneHot Encoding&lt;/em&gt;, &lt;em&gt;Row Compression&lt;/em&gt; and &lt;em&gt;Variable Selection&lt;/em&gt; that are pretty common in the Machine Learning field but you might not use (all of) them.&lt;/p&gt;
&lt;h3&gt;Learning&lt;/h3&gt;
&lt;p&gt;RecSys engines usually take advantage of Machine Learning algorithms to build their models. The personalized recommendation requires the building the Ratings Matrix (R): a matrix that represents the user‚Äôs prefences. The table bellow illustrates that using movies as items.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Batman&lt;/th&gt;
&lt;th&gt;Avengers&lt;/th&gt;
&lt;th&gt;Harry Potter&lt;/th&gt;
&lt;th&gt;Star Wars&lt;/th&gt;
&lt;th&gt;Hangover&lt;/th&gt;
&lt;th&gt;A Star is Born&lt;/th&gt;
&lt;th&gt;Nemo&lt;/th&gt;
&lt;th&gt;‚Ä¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Victor&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Jess&lt;/td&gt;
&lt;td&gt;2.5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;5.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Luke&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;‚Ä¶&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;As you can see the matrix has some properties:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† i. It is sparse: the users did not see/watch/read the whole catalog of items, right?&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† ii. Rows represent users and columns stand for items&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† iii. Missing values indicate the user did not rate the item&lt;/p&gt;
&lt;p&gt;Then, through math iterations it predicts the ratings the users would give for each item not seen and builds the Predicted Ratings Matrix (R^):&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Batman&lt;/th&gt;
&lt;th&gt;Avengers&lt;/th&gt;
&lt;th&gt;Harry Potter&lt;/th&gt;
&lt;th&gt;Star Wars&lt;/th&gt;
&lt;th&gt;Hangover&lt;/th&gt;
&lt;th&gt;A Star is Born&lt;/th&gt;
&lt;th&gt;Nemo&lt;/th&gt;
&lt;th&gt;‚Ä¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Victor&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;[3.0]&lt;/td&gt;
&lt;td&gt;[5.0]&lt;/td&gt;
&lt;td&gt;[4.0]&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Jess&lt;/td&gt;
&lt;td&gt;2.5&lt;/td&gt;
&lt;td&gt;[2.0]&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;[2.0]&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;5.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Luke&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;[4.0]&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;[4.0]&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;td&gt;[2.0]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;‚Ä¶&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;* &lt;em&gt;Values between bracket means the predicted rating.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;There are many algorithms to obtain the matrix above and each one has its idiosyncrasies. We will talk about them in the next blog post (&lt;em&gt;hold your breath!&lt;/em&gt;).&lt;/p&gt;
&lt;h3&gt;Recommendation&lt;/h3&gt;
&lt;p&gt;Finally, it is time to recommend a new item to your users. Once we have the Predicted Ratings Matrix (R^) doing the recommendation is a matter of selecting and filtering the predicted items as follows:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† &lt;strong&gt;1. Select Candidates:&lt;/strong&gt; Select the items whose ratings were predicted.&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† &lt;strong&gt;2. Filtering:&lt;/strong&gt; Define a threshold (&lt;em&gt;e.g.&lt;/em&gt; 4.0) and exclude candidates whose ratings are less than that.&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† &lt;strong&gt;3. Top N:&lt;/strong&gt; Sort the result by rating, stablish the number of recommendations (N) and present to the user.&lt;/p&gt;
&lt;p&gt;The figure below illustrates the process by taking into consideration the user Victor listed in the previous table.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABRElEQVQY0yWQ20vCABjF/ZcLq4cIwqeee4iylCiESINIpLLULKEECbLyunkra87L5m5uRv7a1oED57vyfSdgaArK6Jt6pcxnT2RmKNi2zQIwDc2PW0KVtlDztWXqeLDtmRurqGOJjljHsabo0wmB5/qQ62KfVKHF5WOX/IuMZc/9oZ6kky5JJG4rLqvclAZ8DP4XGpbj9g65eupxftdwaxKl2ohALCuxdlBjI/rOerTGVrzPYKiiKUNyzxLBSIfgbpnV/aqruxQrYyx9jNCRCJ18s7TzxsreO8thgUhaJhB/kNk8ahA6fCF0XGf7QkLVLPid0+gpnN33iWeaJLKiq79o9aew+GGs6KSKMqcZgUROJJH/oPDqXnhdktlNttlPNgknRWK5Aab7Dr6HOqauMDOnPj3t5Tw4joOhTfy8ZXhUfQ//AF2oYQRryfDCAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;RecSys Filtering&quot;
        title=&quot;RecSys Filtering&quot;
        data-src=&quot;/static/6acaed139dbb707e59a1a7e9687f471f/d9199/recsys_filtering.png&quot;
        data-srcset=&quot;/static/6acaed139dbb707e59a1a7e9687f471f/8ff5a/recsys_filtering.png 240w,
/static/6acaed139dbb707e59a1a7e9687f471f/e85cb/recsys_filtering.png 480w,
/static/6acaed139dbb707e59a1a7e9687f471f/d9199/recsys_filtering.png 960w,
/static/6acaed139dbb707e59a1a7e9687f471f/c6ff8/recsys_filtering.png 1088w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Prediction vs Recommendation&lt;/h2&gt;
&lt;p&gt;You might read posts that use &lt;strong&gt;prediction&lt;/strong&gt; and &lt;strong&gt;recommendation&lt;/strong&gt; interchangeably but they hold different meanings. &lt;strong&gt;Prediction&lt;/strong&gt; corresponds to the expected rating to a given item. In the learning phase your model assigns ratings to the items the user has not seen and those ratings are predictions. On the other hand, &lt;strong&gt;recommendation&lt;/strong&gt; corresponds to the item itself (or the set of items) being recommended to the user.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Iniciando com Sistemas de Recomenda√ß√£o: Parte II]]></title><description><![CDATA[No post anterior eu introduzi a √°rea de RecSys e os n√≠veis de personaliza√ß√£o. Hoje eu vou discutir sobre o pipeline de recomenda√ß√£o e como‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-09-07-Iniciando_com_sistemas_de_recomendacao_parte_II/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-09-07-Iniciando_com_sistemas_de_recomendacao_parte_II/</guid><pubDate>Sat, 07 Sep 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;No post &lt;a href=&quot;/pt/blog/2019/2019-08-13-Iniciando_com_sistemas_de_recomendacao_parte_I/&quot;&gt;anterior&lt;/a&gt; eu introduzi a √°rea de RecSys e os n√≠veis de personaliza√ß√£o. Hoje eu vou discutir sobre o pipeline de recomenda√ß√£o e como ele funciona.&lt;/p&gt;
&lt;p&gt;Se voc√™ perdeu os outros posts, encontre aqui:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/pt/blog/2019/2019-08-13-Iniciando_com_sistemas_de_recomendacao_parte_I/&quot;&gt;Parte I: Introdu√ß√£o e n√≠veis de personaliza√ß√£o&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Parte II: Como funciona&lt;/li&gt;
&lt;li&gt;Parte III: T√©cnicas&lt;/li&gt;
&lt;li&gt;Parte IV: M√©tricas&lt;/li&gt;
&lt;li&gt;Parte V: Desafios&lt;/li&gt;
&lt;li&gt;Parte VI: Refer√™ncias e leituras adicionais&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Como funciona&lt;/h2&gt;
&lt;p&gt;H√° muito trabalho a ser feito antes de fazer a recomenda√ß√£o em si. A coleta de dados, o pr√©-processamento e o design do modelo, por exemplo, s√£o fases importantes. De modo geral, √© poss√≠vel visualizar o processo como um pipeline composto pelas fases ilustradas na figura a seguir.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 755px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABkUlEQVQY0yWRbU/TYBiF+2NN/Oof0ET8IDEY3NaVbsRSEEVmwJi2e9EZsrEwRiSRLYKOOanSCnvpOtZ1yiaX28NJTu7kJOfKSW7p3OvScBy6o5DJvwk3N+BceJx+dzhtunS8gJnCv2Na/Wsav1q4XshVeC3ygd/BseucT91yz5C+JlQqzxZpv92m6/7G77Xo29u4X3QuTp4zutyh3Rvinx1wmX/Iz9wj3Nx9/BMLr9dj/7iNnm2ylmvwpuggGfOPMRcW+CjL+O0OQeBTTEexNucwNh7wubzJZLraPi7zLnIXQ7nH1tM7VAspsfB9qcZ8wuRJ0mBpYwdJ0TRUfYW1VIpgOGQ0+oO++hplSSMSW8ZMfxDFeuMHcnKVxMoroqpOce9A5HulAloyjrassJV6ibRbLFDaLVIpl6ewEWEYsr7+AlVVUOIy2WzmFlj/RjwWJS7HiEYWRWemZrPJp8ND4WqthhQEA4bDgH7fZzweC2g+n8eyLAzDoFLZF0XbtjFNg0wmLfJq9ej2KYMr4Rlndv8DUG+XRqscS6AAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Recommender System Pipeline&quot;
        title=&quot;Recommender System Pipeline&quot;
        data-src=&quot;/static/445881097e2f93831b80b7d8dbcb42a0/cab43/recsys_phases.png&quot;
        data-srcset=&quot;/static/445881097e2f93831b80b7d8dbcb42a0/8ff5a/recsys_phases.png 240w,
/static/445881097e2f93831b80b7d8dbcb42a0/e85cb/recsys_phases.png 480w,
/static/445881097e2f93831b80b7d8dbcb42a0/cab43/recsys_phases.png 755w&quot;
        sizes=&quot;(max-width: 755px) 100vw, 755px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Nas pr√≥ximas se√ß√µes, mergulharemos em cada fase.&lt;/p&gt;
&lt;h3&gt;Coleta dos Dados&lt;/h3&gt;
&lt;p&gt;O aspecto mais importante do RecSys √© a compreens√£o das prefer√™ncias dos usu√°rios. Portanto, tudo come√ßa com os dados coletados resultantes da intera√ß√£o entre usu√°rios e itens. Dependendo dos dados coletados, voc√™ ter√° feedbacks &lt;strong&gt;impl√≠citos&lt;/strong&gt; ou &lt;strong&gt;expl√≠citos&lt;/strong&gt; sobre as prefer√™ncias de seus usu√°rios.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Expl√≠cito:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;O usu√°rio indica explicitamente o quanto gosta / n√£o gosta de um produto. Por exemplo, classifica√ß√µes que variam de 1 a 5 (por exemplo, Amazon) ou gosto / n√£o gosto (por exemplo, Facebook, Netflix).&lt;/p&gt;
&lt;p&gt;Trabalhar com dados expl√≠citos facilita o processo de compreens√£o das prefer√™ncias dos usu√°rios, mas traz alguns desafios: (i) uma vez que classificar itens exige esfor√ßo do usu√°rio, nem todos os usu√°rios classificam os itens consumidos; (ii) as pessoas avaliam os itens de maneira diferente devido a diferentes fatores (algumas pessoas s√£o mais exigentes do que outras); (iii) existem pessoas tendenciosas em rela√ß√£o a itens / categorias / produtos espec√≠ficos.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Impl√≠cito:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Feedback impl√≠cito, como o nome sugere, n√£o explicita prefer√™ncias com avalia√ß√µes. Em vez disso, representa a√ß√µes ou caracter√≠sticas que indicam o quanto um determinado usu√°rio gosta de um determinado produto. Por exemplo, voc√™ pode n√£o gostar de um v√≠deo no Youtube, mas assisti-lo do in√≠cio ao fim. Apesar de n√£o ter gostado do v√≠deo (feedback expl√≠cito), voc√™ assistiu a todo o v√≠deo (feedback impl√≠cito) e, portanto, √© muito prov√°vel que tenha gostado.&lt;/p&gt;
&lt;p&gt;Outros exemplos que s√£o considerados feedback impl√≠cito:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† i. Coloque os itens no carrinho de compras
¬†¬†¬†¬†¬† ii. N√∫mero de vezes que voc√™ pesquisou por um item
¬†¬†¬†¬†¬† iii. Quanto tempo voc√™ passou lendo um artigo&lt;/p&gt;
&lt;p&gt;** 3. H√≠brido:**&lt;/p&gt;
&lt;p&gt;Existem abordagens que levam ambos os feedbacks em considera√ß√£o para fornecer recomenda√ß√µes mais precisas. Uma vez que eles usam feedback expl√≠cito e impl√≠cito, diz-se que o algoritmo usa feedback h√≠brido. Certamente √© uma abordagem mais poderosa porque no mundo real os usu√°rios n√£o gostam / n√£o gostam explicitamente de todos os itens (o exemplo do Youtube mencionado acima ilustra o cen√°rio).&lt;/p&gt;
&lt;p&gt;** Discuss√£o: usar ou n√£o feedbacks h√≠bridos? **
N√£o usar feedback h√≠brido n√£o implica em um mecanismo RecSys ruim porque cada dom√≠nio de neg√≥cios requer abordagens espec√≠ficas. A melhor maneira de desenvolver um bom motor √© come√ßar devagar e continuar iterando at√© atingir resultados satisfat√≥rios e um custo de manuten√ß√£o razo√°vel. √Äs vezes, uma arquitetura muito complexa n√£o compensa e, portanto, uma abordagem simples, mas robusta, faz um trabalho maravilhoso.&lt;/p&gt;
&lt;h3&gt;Pr√©-processando&lt;/h3&gt;
&lt;p&gt;O pr√©-processamento √© t√£o importante quanto a fase de coleta. No cen√°rio do mundo real, voc√™ n√£o pode ajustar os dados brutos diretamente nos algoritmos sem an√°lise e pr√©-processamento. Elementos ruidosos e formato de dados s√£o problemas comuns que precisam ser resolvidos. Outras quest√µes podem requerer aten√ß√£o especial:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† i. Como transformar dados impl√≠citos em n√∫meros vi√°veis ‚Äã‚Äãpara o seu modelo?
¬†¬†¬†¬†¬† ii. Existe algum recurso que n√£o contribui para o modelo?
¬†¬†¬†¬†¬† iii. Como voc√™ vai estruturar os dados antes de treinar os modelos? (csv? baldes? arquivos? mem√≥ria?)
¬†¬†¬†¬†¬† iv. Como voc√™ vai fazer a ingest√£o de dados por meio do seu modelo?&lt;/p&gt;
&lt;p&gt;Se voc√™ seguir alguns tutoriais na Internet, pode n√£o perceber a etapa de pr√©-processamento e isso porque eles costumam usar conjuntos de dados gratuitos como [Movielens] (&lt;a href=&quot;https://grouplens.org/datasets/movielens/&quot;&gt;https://grouplens.org/datasets/movielens/&lt;/a&gt;). Nesses casos, os dados j√° foram pr√©-processados ‚Äã‚Äãem um padr√£o comum (&lt;em&gt;por exemplo, CSV, TSV, SSV, etc) como `user&lt;/em&gt;id; item&lt;em&gt;id; rating; timestamp` e voc√™ precisa se preocupar com isso. No entanto, em cen√°rios do mundo real, o pr√©-processamento √© uma etapa comum em dire√ß√£o a um mecanismo RecSys melhor. A figura na se√ß√£o \&lt;/em&gt;Como funciona_ lista algumas t√©cnicas como &lt;em&gt;OneHot Encoding&lt;/em&gt;, &lt;em&gt;Row Compression&lt;/em&gt; e &lt;em&gt;Variable Selection&lt;/em&gt; que s√£o muito comuns no campo Machine Learning, mas voc√™ pode n√£o usar (todas).&lt;/p&gt;
&lt;h3&gt;Aprendendo&lt;/h3&gt;
&lt;p&gt;Os motores RecSys geralmente aproveitam os algoritmos de aprendizado de m√°quina para construir seus modelos. A recomenda√ß√£o personalizada requer a constru√ß√£o da Matriz de Avalia√ß√µes (R): uma matriz que representa as prefer√™ncias do usu√°rio. A tabela abaixo ilustra isso usando filmes como itens.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Batman&lt;/th&gt;
&lt;th&gt;Avengers&lt;/th&gt;
&lt;th&gt;Harry Potter&lt;/th&gt;
&lt;th&gt;Star Wars&lt;/th&gt;
&lt;th&gt;Hangover&lt;/th&gt;
&lt;th&gt;A Star is Born&lt;/th&gt;
&lt;th&gt;Nemo&lt;/th&gt;
&lt;th&gt;‚Ä¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Victor&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Jess&lt;/td&gt;
&lt;td&gt;2.5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;5.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Luke&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;‚Ä¶&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Como voc√™ pode ver, a matriz tem algumas propriedades:&lt;/p&gt;
&lt;p&gt;¬†¬†¬†¬†¬† i. √â esparso: os usu√°rios n√£o viam / assistiam / liam todo o cat√°logo de itens, certo?
¬†¬†¬†¬†¬† ii. As linhas representam os usu√°rios e as colunas representam os itens
¬†¬†¬†¬†¬† iii. Valores ausentes indicam que o usu√°rio n√£o avaliou o item&lt;/p&gt;
&lt;p&gt;Ent√£o, por meio de itera√ß√µes matem√°ticas, ele prev√™ as classifica√ß√µes que os usu√°rios dariam para cada item n√£o visto e constr√≥i a Matriz de classifica√ß√µes previstas (R ^):&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Batman&lt;/th&gt;
&lt;th&gt;Avengers&lt;/th&gt;
&lt;th&gt;Harry Potter&lt;/th&gt;
&lt;th&gt;Star Wars&lt;/th&gt;
&lt;th&gt;Hangover&lt;/th&gt;
&lt;th&gt;A Star is Born&lt;/th&gt;
&lt;th&gt;Nemo&lt;/th&gt;
&lt;th&gt;‚Ä¶&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Victor&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;[3.0]&lt;/td&gt;
&lt;td&gt;[5.0]&lt;/td&gt;
&lt;td&gt;[4.0]&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;2.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Jess&lt;/td&gt;
&lt;td&gt;2.5&lt;/td&gt;
&lt;td&gt;[2.0]&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;[2.0]&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;5.0&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Luke&lt;/td&gt;
&lt;td&gt;4.0&lt;/td&gt;
&lt;td&gt;[4.0]&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;3.0&lt;/td&gt;
&lt;td&gt;[4.0]&lt;/td&gt;
&lt;td&gt;1.0&lt;/td&gt;
&lt;td&gt;[2.0]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;‚Ä¶&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;* &lt;em&gt;Valores entre colchetes significam a classifica√ß√£o prevista.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Existem muitos algoritmos para obter a matriz acima e cada um tem suas idiossincrasias. Falaremos sobre eles na pr√≥xima postagem do blog (&lt;em&gt;prenda a respira√ß√£o!&lt;/em&gt;).&lt;/p&gt;
&lt;h3&gt;Recomenda√ß√£o&lt;/h3&gt;
&lt;p&gt;Finalmente, √© hora de recomendar um novo item aos seus usu√°rios. Assim que tivermos a Matriz de classifica√ß√µes previstas (R ^), fazer a recomenda√ß√£o √© uma quest√£o de selecionar e filtrar os itens previstos da seguinte forma:&lt;/p&gt;
&lt;p&gt;¬† ¬† ¬† ¬† ¬† &lt;strong&gt;1. Selecione os candidatos:&lt;/strong&gt; Selecione os itens cujas avalia√ß√µes foram previstas.
¬† ¬† ¬† ¬† ¬† &lt;strong&gt;2. Filtragem:&lt;/strong&gt; Defina um limite (por exemplo, 4,0) e exclua candidatos cujas classifica√ß√µes sejam inferiores a isso.
¬† ¬† ¬† ¬† ¬† &lt;strong&gt;3. Top N:&lt;/strong&gt; Classifica o resultado por classifica√ß√£o, estabelece o n√∫mero de recomenda√ß√µes (N) e apresenta ao usu√°rio.&lt;/p&gt;
&lt;p&gt;A figura abaixo ilustra o processo levando em considera√ß√£o o usu√°rio Victor listado na tabela anterior.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 25.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABRElEQVQY0yWQ20vCABjF/ZcLq4cIwqeee4iylCiESINIpLLULKEECbLyunkra87L5m5uRv7a1oED57vyfSdgaArK6Jt6pcxnT2RmKNi2zQIwDc2PW0KVtlDztWXqeLDtmRurqGOJjljHsabo0wmB5/qQ62KfVKHF5WOX/IuMZc/9oZ6kky5JJG4rLqvclAZ8DP4XGpbj9g65eupxftdwaxKl2ohALCuxdlBjI/rOerTGVrzPYKiiKUNyzxLBSIfgbpnV/aqruxQrYyx9jNCRCJ18s7TzxsreO8thgUhaJhB/kNk8ahA6fCF0XGf7QkLVLPid0+gpnN33iWeaJLKiq79o9aew+GGs6KSKMqcZgUROJJH/oPDqXnhdktlNttlPNgknRWK5Aab7Dr6HOqauMDOnPj3t5Tw4joOhTfy8ZXhUfQ//AF2oYQRryfDCAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;RecSys Filtering&quot;
        title=&quot;RecSys Filtering&quot;
        data-src=&quot;/static/6acaed139dbb707e59a1a7e9687f471f/d9199/recsys_filtering.png&quot;
        data-srcset=&quot;/static/6acaed139dbb707e59a1a7e9687f471f/8ff5a/recsys_filtering.png 240w,
/static/6acaed139dbb707e59a1a7e9687f471f/e85cb/recsys_filtering.png 480w,
/static/6acaed139dbb707e59a1a7e9687f471f/d9199/recsys_filtering.png 960w,
/static/6acaed139dbb707e59a1a7e9687f471f/c6ff8/recsys_filtering.png 1088w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Predi√ß√£o vs Recomenda√ß√£o&lt;/h2&gt;
&lt;p&gt;Voc√™ pode ler postagens que usam &lt;strong&gt;previs√£o&lt;/strong&gt; e &lt;strong&gt;recomenda√ß√£o&lt;/strong&gt; de forma intercambi√°vel, mas t√™m significados diferentes. &lt;strong&gt;Previs√£o&lt;/strong&gt; corresponde √† classifica√ß√£o esperada para um determinado item. Na fase de aprendizagem, seu modelo atribui classifica√ß√µes aos itens que o usu√°rio n√£o viu e essas classifica√ß√µes s√£o previs√µes. Por outro lado, &lt;strong&gt;recomenda√ß√£o&lt;/strong&gt; corresponde ao pr√≥prio item (ou conjunto de itens) que est√° sendo recomendado ao usu√°rio.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Getting Started with Recommender Systems: Part I]]></title><description><![CDATA[I have been studying Recommender Systems (RecSys) for the past few months. Many topics are scattered in the Internet and I thought about‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-08-13-Getting_Started_with_Recommender_Systems_Part_I/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-08-13-Getting_Started_with_Recommender_Systems_Part_I/</guid><pubDate>Tue, 13 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been studying Recommender Systems (RecSys) for the past few months. Many topics are scattered in the Internet and I thought about condensating the main concepts into a series of blog posts. For those of you who are interested in the subject, I organized the content and split into parts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Part I: Introduction and Levels of Personalization&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/en/blog/2019/2019-09-07-Getting_Started_with_Recommender_Systems_Part_II/&quot;&gt;Part II: How it Works&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Part III: Techniques&lt;/li&gt;
&lt;li&gt;Part IV: Metrics&lt;/li&gt;
&lt;li&gt;Part V: Challenges&lt;/li&gt;
&lt;li&gt;Part VI: References and Further Reading&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;RecSys is a topic of concern of big players like Amazon, Spotify, Netflix, Github and Linkedin. Mike McGuire in this &lt;a href=&quot;https://www.huffpostbrasil.com/2013/08/01/netflix-profiles_n_3685876.html&quot;&gt;post&lt;/a&gt; explains that companies have realized that ‚Äúif there‚Äôs not something else there surfacing that meets your interest beyond what you initially dialed in for, then you‚Äôre out‚Äù. In other words, companies are concerned with providing not only what the user is looking for but other items that meets the user‚Äôs preferences. At Amazon, for example, if you want to buy a Kindle the website will drive you to the product but will also show related items you might want like a charger and a waterproof cover.&lt;/p&gt;
&lt;p&gt;An interesting article from Standford, &lt;a href=&quot;https://www.researchgate.net/publication/12189991_When_Choice_is_Demotivating_Can_One_Desire_Too_Much_of_a_Good_Thing&quot;&gt;When Choice is Demotivating: Can One Desire Too Much of a Good Thing?&lt;/a&gt;, shows the negative impact of presenting too many options to customers.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAC6UlEQVQoz1WS+09TZxjH+78tmmn0N6MxXBS8jUHp6QUtmsVkm8nIiIZSKBMUJQa8obFqJ4gMiMzLNBSBttIKPbSDqgErlHPa0nM+Pm2Dxjf55v0+l3zzfd7ntehPfyP3xE7Kb2Vp8GfmB04QvfETibv16E9caMNWjI1lTG0VbewM2qibpN9B6oGT+ZtWorcaWRxUyIycQpe6RRu2kbtfQbR3H6879jL25y4mWn/kpWcP2QeHyNzdj/F5CSPznmygknzgIMGu3QR9u5i8sIPx1h944dnJuvRtParEoo842RRBXYJcoAb97wopFO9KtEA12r0KEUyAluLdlZMCK7FeB9HLCvE+hcWrToGDhSs2wt2nsORGFZL9x5n0/M6H24flPofaX8ub7rPM9DjI3t9PIZ0EPUXY6ybSYSPU7hLuINyhEPK4JHZIXiF4vhlLfkxBvVjHq8Y/WLley/OGFuK9R5n75VfCLU3ogW+CIW8z4U6FOREMeZ0iaBexpq986vzpokM7KzdreXbRzeqdwzzvdktcw8xVcdHXQNZ/gEJx5KJDXxNvuxpE1E7EZxPeWOLhErcy7WkSh+MKC9L0b90F/h84wviJNmI9xwg2t/Dm3OnvHEY8MrJX3qpNHHlkTK9CpM1V4m/bFaZbZWRdvsznOxWsDFSz4a9iub+S9XtVvL9exdrgIVnKwa8OZ31uQl02ZjtdAjtz4my2wyl5h+QVXnuKgqMn0R/WkBs6RuFRHYzUYw7XszV0XDZ9VH5AtWw5iSmCapdT3rueuK8R9ZKDpT4Xao+LuIyu/tVArN2JxcikMOXj6mmVmYUxJkMPCUwNsPYxAhsrFNYTmIW8YAszE5feRXGbYGvhBdrQNXLTIxIvlfObi1hMyqcg8EcnGFX/YyIRJJZeLuW369tnO9ZfTrH5+B/0Z6++67GYplEi2bxO5GMM9VOSd6tx0nq6LCB10zTLMIySpKFr5GZnyMei5KPzFNZWy71GgS8tGQKSZLv2agAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;When Choice is Demotivating - Experiment&quot;
        title=&quot;When Choice is Demotivating - Experiment&quot;
        data-src=&quot;/static/79e2ffaa80393025cae6e242117076b7/d9199/jams-conversion.png&quot;
        data-srcset=&quot;/static/79e2ffaa80393025cae6e242117076b7/8ff5a/jams-conversion.png 240w,
/static/79e2ffaa80393025cae6e242117076b7/e85cb/jams-conversion.png 480w,
/static/79e2ffaa80393025cae6e242117076b7/d9199/jams-conversion.png 960w,
/static/79e2ffaa80393025cae6e242117076b7/2ba99/jams-conversion.png 1221w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In fact, when there is no personalization your customers end up doing &lt;a href=&quot;https://www.youtube.com/watch?v=VqdQZCvpIyo&quot;&gt;‚Äúinfinite browsing‚Äù&lt;/a&gt; and there is no conversion and, consequently, a high level of churn. This &lt;a href=&quot;https://www.businessinsider.com/netflix-recommendation-engine-worth-1-billion-per-year-2016-6&quot;&gt;article&lt;/a&gt; from Business Insider explains how ‚Äúthe combined effect of personalization and recommendations save us [Netflix] more than $1B per year‚Äù.&lt;/p&gt;
&lt;p&gt;RecSys are valuable at &lt;a href=&quot;http://fortune.com/2012/07/30/amazons-recommendation-secret/&quot;&gt;increasing the sales&lt;/a&gt;. In 2012, Amazon has reported ‚Äúa 29% sales increase to $12.83 billion during its second fiscal quarter, up from $9.9 billion during the same time last year‚Äù. However, they are not limited to profit. &lt;a href=&quot;https://sigmoidal.io/recommender-systems-recommendation-engine/&quot;&gt;This infographic&lt;/a&gt; illustrates they also &lt;strong&gt;improve retention&lt;/strong&gt;, &lt;strong&gt;form habits&lt;/strong&gt; and &lt;strong&gt;accelerate work&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;Formal definition&lt;/h3&gt;
&lt;p&gt;So far we have seen RecSys as a general idea that mixes some topics like &lt;code class=&quot;language-text&quot;&gt;personalization&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;items&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;recommendation&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;user&amp;#39;s preferences&lt;/code&gt;. But, &lt;strong&gt;how can we define it?&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Recommender Systems are software tools and techniques that provide suggestions for items that are most likely of interest to a particular user.&lt;/p&gt;
&lt;p&gt;- F. Ricci, L. Rokach, B. Shapira, and P. B. Kantor, editors. Recommender Systems Handbook. Springera, 2011&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Levels of Personalization&lt;/h2&gt;
&lt;p&gt;In RecSys context, personalization means how much your algorithm understand each user to provide a meaningful recommendation. Basically, the approach can be understood as &lt;strong&gt;non-personalyzed&lt;/strong&gt; or &lt;strong&gt;personalyzed&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;Non-Personalized&lt;/h3&gt;
&lt;p&gt;Non-personalized RecSys do not take into consideration individual preferences. They usually consider an heuristic or statistical calc to recommend items. The most common scenario is the News websites like CNN, Bloomber, Globo.com, etc, in which there are sections like ‚ÄúBreaking news‚Äù or ‚ÄúFeatured‚Äù. In Spotify, ‚ÄúTop songs in Brazil‚Äù. Amazon, ‚ÄúTop-selling books‚Äù.&lt;/p&gt;
&lt;p&gt;Some examples:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Most listened songs&lt;/li&gt;
&lt;li&gt;Most read blog posts&lt;/li&gt;
&lt;li&gt;Breaking news articles&lt;/li&gt;
&lt;li&gt;Top tracks on the radio&lt;/li&gt;
&lt;li&gt;Top-selling books&lt;/li&gt;
&lt;li&gt;High-scored hotels&lt;/li&gt;
&lt;li&gt;Best places to stay&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The advantage of this approach is that it is not that expensive and is useful when you do not have enough information about your users. That way you can solve &lt;strong&gt;cold start problems&lt;/strong&gt; (explained in Part IV) and start doing recommendation without too much effort.&lt;/p&gt;
&lt;h3&gt;Personalized&lt;/h3&gt;
&lt;p&gt;The personalyzed approach considers the user‚Äôs preferences to recommend an item. Algorithms in this category rely on a pipeline that (i) takes user‚Äôs data; (ii) does processing to find patterns in the preferences; (iii) calc predictions. &lt;em&gt;Disclaimer: in Part II and III it will be crystal clear.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The most common example is Netflix. Based on the titles you liked, Netflix does a lot of processing and recommends you new movies or series.&lt;/p&gt;
&lt;p&gt;The advantage of this approach is the level of personalization you can achieve and, thus, increase the convertion in your system. However, it takes much more effort than the previous one and, of course, requires a more complex solution/algorithm/architecture.&lt;/p&gt;
&lt;h3&gt;Notes&lt;/h3&gt;
&lt;p&gt;There is no silver bullet. The best approach is the one that works for you business. It is pretty common to adopt both approaches in the same platform/website/system. For example, Spotify provides those ‚ÄúTop Lists‚Äù but also does a personalized approach when recommending you a song similar to the one you are listening to.&lt;/p&gt;
&lt;p&gt;A golden rule is to think about the whole experience and what you want to achieve: more sales; retention increase; form a habit; etc. Once you have defined your goal, the Metrics, algorithms and technical decisions will relate to that and mixed approaches are very common.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Iniciando com Sistemas de Recomenda√ß√£o: Parte I]]></title><description><![CDATA[Tenho estudado Sistemas de Recomenda√ß√£o (RecSys) nos √∫ltimos meses. Muitos t√≥picos est√£o espalhados pela Internet e pensei em condensar os‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-08-13-Iniciando_com_sistemas_de_recomendacao_parte_I/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-08-13-Iniciando_com_sistemas_de_recomendacao_parte_I/</guid><pubDate>Tue, 13 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Tenho estudado Sistemas de Recomenda√ß√£o (RecSys) nos √∫ltimos meses. Muitos t√≥picos est√£o espalhados pela Internet e pensei em condensar os principais conceitos em uma s√©rie de postagens de blog. Para voc√™s interessados ‚Äã‚Äãno assunto, organizei o conte√∫do e dividi em partes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Parte I: Introdu√ß√£o e n√≠veis de personaliza√ß√£o&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;pt/blog/2019/2019-09-07-Getting_Started_with_Recommender_Systems_Part_II/&quot;&gt;Parte II: Como funciona&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Parte III: T√©cnicas&lt;/li&gt;
&lt;li&gt;Parte IV: M√©tricas&lt;/li&gt;
&lt;li&gt;Parte V: Desafios&lt;/li&gt;
&lt;li&gt;Parte VI: Refer√™ncias e leituras adicionais&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Introdu√ß√£o&lt;/h2&gt;
&lt;p&gt;RecSys √© um tema de interesse de grandes empresas como Amazon, Spotify, Netflix, Github e Linkedin. Mike McGuire neste &lt;a href=&quot;https://www.huffpostbrasil.com/2013/08/01/netflix-profiles_n_3685876.html&quot;&gt;post&lt;/a&gt; explica que as empresas perceberam que ‚Äúif there‚Äôs not something else there surfacing that meets your interest beyond what you initially dialed in for, then you‚Äôre out‚Äù. Em outras palavras, as empresas se preocupam em fornecer n√£o apenas o que o usu√°rio procura, mas outros itens que atendam √†s suas prefer√™ncias. Na Amazon, por exemplo, se voc√™ quiser comprar um Kindle o site o levar√° ao produto, mas tamb√©m mostrar√° itens relacionados que voc√™ pode querer, como um carregador e uma capa √† prova d‚Äô√°gua.&lt;/p&gt;
&lt;p&gt;Um artigo interessante de Standford, &lt;a href=&quot;Https://www.researchgate.net/publication/12189991_When_Choice_is_Demotivating_Can_One_Desire_Too_Much_of_a_Good_Thing&quot;&gt;When Choice is Demotivating: Can One Desire Much of a Good Thing?&lt;/a&gt;, mostra o impacto negativo de apresentar muitas op√ß√µes aos clientes.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAC6UlEQVQoz1WS+09TZxjH+78tmmn0N6MxXBS8jUHp6QUtmsVkm8nIiIZSKBMUJQa8obFqJ4gMiMzLNBSBttIKPbSDqgErlHPa0nM+Pm2Dxjf55v0+l3zzfd7ntehPfyP3xE7Kb2Vp8GfmB04QvfETibv16E9caMNWjI1lTG0VbewM2qibpN9B6oGT+ZtWorcaWRxUyIycQpe6RRu2kbtfQbR3H6879jL25y4mWn/kpWcP2QeHyNzdj/F5CSPznmygknzgIMGu3QR9u5i8sIPx1h944dnJuvRtParEoo842RRBXYJcoAb97wopFO9KtEA12r0KEUyAluLdlZMCK7FeB9HLCvE+hcWrToGDhSs2wt2nsORGFZL9x5n0/M6H24flPofaX8ub7rPM9DjI3t9PIZ0EPUXY6ybSYSPU7hLuINyhEPK4JHZIXiF4vhlLfkxBvVjHq8Y/WLley/OGFuK9R5n75VfCLU3ogW+CIW8z4U6FOREMeZ0iaBexpq986vzpokM7KzdreXbRzeqdwzzvdktcw8xVcdHXQNZ/gEJx5KJDXxNvuxpE1E7EZxPeWOLhErcy7WkSh+MKC9L0b90F/h84wviJNmI9xwg2t/Dm3OnvHEY8MrJX3qpNHHlkTK9CpM1V4m/bFaZbZWRdvsznOxWsDFSz4a9iub+S9XtVvL9exdrgIVnKwa8OZ31uQl02ZjtdAjtz4my2wyl5h+QVXnuKgqMn0R/WkBs6RuFRHYzUYw7XszV0XDZ9VH5AtWw5iSmCapdT3rueuK8R9ZKDpT4Xao+LuIyu/tVArN2JxcikMOXj6mmVmYUxJkMPCUwNsPYxAhsrFNYTmIW8YAszE5feRXGbYGvhBdrQNXLTIxIvlfObi1hMyqcg8EcnGFX/YyIRJJZeLuW369tnO9ZfTrH5+B/0Z6++67GYplEi2bxO5GMM9VOSd6tx0nq6LCB10zTLMIySpKFr5GZnyMei5KPzFNZWy71GgS8tGQKSZLv2agAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;When Choice is Demotivating - Experiment&quot;
        title=&quot;When Choice is Demotivating - Experiment&quot;
        data-src=&quot;/static/79e2ffaa80393025cae6e242117076b7/d9199/jams-conversion.png&quot;
        data-srcset=&quot;/static/79e2ffaa80393025cae6e242117076b7/8ff5a/jams-conversion.png 240w,
/static/79e2ffaa80393025cae6e242117076b7/e85cb/jams-conversion.png 480w,
/static/79e2ffaa80393025cae6e242117076b7/d9199/jams-conversion.png 960w,
/static/79e2ffaa80393025cae6e242117076b7/2ba99/jams-conversion.png 1221w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Na verdade, quando n√£o h√° personaliza√ß√£o seus clientes acabam fazendo &lt;a href=&quot;https://www.youtube.com/watch?v=VqdQZCvpIyo&quot;&gt;‚Äúnavega√ß√£o infinita‚Äù&lt;/a&gt; (&lt;em&gt;infinite browsing&lt;/em&gt;) e n√£o h√° convers√£o e, consequentemente, um alto n√≠vel de churn. Este &lt;a href=&quot;https://www.businessinsider.com/netflix-recommendation-engine-worth-1-billion-per-year-2016-6&quot;&gt;artigo&lt;/a&gt; do Business Insider explica como ‚Äúo efeito combinado da personaliza√ß√£o e das recomenda√ß√µes economiza mais de $ 1B por ano da Netflix‚Äù.&lt;/p&gt;
&lt;p&gt;RecSys s√£o valiosos em &lt;a href=&quot;http://fortune.com/2012/07/30/amazons-recommendation-secret/&quot;&gt;aumentar as vendas&lt;/a&gt;. Em 2012, a Amazon relatou ‚Äúum aumento nas vendas de 29% para US$ 12,83 bilh√µes durante seu segundo trimestre fiscal, ante US$ 9,9 bilh√µes durante o mesmo per√≠odo do ano passado‚Äù. No entanto, eles n√£o se limitam ao lucro. &lt;a href=&quot;https://sigmoidal.io/recommender-systems-recommendation-engine/&quot;&gt;Este infogr√°fico&lt;/a&gt; ilustra que esses sistemas tamb√©m &lt;strong&gt;melhoram a reten√ß√£o&lt;/strong&gt;, &lt;strong&gt;formam h√°bitos&lt;/strong&gt; e &lt;strong&gt;aceleram o trabalho&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;Defini√ß√£o formal&lt;/h3&gt;
&lt;p&gt;At√© agora vimos o RecSys como uma ideia geral que mistura alguns t√≥picos como &lt;code class=&quot;language-text&quot;&gt;personaliza√ß√£o&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;itens&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;recomenda√ß√£o&lt;/code&gt; e&lt;code class=&quot;language-text&quot;&gt;prefer√™ncias do usu√°rio&lt;/code&gt;. Mas, &lt;strong&gt;como podemos defin√≠-lo?&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Recommender Systems are software tools and techniques that provide suggestions for items that are most likely of interest to a particular user.&lt;/p&gt;
&lt;p&gt;- F. Ricci, L. Rokach, B. Shapira, and P. B. Kantor, editors. Recommender Systems Handbook. Springera, 2011&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Em tradu√ß√£o livre, Sistemas de Recomenda√ß√£o s√£o ferramentas e t√©cnicas de software que fornecem sugest√µes para itens que provavelmente s√£o do interesse de um usu√°rio espec√≠fico.&lt;/p&gt;
&lt;h2&gt;N√≠veis de Personaliza√ß√£o&lt;/h2&gt;
&lt;p&gt;No contexto do RecSys, personaliza√ß√£o significa o quanto seu algoritmo entende cada usu√°rio para fornecer uma recomenda√ß√£o significativa. Basicamente, a abordagem pode ser entendida como &lt;strong&gt;n√£o personalizada&lt;/strong&gt; ou &lt;strong&gt;personalizada&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;N√£o personalizado&lt;/h3&gt;
&lt;p&gt;RecSys n√£o personalizado n√£o leva em considera√ß√£o prefer√™ncias individuais. Eles geralmente consideram um c√°lculo heur√≠stico ou estat√≠stico para recomendar itens. O cen√°rio mais comum s√£o os sites de Not√≠cias como CNN, Bloomber, Globo.com, etc, em que h√° se√ß√µes como ‚ÄúNot√≠cias de √∫ltima hora‚Äù ou ‚ÄúEm destaque‚Äù. No Spotify, ‚ÄúMelhores m√∫sicas do Brasil‚Äù. Amazon, ‚ÄúLivros mais vendidos‚Äù.&lt;/p&gt;
&lt;p&gt;Alguns exemplos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;M√∫sicas mais ouvidas&lt;/li&gt;
&lt;li&gt;Postagens de blog mais lidas&lt;/li&gt;
&lt;li&gt;Artigos de not√≠cias de √∫ltima hora&lt;/li&gt;
&lt;li&gt;Principais faixas do r√°dio&lt;/li&gt;
&lt;li&gt;Livros mais vendidos&lt;/li&gt;
&lt;li&gt;Hot√©is com pontua√ß√£o elevada&lt;/li&gt;
&lt;li&gt;Melhores lugares para ficar&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A vantagem dessa abordagem √© que ela n√£o √© t√£o cara e √© √∫til quando voc√™ n√£o tem informa√ß√µes suficientes sobre os usu√°rios. Dessa forma, voc√™ pode resolver &lt;strong&gt;problemas de partida a frio&lt;/strong&gt; (explicados na Parte IV) e come√ßar a fazer recomenda√ß√µes sem muito esfor√ßo.&lt;/p&gt;
&lt;h3&gt;Personalizado&lt;/h3&gt;
&lt;p&gt;A abordagem personalizada considera as prefer√™ncias do usu√°rio para recomendar um item. Os algoritmos nesta categoria dependem de um pipeline que (i) obt√©m os dados do usu√°rio; (ii) faz processamento para encontrar padr√µes nas prefer√™ncias; (iii) calcula previs√µes. &lt;em&gt;Disclaimer: na Parte II e III esses conceitos ficar√£o mais claros.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;O exemplo mais comum √© a Netflix. Com base nos t√≠tulos de que voc√™ gostou, a Netflix processa e recomenda novos filmes ou s√©ries.&lt;/p&gt;
&lt;p&gt;A vantagem desta abordagem √© o n√≠vel de personaliza√ß√£o que voc√™ pode alcan√ßar e, assim, aumentar a convers√£o em seu sistema. No entanto, √© preciso muito mais esfor√ßo do que o anterior e, √© claro, requer uma solu√ß√£o / algoritmo / arquitetura mais complexa.&lt;/p&gt;
&lt;h3&gt;Notas&lt;/h3&gt;
&lt;p&gt;N√£o h√° bala de prata. A melhor abordagem √© aquela que funciona para o seu neg√≥cio. √â bastante comum adotar ambas as abordagens na mesma plataforma / site / sistema. Por exemplo, o Spotify fornece essas ‚ÄúListas principais‚Äù, mas tamb√©m faz uma abordagem personalizada ao recomendar uma m√∫sica semelhante √† que voc√™ est√° ouvindo.&lt;/p&gt;
&lt;p&gt;Uma regra de ouro √© pensar em toda a experi√™ncia e no que voc√™ deseja alcan√ßar: mais vendas; aumento de reten√ß√£o; formar um h√°bito; Depois de definir seu objetivo, as m√©tricas, algoritmos e decis√µes t√©cnicas estar√£o relacionadas. Abordagens mistas s√£o muito comuns.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Cr√≠tica: Cloud Native DevOps with Kubernetes]]></title><description><![CDATA[Particularmente, eu gosto do conte√∫do produzido pela O‚ÄôReilly e Cloud Native DevOps with Kubernetes n√£o √© uma exce√ß√£o. Depois de tentar‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-08-04-Critica_Cloud_Native_DevOps_with_Kubernetes/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-08-04-Critica_Cloud_Native_DevOps_with_Kubernetes/</guid><pubDate>Sun, 04 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Particularmente, eu gosto do conte√∫do produzido pela O‚ÄôReilly e &lt;a href=&quot;https://www.amazon.com.br/Cloud-Native-DevOps-Kubernetes-Applications-ebook/dp/B07PJ4HM92&quot;&gt;Cloud Native DevOps with Kubernetes&lt;/a&gt; n√£o √© uma exce√ß√£o. Depois de tentar alguns livros e cursos eu encontrei um apanhado completo do Kubernetes no material escrito por John Arundel e Justin Domingus.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 752px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABYklEQVQoz52Sy0oCYRTHfZceoBco27XJAnXRK0SEmQltolr4CO2DIKGtkrcZ0AHHZiaIynE08kpjDhojiFk4l3/jUGA2X2B/+Djn8B1+nJsLUzJN036232gDUhV4/4CTvvNm5SIBq6UyHngBrXodJVEEz3EQi0WUJQm6rhOhRCCbzyOTySCdSoHJZiHwPFKJJKh0+s8qicBcLodYPI6sZSmaBk3RuLJipdP5kTsLJbfM3eA2lsR9gkKN5dGqPOLFgmkwf+USgdNt6LICU6oBgze8Vp7QfW7j4uwcp4cRdJTe/BV2ez1wgoBwKATvmgfLS274Fhah3kn2v6EbjnN0OVU3Go1QYAsIbG3D7/Fg1b2CvZ0ABu2v+RnG/EsROB4Fa9MT+MF+GMHd4P/ucKJ+X7XPZKLLaBTe9Q0wDANN06CqKobDIXExjsDxeGzba5bFps+Pk6NjO5ZlGc1G0zodhQj8BN3yNPRctY2aAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Cloud Native DevOps Kubernetes Applications&quot;
        title=&quot;Cloud Native DevOps Kubernetes Applications&quot;
        data-src=&quot;/static/8c8947a7d2884a594bc9f335425353a1/442cb/featured.png&quot;
        data-srcset=&quot;/static/8c8947a7d2884a594bc9f335425353a1/8ff5a/featured.png 240w,
/static/8c8947a7d2884a594bc9f335425353a1/e85cb/featured.png 480w,
/static/8c8947a7d2884a594bc9f335425353a1/442cb/featured.png 752w&quot;
        sizes=&quot;(max-width: 752px) 100vw, 752px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Os autores fizeram um trabalho maravilhoso com este livro cobrindo uma larga gama de t√≥picos. Ele come√ßa com uma vis√£o geral da Revolu√ß√£o Cloud seguido pelos primeiros passos com o Kubernetes. Ent√£o, √† medida que voc√™ l√™, o livro alcan√ßa amplos t√≥picos como Gerenciamento do Cluster e de Recursos, Ciclo de Vida dos Pods, ConfigMaps e Secrets, Seguran√ßa e Backups, Helm, Deployment Cont√≠nuo, Observabilidade, Monitoramento, M√©tricas, RBAC, etc.&lt;/p&gt;
&lt;p&gt;Al√©m dos t√≥picos mencionados acima, o livro preocupa-se com tr√™s aspectos: (i) as melhores pr√°ticas; (ii) a arquitetura interna da plataforma; (iii) ferramentas. Qualquer que seja seu n√≠vel de especialidade, definitivamente existe alguma coisa √∫til para aprender. √â por isso que voc√™ deveria dar uma olhada no livro ainda que voc√™ se considere um profissional avan√ßado no assunto. Todavia, se voc√™ tem conhecimentos avan√ßados em Kubernetes pode ser que voc√™ queira checar outras fontes relacionadas aos t√≥picos espec√≠ficos do seu interesse ou apenas fazer uma leitura din√¢mica para os assuntos que voc√™ n√£o est√° t√£o confort√°vel.&lt;/p&gt;
&lt;p&gt;Voc√™ pode estar se perguntando se este √© um livro te√≥rico ou pr√°tico. Os autores tentaram balacear ao prover exemplos pr√°ticos que voc√™ pode seguir. Entretanto, eu entendo que n√£o √© poss√≠vel fornecer exerc√≠cios pr√°ticos para todos os t√≥picos e nem mesmo √© o objetivo do livro. Portanto, √© importante que o leitor ‚Äúse vire‚Äù quando for o caso.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Review: Cloud Native DevOps with Kubernetes]]></title><description><![CDATA[Particularly, I like the content produced by O‚ÄôReilly media and Cloud Native DevOps with Kubernetes is not an exception. After trying some‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-08-04-Review_Cloud_Native_DevOps_with_Kubernetes/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-08-04-Review_Cloud_Native_DevOps_with_Kubernetes/</guid><pubDate>Sun, 04 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Particularly, I like the content produced by O‚ÄôReilly media and &lt;a href=&quot;https://www.amazon.com.br/Cloud-Native-DevOps-Kubernetes-Applications-ebook/dp/B07PJ4HM92&quot;&gt;Cloud Native DevOps with Kubernetes&lt;/a&gt; is not an exception. After trying some books and courses I found a complete overview of Kubernetes in that material produced by John Arundel and Justin Domingus.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 752px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABYklEQVQoz52Sy0oCYRTHfZceoBco27XJAnXRK0SEmQltolr4CO2DIKGtkrcZ0AHHZiaIynE08kpjDhojiFk4l3/jUGA2X2B/+Djn8B1+nJsLUzJN036232gDUhV4/4CTvvNm5SIBq6UyHngBrXodJVEEz3EQi0WUJQm6rhOhRCCbzyOTySCdSoHJZiHwPFKJJKh0+s8qicBcLodYPI6sZSmaBk3RuLJipdP5kTsLJbfM3eA2lsR9gkKN5dGqPOLFgmkwf+USgdNt6LICU6oBgze8Vp7QfW7j4uwcp4cRdJTe/BV2ez1wgoBwKATvmgfLS274Fhah3kn2v6EbjnN0OVU3Go1QYAsIbG3D7/Fg1b2CvZ0ABu2v+RnG/EsROB4Fa9MT+MF+GMHd4P/ucKJ+X7XPZKLLaBTe9Q0wDANN06CqKobDIXExjsDxeGzba5bFps+Pk6NjO5ZlGc1G0zodhQj8BN3yNPRctY2aAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Cloud Native DevOps Kubernetes Applications&quot;
        title=&quot;Cloud Native DevOps Kubernetes Applications&quot;
        data-src=&quot;/static/8c8947a7d2884a594bc9f335425353a1/442cb/featured.png&quot;
        data-srcset=&quot;/static/8c8947a7d2884a594bc9f335425353a1/8ff5a/featured.png 240w,
/static/8c8947a7d2884a594bc9f335425353a1/e85cb/featured.png 480w,
/static/8c8947a7d2884a594bc9f335425353a1/442cb/featured.png 752w&quot;
        sizes=&quot;(max-width: 752px) 100vw, 752px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The authors have done wonderful work with this book by covering a wide range of topics. It starts with a general overview of the Cloud Revolution followed by the first steps with Kubernetes. Then, as you keep reading it gets to broad topics like Resource and Cluster Management, Pods Lifecycle, ConfigMaps and Secrets, Security and Backups, Helm, Continuous Deployment, Observability, Monitoring, Metrics, RBAC, etc.&lt;/p&gt;
&lt;p&gt;Besides the topics aforementioned, the book is concerned with three aspects: (i) the best practices; (ii) the internal architecture of the platform; (iii) tooling. Whatever your level of expertise, definitely there is something useful to learn. That‚Äôs why you should take a look even if you consider yourself an advanced professional at the matter. Nonetheless, if you have advanced expertise with Kubernetes you might want to check other sources related to the specific topics you are interested in or to do a dynamic reading looking for the subjects you are not comfortable with.&lt;/p&gt;
&lt;p&gt;You might be wondering if it is a theoretical or practical book. The authors have tried to balance between them by providing examples to follow along. However, I understand it is not possible to provide practical exercises for every topic and it is not even the goal of the book. Therefore, it is important for the reader to work out on that matter when it is suitable.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Criando scripts de linha de comando √† prova de balas]]></title><description><![CDATA[A vida de um desenvolvedor back-end envolve a cria√ß√£o de alguns scripts para serem executados no ambiente de produ√ß√£o. Por exemplo, voc√™‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-05-18-Criando_scripts_de_linha_de_comando_a_prova_de_balas/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-05-18-Criando_scripts_de_linha_de_comando_a_prova_de_balas/</guid><pubDate>Sat, 18 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A vida de um desenvolvedor back-end envolve a cria√ß√£o de alguns scripts para serem executados no ambiente de produ√ß√£o. Por exemplo, voc√™ pode precisar atualizar muitos registros de uma vez, acionar eventos ou corrigir um bug espec√≠fico. &lt;em&gt;O que eles t√™m em comum?&lt;/em&gt; Se n√£o forem projetados corretamente, podem causar um efeito colateral muito ruim na aplica√ß√£o, arruinar a experi√™ncia do usu√°rio, etc.&lt;/p&gt;
&lt;p&gt;No cen√°rio do mundo real, algumas mudan√ßas s√£o ~praticamente~ imposs√≠veis de reverter:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Acionar e-mails / notifica√ß√µes / mensagens / SMSs para clientes&lt;/li&gt;
&lt;li&gt;Fornecer, acidentalmente, um desconto a um usu√°rio (ou muitos)&lt;/li&gt;
&lt;li&gt;Atualizar de registros sem backup&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Como desenvolvedores, precisamos n√£o apenas verificar novamente nossos scripts, mas tamb√©m fazer o nosso melhor para minimizar / evitar poss√≠veis efeitos colaterais (especialmente se algo inesperado acontecer). Algumas semanas atr√°s, durante uma sess√£o pair programming, [Elias] (&lt;a href=&quot;https://etandel.xyz&quot;&gt;https://etandel.xyz&lt;/a&gt;) e eu criamos um cr√≠tico &lt;a href=&quot;https://docs.djangoproject.com/en/2.2/howto/custom-management-command/&quot;&gt;comando Django&lt;/a&gt; respons√°vel por alterar registros em muitas tabelas de acordo com uma l√≥gica de neg√≥cios. √Ä medida que mergulh√°vamos nas partes intr√≠nsecas do script, percebemos o qu√£o perigoso isso poderia ser e tomamos alguns cuidados que s√£o compartilhados neste post.&lt;/p&gt;
&lt;h2&gt;Barras de progresso s√£o fant√°sticas!&lt;/h2&gt;
&lt;p&gt;Executar um script que leva muito tempo para ser conclu√≠do √© desesperador. Voc√™ fica confuso porque n√£o sabe o que est√° acontecendo: (i) ainda est√° funcionando? (ii) a conex√£o est√° desligada? √â por isso que um senso de progresso √© importante. Se voc√™ √© um programador Python, alguns projetos como &lt;a href=&quot;https://github.com/tqdm/tqdm&quot;&gt;tqdm&lt;/a&gt; e &lt;a href=&quot;https://github.com/kennethreitz/clint&quot;&gt;clint&lt;/a&gt; podem ajud√°-lo fornecendo maneiras de criar barras de progresso. De qualquer forma, se isso exigir muito esfor√ßo ou se sua linguagem de programa√ß√£o n√£o ajudar voc√™ com isso, um simples indicador &lt;code class=&quot;language-text&quot;&gt;&amp;lt;accomplished&amp;gt; / &amp;lt;total&amp;gt;&lt;/code&gt; √© um bom come√ßo, pelo menos.&lt;/p&gt;
&lt;h2&gt;Logging&lt;/h2&gt;
&lt;p&gt;Depois de executar um script, as coisas acontecem:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Voc√™ n√£o tem certeza do que foi feito; Alguns dias depois, como voc√™ se lembra?&lt;/li&gt;
&lt;li&gt;Voc√™ n√£o ter√° 100% de certeza sobre os registros que foram atualizados;&lt;/li&gt;
&lt;li&gt;Qualquer revers√£o exigir√° um backup espec√≠fico;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Al√©m disso, pense no cen√°rio em que seu script tem um bug inesperado ou os registros que voc√™ atualiza n√£o est√£o consistentemente alinhados √† l√≥gica de neg√≥cios. &lt;em&gt;Qu√£o f√°cil √© reverter os efeitos colaterais?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Toda dor acima mencionada pode ser atenuada se voc√™ simplesmente registrar as altera√ß√µes. Voc√™ pode criar um arquivo simples que armazena: (i) a id dos registros que voc√™ atualizou; (ii) o valor da coluna anterior; (iii) o novo valor. Dessa forma, se algo inesperado acontecer, voc√™ pode facilmente analisar o log, obter os registros que alterou e definir os valores antigos de volta sem ter que carregar um backup.&lt;/p&gt;
&lt;h2&gt;Auto-verifica√ß√£o&lt;/h2&gt;
&lt;p&gt;E se o seu script pudesse verificar inconsist√™ncias durante a execu√ß√£o? Pouco antes da conclus√£o, ele pode analisar o log e verificar se os novos registros s√£o consistentes com a l√≥gica de neg√≥cios.&lt;/p&gt;
&lt;p&gt;Vamos supor, por exemplo, que voc√™ precise multiplicar o saldo de v√°rios usu√°rios por um fator. Como voc√™ √© cauteloso, seu script produz o seguinte registro:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;id; antigo; novo
10987; 10; 100
98011; 5; 50
87652; 3; 35&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;O √∫ltimo registro n√£o est√° correto porque o novo saldo ultrapassa em 5 o valor esperado (30). Nesse caso, uma exce√ß√£o pode ser lan√ßada para reverter todas as altera√ß√µes.&lt;/p&gt;
&lt;h2&gt;Rollback&lt;/h2&gt;
&lt;p&gt;Especialmente ao lidar com registros de banco de dados, voc√™ deve garantir que uma pol√≠tica de tudo-ou-nada seja seguida: ou todas as altera√ß√µes s√£o persistidas ou nada √© feito. Use uma transa√ß√£o de banco de dados para fazer isso, pois no caso de qualquer erro o rollback ser√° executado.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atomic&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your_code_goes_here&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Dry-run&lt;/h2&gt;
&lt;p&gt;Sempre que poss√≠vel, forne√ßa uma op√ß√£o &lt;code class=&quot;language-text&quot;&gt;dry-run&lt;/code&gt;. Dessa forma as altera√ß√µes n√£o s√£o confirmadas e √© poss√≠vel verificar se h√° erros no tempo de execu√ß√£o. Se voc√™ usa o framework Django, por exemplo, seu comando pode reverter todas as mudan√ßas se &lt;code class=&quot;language-text&quot;&gt;dry-run&lt;/code&gt; for passado como argumento:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atomic&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    dry_run &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; kwargs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;dry_run&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; dry_run&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set_rollback&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Tmux&lt;/h2&gt;
&lt;p&gt;E se sua conex√£o for perdida durante a execu√ß√£o? Isso pode ser muito ruim, hein? √â por isso que √© recomendado usar um multiplexador de Terminal como o tmux (d√° uma olhada neste &lt;a href=&quot;https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/&quot;&gt;tutorial&lt;/a&gt;). √â realmente √∫til porque voc√™ pode iniciar tarefas de longa execu√ß√£o em seu servidor remoto e mant√™-las em execu√ß√£o mesmo que sua conex√£o seja perdida.&lt;/p&gt;
&lt;h2&gt;Revis√£o de c√≥digo&lt;/h2&gt;
&lt;p&gt;Cada c√≥digo que vai para a produ√ß√£o deve ser revisado por outro programador. Os scripts n√£o s√£o exce√ß√£o. Ponto final.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Creating bulletproof command-line scripts]]></title><description><![CDATA[The life of a backend developer involves creating some scripts to be executed in the production environment. For instance, you might need to‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-05-18-Creating_bulletproof_command_line_scripts/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-05-18-Creating_bulletproof_command_line_scripts/</guid><pubDate>Sat, 18 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;The life of a backend developer involves creating some scripts to be executed in the production environment. For instance, you might need to update many records at once, trigger events or fix a specific bug. &lt;em&gt;What do they have in common?&lt;/em&gt; If not designed properly, they can cause a very bad side-effect on your application, ruin the user experience, etc.&lt;/p&gt;
&lt;p&gt;In the real-world scenario some changes are ~pratically~ impossible to revert:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Triggering emails / notifications / messages / SMSs to customers&lt;/li&gt;
&lt;li&gt;Accidentally giving an offer to a user&lt;/li&gt;
&lt;li&gt;Updating records without a backup&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;As developers we need not only to double check our scripts but also do our best to minimize/avoid possible side-effects (especially if something unexpected happen). Some weeks ago, during a pair programming session, &lt;a href=&quot;https://etandel.xyz&quot;&gt;Elias&lt;/a&gt; and I created a critical &lt;a href=&quot;https://docs.djangoproject.com/en/2.2/howto/custom-management-commands/&quot;&gt;Django command&lt;/a&gt; responsible for changing records on many tables according to a business logic. As we dove into the instrinsic parts of the script, we realised how dangerous that could be and took some precautions shared in this post.&lt;/p&gt;
&lt;h2&gt;Progress Bars are awesome!&lt;/h2&gt;
&lt;p&gt;Running a script that takes too much time to complete is nerve-racking. You get confused because you do not know what is happening: (i) is it still running? (ii) is the connection down? That‚Äôs why a sense of progress is important. If you are a python programmer some projects like &lt;a href=&quot;https://github.com/tqdm/tqdm&quot;&gt;tqdm&lt;/a&gt; and &lt;a href=&quot;https://github.com/kennethreitz/clint&quot;&gt;clint&lt;/a&gt; can help you by providing ways to create progress bars. Anyway, if that is too much effort or your programming language does not help you with that, a simple &lt;code class=&quot;language-text&quot;&gt;&amp;lt;accomplished&amp;gt;/&amp;lt;total&amp;gt;&lt;/code&gt; indicator is a good start, at least.&lt;/p&gt;
&lt;h2&gt;Logging&lt;/h2&gt;
&lt;p&gt;After running a script, things happen:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You are not sure what was done; Some days later, how do you recall?&lt;/li&gt;
&lt;li&gt;You won‚Äôt be 100% sure about the records that were updated;&lt;/li&gt;
&lt;li&gt;Any rollback will require an specific backup;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Besides, think of the scenario in which your script has an unexpected bug or the records you update are not consistent aligned to the business logic. &lt;em&gt;How easy is it to revert the side effects?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;All the pain aforementioned can be attenuated if you simply log the changes. You can create a simple file that stores: (i) the id of the records you updated; (ii) the previous column value; (iii) the new value. That way, if something unexpected happens you can easily parse the log, obtain the records you changed and set the old values back without having to load a backup.&lt;/p&gt;
&lt;h2&gt;Self-check&lt;/h2&gt;
&lt;p&gt;What if your script could check for inconsistencies during the execution? Just before the completion, it could parse the log and check whether the new records are consistent to the business logic.&lt;/p&gt;
&lt;p&gt;Let‚Äôs suppose, for instance, you need to multiply the balance of several users by a factor. As you are cautious, your script produces the following log:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;id;old;new
10987;10;100
98011;5;50
87652;3;35&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The last record is not correct because the new balance exceeds by 5 the expected value (30). In that case, an Exception can be thrown in order to rollback all the changes.&lt;/p&gt;
&lt;h2&gt;Rollback&lt;/h2&gt;
&lt;p&gt;Especially when handling database records, you must ensure that an all-or-nothing policy will be followed: either all changes are persisted or nothing is done. Use a database transaction to accomplish that because in the event of any error the rollback will be performed.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atomic&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your_code_goes_here&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Dry-run&lt;/h2&gt;
&lt;p&gt;As often as possible provide a &lt;code class=&quot;language-text&quot;&gt;dry-run&lt;/code&gt; option. That way the changes are not commited and it is possible to check for errors in the execution time. If you use Django framework, for example, your command can rollback all the changes if &lt;code class=&quot;language-text&quot;&gt;dry-run&lt;/code&gt; is passed as argument:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;atomic&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    dry_run &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; kwargs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;dry_run&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; dry_run&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        transaction&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set_rollback&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Tmux&lt;/h2&gt;
&lt;p&gt;What if your connection gets lost during the execution? That can be really bad, huh? That‚Äôs why it is recommended to use a Terminal multiplexer like tmux (check this &lt;a href=&quot;https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/&quot;&gt;tutorial&lt;/a&gt;). It is really useful because you can start long-running tasks on your remote server and keep them running even though your connection is lost.&lt;/p&gt;
&lt;h2&gt;Code Review&lt;/h2&gt;
&lt;p&gt;Every code going to production should be reviewed by other programmer. Scripts are no exception. Period.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Tips on Coding / Technical Challenges]]></title><description><![CDATA[It is common for Software Engineers/Programmers/Developers to face a coding / technical challenge in recruitment processes. The challenge‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-04-28-Tips_on_coding_challenges/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-04-28-Tips_on_coding_challenges/</guid><pubDate>Sun, 28 Apr 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;It is common for Software Engineers/Programmers/Developers to face a coding / technical challenge in recruitment processes. The challenge consists of programming assignments designed to exam candidates mainly regarding hard skills (e.g. programming ability, architectural design, etc). Usually, the process is comprised of three phases: (i) specification; (ii) development; (iii) review. There are idiosyncrasies and tips for each of them.&lt;/p&gt;
&lt;p&gt;After going through coding challenges and, especially, reviewing some of them at &lt;a href=&quot;www.onyo.com&quot;&gt;Onyo&lt;/a&gt; I decided to write this post and share some lessons that I have learned.&lt;/p&gt;
&lt;h2&gt;Specification&lt;/h2&gt;
&lt;p&gt;The candidate receives an e-mail or document specifying the challenge scope. It usually lists the requirements, constraints and do/don‚Äôts that must be followed. If you are a back-end developer, for example, you might be asked to develop a REST/GraphQL API, a SaaS or an integration with third-party provider. &lt;strong&gt;The key to succeed is to be very attentive to what you have to do. Planning the execution is vital.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;Read carefully the specification&lt;/h3&gt;
&lt;p&gt;Do not assume anything regarding what you have to do. Take a time to read every every line of the document and pay attention to &lt;strong&gt;the requirements&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;Plan the execution&lt;/h3&gt;
&lt;p&gt;At first differentiate what is a &lt;strong&gt;must&lt;/strong&gt; from what is a &lt;strong&gt;nice to have&lt;/strong&gt;. Plus, think about what libraries you are going to use and how you are going to architect your code. Besides, it is important to sketch out a plan preferably regarding your deliverables. Stablish steps/phases that are going to be iterated, for instance: (i) set up the project; (ii) CRUD; (iii) business logic 1; (iv) business logic 2; and so on. That way you reduce the risk of not achieving a running project.&lt;/p&gt;
&lt;h3&gt;Any questions? Ask!&lt;/h3&gt;
&lt;p&gt;The specification is meant to have no ambiguities but it is not always that way. Feel free to question anything you did not understand.&lt;/p&gt;
&lt;h3&gt;Don‚Äôt be afraid to negotiate the deadline&lt;/h3&gt;
&lt;p&gt;Deadlines are tricky in any recrutiment process because different factors can influence how fast you can develop the solution: (i) your proficiency on the language/platform/etc; (ii) if you are already employed and will do it in your free time; (iii) your knowledge on the problem domain. If the company stablishes the deadline, do not be afraid to expose your context and negotiate the deadline.&lt;/p&gt;
&lt;h2&gt;Development&lt;/h2&gt;
&lt;p&gt;After reading the specification and planning the execution it is time to get the hands dirty. There are many tips to keep an eye on.&lt;/p&gt;
&lt;h3&gt;KISS (Keep it simple, stupid!)&lt;/h3&gt;
&lt;p&gt;Avoid as much as possible overengineer and unnecessary abstractions. Your code should be easy to follow. Hard problems usually demand simple solutions.&lt;/p&gt;
&lt;h3&gt;Docs (README)&lt;/h3&gt;
&lt;p&gt;A good README is mandatory. Make sure to explicit: (i) how to run the code; (ii) how to use or interact with it; (iii) how to run the tests; (iv) where it is deployed (if you deployed).&lt;/p&gt;
&lt;h3&gt;Commits&lt;/h3&gt;
&lt;p&gt;Give meaningful sentences to your commits. The reviewer will check your commits to analyze how you conceived the solution.&lt;/p&gt;
&lt;h3&gt;Use good practices&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Favor abstractions&lt;/li&gt;
&lt;li&gt;Don‚Äôt Repeat Yourself (DRY)&lt;/li&gt;
&lt;li&gt;Follow SOLID principles&lt;/li&gt;
&lt;li&gt;Composition over Inheritance&lt;/li&gt;
&lt;li&gt;Modularization&lt;/li&gt;
&lt;li&gt;Cohesion&lt;/li&gt;
&lt;li&gt;etc..&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The good practices can be summarized into:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Separate the responsibilities into different components&lt;/li&gt;
&lt;li&gt;Do not scatter business logic&lt;/li&gt;
&lt;li&gt;Use the conventions of your programming language&lt;/li&gt;
&lt;li&gt;Name things correctly (classes, variables, etc)&lt;/li&gt;
&lt;li&gt;Use comments only in critical parts&lt;/li&gt;
&lt;li&gt;Avoid overengineering and unnecessary abstractions&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Naming&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Make sure your code is semantic.&lt;/strong&gt; Classes, variables, functions, methods should be properly named in such way that the reader easily understand the purpose of that.&lt;/p&gt;
&lt;h3&gt;Tests&lt;/h3&gt;
&lt;p&gt;Write at least unit tests and make them available to be executed at any time. Reaching a high percentage of code coverage can be hard. Therefore, make sure to cover at least the critical parts of your challenge.&lt;/p&gt;
&lt;h3&gt;Be cautious about extra work&lt;/h3&gt;
&lt;p&gt;Some candidates decide to impress the recruiters by implementing extra features. Be careful with that because you can risk your challenge by not completing what matters: the solution according to the specification.&lt;/p&gt;
&lt;h3&gt;Make it work, test and refactor&lt;/h3&gt;
&lt;p&gt;Do not spend too much effort on doing the best solution at first. Instead, (1) create a simple solution, (2) test and (3) refactor.&lt;/p&gt;
&lt;h2&gt;Review&lt;/h2&gt;
&lt;p&gt;Finally it is time to get your code reviewed. In this phase the company either might ask you or not to present the solution. In any case, your code will be reviewed and it is important to &lt;strong&gt;be open to constructive critics and keep in mind the technical decisions you made.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;Be humble&lt;/h3&gt;
&lt;p&gt;Regardless your position (intern, junior, middle or senior) &lt;strong&gt;being humble is the most intelligent behavior you can adopt&lt;/strong&gt;. Your solution: (i) might have flaws; (ii) do not cover some aspects; (ii) could be improved; (iv) is not prepared for a specific situation. &lt;strong&gt;That‚Äôs OK!&lt;/strong&gt; Accept the constructive critics and keep in mind that programming is a constant-learning path.&lt;/p&gt;
&lt;h3&gt;Do not fake&lt;/h3&gt;
&lt;p&gt;Do not pretend knowing something you actually don‚Äôt because you can be asked things you will not be able to answer and that creates an atmosphere of mistrust.&lt;/p&gt;
&lt;h3&gt;Communication is important&lt;/h3&gt;
&lt;p&gt;You earn points depending on the way you present the solution. A nice approach is to give a general overview of the solution and, after that, go into the details of what is important (e.g. business logic). During that moment, explain about the technical decisions you made.&lt;/p&gt;
&lt;h3&gt;Important questions to keep in mind&lt;/h3&gt;
&lt;p&gt;Many questions can be brought in the review: What could be improved? What would you do differently? Does your solution scale? What you did not like regarding your implementation?&lt;/p&gt;
&lt;p&gt;It is good to be prepared for them and reflect on things you could do better.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Dicas para desafios t√©cnicos]]></title><description><![CDATA[√â comum que programadores enfrentem um desafio t√©cnico nos processos de recrutamento. O desafio consiste em tarefas de programa√ß√£o‚Ä¶]]></description><link>https://vcrmartinez.com/2019/2019-04-28-Dicas_para_desafios_tecnicos/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-04-28-Dicas_para_desafios_tecnicos/</guid><pubDate>Invalid Date</pubDate><content:encoded>&lt;p&gt;√â comum que programadores enfrentem um desafio t√©cnico nos processos de recrutamento. O desafio consiste em tarefas de programa√ß√£o projetadas para avaliar candidatos, principalmente, em rela√ß√£o √†s hard skills (por exemplo, habilidade de programa√ß√£o, arquitetura de software, etc.) Normalmente, o processo √© composto por tr√™s fases: (i) especifica√ß√£o; (ii) desenvolvimento; (iii) revis√£o. Existem idiossincrasias e dicas para cada um deles.&lt;/p&gt;
&lt;p&gt;Depois de passar por desafios de codifica√ß√£o e, principalmente, avaliar alguns deles na &lt;a href=&quot;www.onyo.com&quot;&gt;Onyo&lt;/a&gt;, decidi escrever este post e compartilhar algumas li√ß√µes que aprendi.&lt;/p&gt;
&lt;h2&gt;Especifica√ß√£o&lt;/h2&gt;
&lt;p&gt;O candidato recebe um e-mail ou documento especificando o escopo do desafio. Geralmente s√£o listados os requisitos, restri√ß√µes e o que fazer / n√£o fazer. Se voc√™ for um desenvolvedor back-end, por exemplo, pode ser solicitado desenvolver uma API REST / GraphQL, um SaaS ou uma integra√ß√£o com um terceiro. &lt;strong&gt;O segredo do sucesso √© estar muito atento ao que voc√™ precisa fazer. O planejamento √© vital.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;Leia atentamente as especifica√ß√µes&lt;/h3&gt;
&lt;p&gt;N√£o assuma nada a respeito do que voc√™ tem que fazer. Reserve um tempo para ler cada linha do documento e preste aten√ß√£o &lt;strong&gt;aos requisitos&lt;/strong&gt;.&lt;/p&gt;
&lt;h3&gt;Planeje a execu√ß√£o&lt;/h3&gt;
&lt;p&gt;Em primeiro lugar, diferencie o que √© &lt;strong&gt;obrigat√≥rio&lt;/strong&gt; do que √© &lt;strong&gt;bom / extra&lt;/strong&gt;. Al√©m disso, pense em quais bibliotecas voc√™ vai usar e como vai arquitetar seu c√≥digo. √â importante tra√ßar um plano em rela√ß√£o aos seus resultados e estabelecer etapas / fases que ser√£o iteradas, por exemplo: (i) montagem do projeto; (ii) CRUD; (iii) l√≥gica de neg√≥cios 1; (iv) l√≥gica de neg√≥cios 2; e assim por diante. Dessa forma, voc√™ reduz o risco de n√£o realizar um projeto em execu√ß√£o.&lt;/p&gt;
&lt;h3&gt;Alguma d√∫vida? Pergunte!&lt;/h3&gt;
&lt;p&gt;A especifica√ß√£o n√£o deve ter ambig√ºidades, mas nem sempre √© assim. Sinta-se √† vontade para questionar qualquer coisa que voc√™ n√£o tenha entendido.&lt;/p&gt;
&lt;h3&gt;N√£o tenha medo de negociar o prazo&lt;/h3&gt;
&lt;p&gt;Os prazos s√£o complicados em qualquer processo de recrutamento porque diversos fatores podem influenciar a rapidez com que se desenvolve a solu√ß√£o: (i) a sua profici√™ncia na linguagem de progra√ß√£o / plataforma / etc; (ii) se voc√™ j√° est√° empregado e o far√° em seu tempo livre; (iii) seu conhecimento sobre o dom√≠nio do problema. Se a empresa estabelece o prazo, n√£o tenha medo de expor seu contexto e negociar o prazo.&lt;/p&gt;
&lt;h2&gt;Desenvolvimento&lt;/h2&gt;
&lt;p&gt;Depois de ler a especifica√ß√£o e planejar a execu√ß√£o, √© hora de colocar a m√£o na massa. Existem muitas dicas para ficar de olho.&lt;/p&gt;
&lt;h3&gt;KISS (Keep it simple, stupid!)&lt;/h3&gt;
&lt;p&gt;Evite tanto quanto poss√≠vel o excesso de engenharia e abstra√ß√µes desnecess√°rias. Seu c√≥digo deve ser f√°cil de seguir. Problemas dif√≠ceis geralmente exigem solu√ß√µes simples.&lt;/p&gt;
&lt;h3&gt;Docs (README)&lt;/h3&gt;
&lt;p&gt;√â obrigat√≥rio um bom README. Certifique-se de explicitar: (i) como executar o c√≥digo; (ii) como usar ou interagir com ele; (iii) como executar os testes; (iv) onde voc√™ disponibilizou (se voc√™ fez deploy em algum lugar).&lt;/p&gt;
&lt;h3&gt;Commits&lt;/h3&gt;
&lt;p&gt;Use frases significativaas para seus commits. O revisor verificar√° seus commits para analisar como voc√™ concebeu a solu√ß√£o.&lt;/p&gt;
&lt;h3&gt;Use boas pr√°ticas&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Favorecer abstra√ß√µes que fizerem sentido&lt;/li&gt;
&lt;li&gt;Don‚Äôt Repeat Yourself (DRY)&lt;/li&gt;
&lt;li&gt;Siga os princ√≠pios de SOLID&lt;/li&gt;
&lt;li&gt;Composi√ß√£o sobre heran√ßa&lt;/li&gt;
&lt;li&gt;Modulariza√ß√£o&lt;/li&gt;
&lt;li&gt;Coes√£o&lt;/li&gt;
&lt;li&gt;etc.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As boas pr√°ticas podem ser resumidas em:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Separe as responsabilidades em diferentes componentes&lt;/li&gt;
&lt;li&gt;N√£o espalhe a l√≥gica de neg√≥cios&lt;/li&gt;
&lt;li&gt;Use as conven√ß√µes de sua linguagem de programa√ß√£o&lt;/li&gt;
&lt;li&gt;Nomeie as coisas corretamente (classes, vari√°veis, etc)&lt;/li&gt;
&lt;li&gt;Use coment√°rios apenas em partes cr√≠ticas&lt;/li&gt;
&lt;li&gt;Evite engenharia excessiva e abstra√ß√µes desnecess√°rias&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Nomenclatura&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Certifique-se de que seu c√≥digo seja sem√¢ntico.&lt;/strong&gt; Classes, vari√°veis, fun√ß√µes, m√©todos devem ser nomeados corretamente de forma que o leitor compreenda facilmente o prop√≥sito.&lt;/p&gt;
&lt;h3&gt;Testes&lt;/h3&gt;
&lt;p&gt;Escreva pelo menos testes de unidade e disponibilize-os para execu√ß√£o a qualquer momento. Atingir uma alta porcentagem de cobertura de c√≥digo pode ser dif√≠cil. Portanto, certifique-se de cobrir pelo menos as partes cr√≠ticas de seu desafio.&lt;/p&gt;
&lt;h3&gt;Tenha cuidado com o trabalho extra&lt;/h3&gt;
&lt;p&gt;Alguns candidatos decidem impressionar os recrutadores implementando funcionalidades extras. Tenha cuidado com isso porque voc√™ pode arriscar seu desafio ao n√£o concluir o que importa: a solu√ß√£o de acordo com a especifica√ß√£o.&lt;/p&gt;
&lt;h3&gt;Fa√ßa funcionar, teste e refatore&lt;/h3&gt;
&lt;p&gt;N√£o gaste muito esfor√ßo em fazer a melhor solu√ß√£o no in√≠cio. Em vez disso, (1) crie uma solu√ß√£o simples, (2) teste e (3) refatore.&lt;/p&gt;
&lt;h2&gt;Revis√£o&lt;/h2&gt;
&lt;p&gt;Finalmente, √© hora de revisar seu c√≥digo. Nesta fase a empresa pode te pedir (ou n√£o) para apresentar a solu√ß√£o. Em qualquer caso, seu c√≥digo ser√° revisado e √© importante que voc√™ &lt;strong&gt;esteja aberto a cr√≠ticas construtivas e ter em mente as decis√µes t√©cnicas que voc√™ tomou.&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;Seja humilde&lt;/h3&gt;
&lt;p&gt;Independentemente da sua posi√ß√£o (estagi√°rio, j√∫nior, pleno ou s√™nior) &lt;strong&gt;ser humilde √© o comportamento mais inteligente que voc√™ pode adotar&lt;/strong&gt;. Sua solu√ß√£o: (i) pode ter falhas; (ii) n√£o cobrir alguns aspectos; (ii) pode ser melhorada; (iv) n√£o estar preparada para uma situa√ß√£o espec√≠fica. &lt;strong&gt;Tudo bem!&lt;/strong&gt; Aceite as cr√≠ticas construtivas e tenha em mente que programa√ß√£o √© um caminho de aprendizado constante.&lt;/p&gt;
&lt;h3&gt;N√£o finja&lt;/h3&gt;
&lt;p&gt;N√£o finja saber algo que voc√™ realmente n√£o sabe, porque voc√™ pode ser questionado sobre coisas que n√£o ser√° capaz de responder e criar uma atmosfera de desconfian√ßa.&lt;/p&gt;
&lt;h3&gt;A comunica√ß√£o √© importante&lt;/h3&gt;
&lt;p&gt;Voc√™ ganha pontos dependendo da forma como apresenta a solu√ß√£o. Uma boa abordagem √© dar uma vis√£o geral da solu√ß√£o e, depois disso, entrar nos detalhes do que √© importante (por exemplo, l√≥gica de neg√≥cios). Durante esse momento, explique sobre as decis√µes t√©cnicas que voc√™ tomou.&lt;/p&gt;
&lt;h3&gt;Quest√µes importantes para manter em mente&lt;/h3&gt;
&lt;p&gt;Muitas perguntas podem ser feitas na revis√£o: O que poderia ser melhorado? O que voc√™ faria de diferente? A sua solu√ß√£o √© escal√°vel? O que voc√™ n√£o gostou em rela√ß√£o √† sua implementa√ß√£o?&lt;/p&gt;
&lt;p&gt;√â bom estar preparado para eles e refletir sobre o que voc√™ poderia fazer melhor.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fast results with Elasticsearch]]></title><link>https://vcrmartinez.com/2019/2019-04-06-Fast results with Elasticsearch/2019-04-06-Fast results with Elasticsearch/</link><guid isPermaLink="false">https://vcrmartinez.com/2019/2019-04-06-Fast results with Elasticsearch/2019-04-06-Fast results with Elasticsearch/</guid><pubDate>Sat, 06 Apr 2019 03:00:00 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Remote Lifestyle]]></title><link>https://vcrmartinez.com/2018/2018-06-09-Remote-lifestyle/2018-06-09-Remote-lifestyle/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-06-09-Remote-lifestyle/2018-06-09-Remote-lifestyle/</guid><pubDate>Sat, 09 Jun 2018 03:00:00 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Python + Elasticsearch]]></title><description><![CDATA[Ent√£o voc√™ tem muitos documentos e precisa buscar com rapidez, certo? Ou voc√™ tem muitos dados e precisa processar e extrair m√©tricas. De‚Ä¶]]></description><link>https://vcrmartinez.com/2018/2018-02-02-Python_e_elasticsearch/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-02-02-Python_e_elasticsearch/</guid><pubDate>Fri, 02 Feb 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Ent√£o voc√™ tem muitos documentos e precisa buscar com rapidez, certo? Ou voc√™ tem muitos dados e precisa processar e extrair m√©tricas. De qualquer jeito, Elasticsearch (ES) pode ser um poderoso motor para ajud√°-lo a indexar, buscar e extrair m√©tricas dos seu armazenamento orientado a documentos. Este post √© bem direto e pretende apresentar como usar a linguagem Python para interagir com o motor e indexar, retornar e buscar documentos.&lt;/p&gt;
&lt;p&gt;A comunidade python desenvolveu dois projetos bem conhecidos: &lt;a href=&quot;http://elasticsearch-py.readthedocs.io/&quot;&gt;elasticsearch-py&lt;/a&gt; e &lt;a href=&quot;http://elasticsearch-dsl.readthedocs.io/&quot;&gt;elasticsearch-dsl&lt;/a&gt;. Enquanto o primeiro prov√™ algumas ferramentas para interagir com ES e, na minha humilde opini√£o, para ter um controle mais granular das a√ß√µes, o √∫ltimo foi criado para ajud√°-lo com a busca e a persist√™ncia.&lt;/p&gt;
&lt;h2&gt;Conex√£o&lt;/h2&gt;
&lt;p&gt;A primeira quest√£o √©: como eu conector com o ES? Ao usar &lt;code class=&quot;language-text&quot;&gt;elasticsearch-dsl&lt;/code&gt; voc√™ pode criar uma conex√£o &lt;em&gt;default&lt;/em&gt; que ser√° usada globalmente:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;connections&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_connection&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hosts&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Entretando, voc√™ pode querer usar um cliente e ter um controle mais granual. Ao usar o &lt;code class=&quot;language-text&quot;&gt;elasticsearch-py&lt;/code&gt; voc√™ consegue isso:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Elasticsearch

client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Elasticsearch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hosts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; http_auth&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Execute &lt;code class=&quot;language-text&quot;&gt;client.indices.get_alias(&amp;quot;*&amp;quot;)&lt;/code&gt; para retornar os √≠ndices existentes e checar se est√° propriamente configurado.&lt;/p&gt;
&lt;h2&gt;Persist√™ncia&lt;/h2&gt;
&lt;p&gt;Armazenar documentos √© f√°cil pois &lt;code class=&quot;language-text&quot;&gt;elasticsearch-dsl&lt;/code&gt; prov√™ &lt;code class=&quot;language-text&quot;&gt;DocType&lt;/code&gt; ‚Äì uma classe que cuida de mapear sua classe python para documentos JSON. Ao inv√©s de preocupar-se com estruturas JSON, vamos criar um documento que armazena o o acesso de um usu√°rio a uma p√°gina espec√≠fica:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch_dsl &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; DocType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Integer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Keyword


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserHit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;DocType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    page &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Keyword&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    datetime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Integer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    environment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Keyword&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Preste aten√ß√£o aos campos que escolhemos: Integer, Date, Keyword. Eles ser√£o mapeados para o motor do Elasticsearch, o que significa que voc√™ pode usar algumas features espec√≠ficas. Por exemplo, o campo datetime pode ser usado para buscar um intervalo de datas ou agregar os dados por minutos, horas, dias, meses. Outro detalhe √© o campo &lt;code class=&quot;language-text&quot;&gt;environment&lt;/code&gt;: √© uma solu√ß√£o para integrar o ES com diferentes ambientes (homologa√ß√£o, desenvolvimento e produ√ß√£o). Dessa forma voc√™ n√£o corre o risco de misturar dados falsos com os de produ√ß√£o.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Atualizado em 4 de Fev:&lt;/strong&gt;: Uma outra estrat√©gia √© criar √≠ndices concatenados com o ambiente de produ√ß√£o. Ao utilizar uma vari√°vel de ambiente sua aplica√ß√£o pode criar diferentes √≠ndices (e.g. myindex-2018.02.01-production, myindex-2018.02.01-staging, myindex-2018.02.01-development). Obrigado pela contribui√ß√£o, Robson Peixoto.&lt;/p&gt;
&lt;p&gt;Uma vez que voc√™ criou a classe, a indexa√ß√£o se torna f√°cil:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;user_hit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; UserHit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    datetime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

UserHit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;index_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Indexed can be True or False depending on the operation success&lt;/span&gt;
indexed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; user_hit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Voc√™ tem que ser atento a duas quest√µes: (i) antes de usar o documento voc√™ precisa garantir que o mapeamento no Elasticsearch est√° criado e √© por isso que n√≥s temos que usar o m√©todo &lt;code class=&quot;language-text&quot;&gt;init&lt;/code&gt; na linha 8; (ii) o retorno da opera√ß√£o uma vez que o m√©todo &lt;code class=&quot;language-text&quot;&gt;.save&lt;/code&gt; pode retornar ou &lt;code class=&quot;language-text&quot;&gt;True&lt;/code&gt; ou &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Buscar&lt;/h2&gt;
&lt;p&gt;Como buscar os documentos? O trecho de c√≥digo abaixo ilustra um exemplo simples.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch_dsl &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Search
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ElasticsearchException


search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Search&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;success&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; ElasticsearchException&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Fail to get the hits&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hits&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;√â importante mencionar que o ES traz apenas &lt;em&gt;10 resultados por padr√£o e √© por isso que precisamos das linhas 11 e 12&lt;/em&gt; .&lt;/p&gt;
&lt;h2&gt;Filtrando Resultados&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Search&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;range&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; datetime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; from_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;lte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; to_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;time_zone&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; time_zone_delta&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hits&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Voc√™ acabou de buscar, mas agora quer filtrar os resultados por um intervalo de data. A linha 7 faz o truque.&lt;/p&gt;
&lt;h2&gt;Agregando&lt;/h2&gt;
&lt;p&gt;Voc√™ pode gerar m√©tricas baseadas em data, por exemplo. A linha 12 diz para o ES agrugar os dados por intervalos de 30 minutos.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch_dsl &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Search
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ElasticsearchException


search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Search&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;range&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; datetime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; from_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;lte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; to_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;time_zone&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; time_zone_delta&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aggs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bucket&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;date_histogram&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; field&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; interval&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;30m&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;success&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; ElasticsearchException&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Fail to get the hits&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aggs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;buckets&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Python + Elasticsearch]]></title><description><![CDATA[So you got lots of documents and need fast querying, huh? Or you have tons of data and need to process and extract metrics. Either way‚Ä¶]]></description><link>https://vcrmartinez.com/2018/2018-02-02-Python_and_elasticsearch/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-02-02-Python_and_elasticsearch/</guid><pubDate>Fri, 02 Feb 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;So you got lots of documents and need fast querying, huh? Or you have tons of data and need to process and extract metrics. Either way, Elasticsearch (ES) can be a powerful engine to help you index, query and extract metrics from its document-driven storage. This post is very straightforward and intends to show how to use python to interact with the engine and index/retrieve/query documents.&lt;/p&gt;
&lt;p&gt;The python community has developed two well known projects: &lt;a href=&quot;http://elasticsearch-py.readthedocs.io/&quot;&gt;elasticsearch-py&lt;/a&gt; and &lt;a href=&quot;http://elasticsearch-dsl.readthedocs.io/&quot;&gt;elasticsearch-dsl&lt;/a&gt;. While the former provides some tools to interact with ES and, IMHO, a more granular control over the actions, the latter was built to help you with the search and persistence. Let‚Äôs check that.&lt;/p&gt;
&lt;h2&gt;Connecting&lt;/h2&gt;
&lt;p&gt;The first question is: how do I connect to ES? By using &lt;code class=&quot;language-text&quot;&gt;elasticsearch-dsl&lt;/code&gt; you can create a default connection that will be used globally:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;connections&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_connection&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hosts&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;localhost&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, you might want to use a client and have a more granular control. By using &lt;code class=&quot;language-text&quot;&gt;elasticsearch-py&lt;/code&gt; you can achieve that:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Elasticsearch

client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Elasticsearch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hosts&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; http_auth&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;username&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; password&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;**&lt;/span&gt;kwargs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Execute &lt;code class=&quot;language-text&quot;&gt;client.indices.get_alias(&amp;quot;*&amp;quot;)&lt;/code&gt; to retrieve the existent indexes and check it is properly configured.&lt;/p&gt;
&lt;h2&gt;Persisting&lt;/h2&gt;
&lt;p&gt;Storing our documents is easy because &lt;code class=&quot;language-text&quot;&gt;elasticsearch-dsl&lt;/code&gt; provides DocType ‚Äì a class that takes care of mapping your python class to JSON documents. Instead of worrying about JSON structures, let‚Äôs create a document that stores the user hit to a specific page:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch_dsl &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; DocType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Integer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Keyword


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UserHit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;DocType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    page &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Keyword&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    datetime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Date&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    user_id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Integer&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    environment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Keyword&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pay attention to the fields we chose: Integer, Date, Keyword. They will be mapped to Elasticsearch engine which means that you can use specific features. For example, the datetime field can be used to search a date range or aggregate data by minute,hour, day, month. Another detail is the &lt;code class=&quot;language-text&quot;&gt;environment&lt;/code&gt; field: it a solution to integrate ES with diferent environments: staging, development and production. That way, you do not take the risk of mixing fake data to production data.&lt;/p&gt;
&lt;p&gt;**Updated on Feb 4th **: There is another strategy to not mess with production data: create indexes concatenated with the app environment. By using an env var, your application can create different indexes (e.g. myindex-2018.02.01-production, myindex-2018.02.01-staging, myindex-2018.02.01-development). Thanks for the contribution Robson Peixoto.&lt;/p&gt;
&lt;p&gt;Once you create the class indexing becomes easy:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;user_hit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; UserHit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    datetime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;datetime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

UserHit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;init&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;index_name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Indexed can be True or False depending on the operation success&lt;/span&gt;
indexed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; user_hit&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You must be attentive to two issues: (i) before using the document you must ensure the mappings in Elasticsearch are created and that‚Äôs why we have to use the &lt;code class=&quot;language-text&quot;&gt;init&lt;/code&gt; method in line 8; (ii) the return of the operation once the &lt;code class=&quot;language-text&quot;&gt;.save&lt;/code&gt; method can return either &lt;code class=&quot;language-text&quot;&gt;True&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;False&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Querying&lt;/h2&gt;
&lt;p&gt;How to query the documents? The snippet below illustrates a simple example.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch_dsl &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Search
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ElasticsearchException


search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Search&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;success&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; ElasticsearchException&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Fail to get the hits&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hits&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It is important to mention that ES brings only &lt;em&gt;10 results by default and that‚Äôs why we need the lines 11 and 12&lt;/em&gt;.&lt;/p&gt;
&lt;h2&gt;Filtering&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Search&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;range&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; datetime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; from_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;lte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; to_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;time_zone&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; time_zone_delta&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hits&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You have just queried, but now you want to filter the results by a date range. The 7th line does the trick.&lt;/p&gt;
&lt;h2&gt;Aggregating&lt;/h2&gt;
&lt;p&gt;You can generate metrics based on date, for example. The 12th line tells ES to group the data by intervals of 30 minutes.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch_dsl &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Search
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; elasticsearch &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ElasticsearchException


search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Search&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;using&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myindex-2018.02.01&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; page&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;product-list&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; user_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;match&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; environment&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;range&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; datetime&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; from_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;lte&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; to_datetime&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;time_zone&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; time_zone_delta&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aggs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bucket&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;date_histogram&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; field&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; interval&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;30m&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
search &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

res &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; search&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;success&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; ElasticsearchException&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Fail to get the hits&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;aggs&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;datetime&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;buckets&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[O Programador Agilista]]></title><description><![CDATA[Uma conversa recente com um amigo trouxe √† tona aspectos importantes do desenvolvimento de software. Algumas caracter√≠sticas como feedback‚Ä¶]]></description><link>https://vcrmartinez.com/2018/2018-01-20-O_programador_agilista/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-01-20-O_programador_agilista/</guid><pubDate>Sat, 20 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Uma conversa recente com um amigo trouxe √† tona aspectos importantes do desenvolvimento de software. Algumas caracter√≠sticas como &lt;strong&gt;feedback constante&lt;/strong&gt;, &lt;strong&gt;ciclos curtos&lt;/strong&gt; e &lt;strong&gt;aprendizado r√°pido&lt;/strong&gt; podem levar sua mente a pensar em frameworks Agile (por exemplo, Scrum, Kanban, Lean Software Development, etc). No entanto, eles n√£o est√£o exclusivamente ligados a uma estrutura, mas a todo um conceito / ideia de abordar problemas por meio de per√≠odos iterativos e incrementais que duram geralmente de 7 a 14 dias. Os benef√≠cios s√£o vistos claramente em equipes √°geis, mas nem todos os profissionais internalizaram esses conceitos no fluxo de trabalho pessoal. Se voc√™ fizer isso, provavelmente aumentar√° sua produtividade e se concentrar√° no produto final.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Voc√™ √© um programador Agilista?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ao perguntar, eu quero que voc√™ pense sobre os conceitos e como voc√™ pode aplic√°-los em seu fluxo de trabalho. Voc√™ trabalha com per√≠odos curtos de tempo, feedback constante e aprendizado r√°pido? Pode parecer imposs√≠vel a princ√≠pio ou n√£o t√£o claro como aplicar isso, mas neste post tento trazer a provoca√ß√£o.&lt;/p&gt;
&lt;p&gt;As perguntas abaixo revelam aspectos importantes do seu fluxo de trabalho. Vamos pensar sobre isso:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Como voc√™ lida com problemas? Voc√™ resolve de uma vez ou quebra em peda√ßos?&lt;/li&gt;
&lt;li&gt;Voc√™ cria testes automatizados?&lt;/li&gt;
&lt;li&gt;Voc√™ costuma criar um MVP simples ou tenta entregar a vers√£o final de uma vez s√≥?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Suas respostas provavelmente dizem algo que j√° sabemos: criar e manter um software n√£o √© uma tarefa f√°cil. Al√©m das habilidades t√©cnicas, √© importante planejar a execu√ß√£o e proporcionar um processo de aprendizado r√°pido. Tenho tentado incorporar o fluxo de trabalho abaixo e espero que ele ajude voc√™ a entregar produtos de forma melhor e mais r√°pida.&lt;/p&gt;
&lt;h2&gt;Planejamento&lt;/h2&gt;
&lt;p&gt;No momento em que voc√™ recebe uma tarefa para realizar, o primeiro impulso √© come√ßar a codificar e apenas parar quando tudo estiver funcionando corretamente. Isso acontece porque n√≥s &lt;em&gt;imediatamente focamos em &lt;strong&gt;como&lt;/strong&gt; (programa√ß√£o) em vez de &lt;strong&gt;o que&lt;/strong&gt; (etapas)&lt;/em&gt; precisa ser feito. √â uma abordagem muito arriscada porque voc√™ (i) provavelmente encontrar√° problemas n√£o planejados que precisam ser resolvidos e / ou (ii) gastar√° mais tempo em coisas que n√£o detectou anteriormente. O cen√°rio ideal acontece quando conhecemos todos os passos meticulosos para fazer o trabalho com anteced√™ncia. Por√©m, muitas vezes temos apenas uma vis√£o mais ampla do escopo.&lt;/p&gt;
&lt;p&gt;Da pr√≥xima vez que voc√™ conseguir um recurso / bug / melhoria / tarefa para fazer, segure seu impulso por alguns minutos e desenhe as etapas que voc√™ deve seguir para conseguir isso. Durante o caminho voc√™ provavelmente notar√° que existem alguns casos extremos para ficar atento ou cen√°rios que exigem um esfor√ßo extra.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.74999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABkElEQVQ4y4VTS0/CQBDu/z959+7NmzEhMRwM0RiQBEGNMRUojwKlj+1uS30k435LZ7OLBw8fm9LZ7zEzDSpV0H9QMrfIsx2l+w3JMvPecW1gL+JFe7rgYj5FsadNvDCkdSU8MY9QsdqJK5eMHQL7JLYu3RrPoXWqUVc+MdyMn4aU7NbmGU7ZYZEntvZPZNVGLbQLXMLzoS5pu1nSR/hGzUGaepDBaSlSI8ItCNw4bg/jdUSr5cy6Q8RUA+T4bzZ9p2geGlGQQdA4xI8EdD/YHYqA3XZl+1TqE4Bopp1l6dYIIS731PSwqUr6rCV9HxQ1Wt0twiUQHwlzg1xkVOizavtnjfDaTMJXehj16eq+S8/hC8U6JuKikCeq5NGlKI9phH4nncG5CM5713TR69DZzSV1h3ekitQqIwavBzsHMBie9OnyB7eTAfVHAxqMHylaTE3TQWAut7F5pfA/Jp1oEUwXYkxqCRslTO9+vmqr7H4h7tfAq7Jezc3Jg/N6yMVuc71VcoqZFCmQAPuHdXFFfwEye9nu5stTPgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Planeje as etapas&quot;
        title=&quot;Planeje as etapas&quot;
        data-src=&quot;/static/d8857b1db6c297ba73261b0460a98433/d9199/step1.png&quot;
        data-srcset=&quot;/static/d8857b1db6c297ba73261b0460a98433/8ff5a/step1.png 240w,
/static/d8857b1db6c297ba73261b0460a98433/e85cb/step1.png 480w,
/static/d8857b1db6c297ba73261b0460a98433/d9199/step1.png 960w,
/static/d8857b1db6c297ba73261b0460a98433/07a9c/step1.png 1440w,
/static/d8857b1db6c297ba73261b0460a98433/29114/step1.png 1920w,
/static/d8857b1db6c297ba73261b0460a98433/cd13d/step1.png 1958w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;√â importante ressaltar que voc√™ n√£o deve planejar tudo de uma vez (isso exigiria muito tempo / esfor√ßo). Apenas planeje a pr√≥xima vers√£o do seu produto: comece com o mvp, depois v1, v2, v3 ‚Ä¶&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Dica:&lt;/em&gt; use um caderno / moleskine / papel para anotar todas as informa√ß√µes - ele limpa sua mente ao deix√°-la livre para se concentrar na fase de execu√ß√£o.&lt;/p&gt;
&lt;h2&gt;Dividir para conquistar&lt;/h2&gt;
&lt;p&gt;Cada problema pode ser dividido em pequenos peda√ßos e deve ser resolvido uma vez por vez. Tentar codificar tudo de uma vez ir√° distra√≠-lo para o que importa: fazer funcionar. Comece com componentes simples que funcionam no melhor cen√°rio. Vamos ver um exemplo:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAByElEQVQoz11SXVPaUBDNf/ahv8EX39Tp+NJilQ6VoTDi52A7ndEptmgEEkhCAoTw0WhCQkJIinrcex1GJw87e2/2nD1n90aYhx7eRxhMEVH2vAd0xBq6p8doHOQg/azAHg8QRTOOSfNWIaSbcfAiQLt6BetbDubXLPqZz7C/7EIqFuCz+gr3jrMKId2Mx9zHSG1xd/VSAc3Sd7TyOWi/LxEnIccHM/d1GsLGZGBBzrnDtAKL/3GIGWXL6sF1/mFCo7pTG57v8POMckIY1ojVe90OzL7x5jChQhy9KfV7OtqtJicPzC6chwnHMFdMRGre4aZ2DU2V+VlVZM5R2hKEgNR6ROqPBhhR/Lm+4qBkEULvKLi3x3QX4dMjMcHnxxiPyRyMx0Snrg3DUCFLdY4XbqlrXrxBodmgfAuZPi6JYA11iGKV78g0DdT+VuHcj3FJj1X+UYFBIzIRjXbNnBm68rpDWVdRacs4lRo4r4uQVQmlk0/I5NeRLW1AUe+A5yU0rYX1nR182NzG2uYWDo7LeFpGCGhvvudw97zhghy4pDyk3UTsIQY6ji4yyB9+xMWvIu1vzMGTyRB75UNsZfdRPDuhu8Xdp3+fF1G0jZRkRhkiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Divida um problema em pequenas partes&quot;
        title=&quot;Divida um problema em pequenas partes&quot;
        data-src=&quot;/static/679ded0f865201227959f790169f1fa2/d9199/step2.png&quot;
        data-srcset=&quot;/static/679ded0f865201227959f790169f1fa2/8ff5a/step2.png 240w,
/static/679ded0f865201227959f790169f1fa2/e85cb/step2.png 480w,
/static/679ded0f865201227959f790169f1fa2/d9199/step2.png 960w,
/static/679ded0f865201227959f790169f1fa2/07a9c/step2.png 1440w,
/static/679ded0f865201227959f790169f1fa2/5068c/step2.png 1917w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Imagine que voc√™ tenha que interagir com o servi√ßo Elasticsearch para indexar documentos e recuper√°-los. Portanto, √© poss√≠vel modelar o problema como:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Interagindo com Elasticsearch&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Crie um cliente m√≠nimo funcional (ou configure um existente)&lt;/li&gt;
&lt;li&gt;Crie uma fun√ß√£o que indexe um documento&lt;/li&gt;
&lt;li&gt;Crie uma fun√ß√£o que recupere um documento por id
‚Ä¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Se voc√™ se concentrar em lidar com cada pe√ßa de uma vez, sua mente estar√° 100% concentrada em resolver isso, em vez de se preocupar constantemente com o quadro geral.&lt;/p&gt;
&lt;h2&gt;Testes automatizados&lt;/h2&gt;
&lt;p&gt;Cada componente deve ser testado para garantir, pelo menos, os requisitos m√≠nimos. N√£o vou entrar na discuss√£o sobre TDD ou n√£o-TDD. O resultado final √©: voc√™ deve garantir que seus componentes funcionem corretamente.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACf0lEQVQoz21TYU/aYBDuT963fdz2Zcmiy7LEZBvR6ZYpZk5kMy5muoDDoAKC0JYCQhWk2AKF0kIpjuXZ3Tvg0z5c2ve9u+eee947yR866NsWZDmHdOYCmqbAG9jwR4OFDb2+sBHF8tdzexgHQ2F8x+e5X1KvS0g2bpGsVnCsqTjUqzjOpOD2O7CpUL/XxmSWyElj38VkMkLnpgjrrgaXwH4/+Iui0lkhh/3qNY4I8JTskOzgPAm73cJdQ4dcyKKkySI4GHtom01kcllcHoRR+vEZ51RcoRjuRDAcEJNCSUGO2MnUbl6+gkOsmAkbg1zl0qiUVViWgUz6HCaB+q6NCfm4kKrkxT3HS8F4iGDkolwsIPHrJ7EpEGCHKrqiIgM+UIvculaUBRNukZPnMvyZBlCUKzTqNdKwmEXk+wb2jzaxFn6JlY9PsRNdh2UaaBl10W4um4LRvBXMeqQrS8HJ3c49imoeNn35rOsVSKfJIyy9fYzV7SW8Xn2C5yuPsPrpFQE24dJr92YPw8kaJTu2iSYBmvd3ws+SeSMHWkWFXitDYsqycokEAZ8kDpE8i6HVqotW2ccvzGB9ApJLRZQNA34wEq175J+SHN2hjWgqjppxA2lMjilpYndM1Os62lYL49n8sU7MMB4/hnXfQNd18DWRhFIuCY25KHeSSp+h1tTFWWKdvp3EsBHdQyi8hWehENb3IuKlmZlKYttdEwGBD9w+evRg1TJNRTaNS1oE/jLGxP/XkZSnDXkTiWArFsO73V0s7+zixdp7UZkB58O82BZiHpAMA6cLh/SbBN5CHjGHfHlBlTYjX7BM7D5sh1G/rYmg+bAu1m72Pz//by3/Agb5Y0erkapgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Testes automatizados&quot;
        title=&quot;Testes automatizados&quot;
        data-src=&quot;/static/2101f4bfba7793b7152acfc6ebe67ec9/d9199/step3.png&quot;
        data-srcset=&quot;/static/2101f4bfba7793b7152acfc6ebe67ec9/8ff5a/step3.png 240w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/e85cb/step3.png 480w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/d9199/step3.png 960w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/07a9c/step3.png 1440w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/541fe/step3.png 1654w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Ciclos curtos, melhoria constante&lt;/h2&gt;
&lt;p&gt;Voc√™ planejou as etapas, dividiu o problema em partes, come√ßou a resolver um de cada vez e escreveu alguns testes automatizados. Lembre-se, todas as etapas devem se concentrar nos requisitos m√≠nimos para alcan√ßar o MVP, v1, v2, v3 e assim por diante. Dessa forma, voc√™ pode iterar ao longo de todo o ciclo, aprender as li√ß√µes, desenvolver, testar e entregar rapidamente um software funcional. Se voc√™ gastar muito tempo planejando ou apenas desenvolvendo, provavelmente perder√° a no√ß√£o do Time-to-Market que muitas empresas lutam para serem boas.&lt;/p&gt;
&lt;p&gt;E quanto a voc√™? O que voc√™ usa para melhorar seu fluxo de trabalho?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The Agilist Programmer]]></title><description><![CDATA[A recent conversation with a friend brought up important aspects of software development. Some characteristics like constant feedback, short‚Ä¶]]></description><link>https://vcrmartinez.com/2018/2018-01-20-The_agilist_programmer/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-01-20-The_agilist_programmer/</guid><pubDate>Sat, 20 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A recent conversation with a friend brought up important aspects of software development. Some characteristics like &lt;strong&gt;constant feedback&lt;/strong&gt;, &lt;strong&gt;short cycles&lt;/strong&gt; and &lt;strong&gt;fast learning&lt;/strong&gt; might drive your mind to think about Agile frameworks (e.g. Scrum, Kanban, Lean Software Development, etc). However, they are not exclusively attached to one framework but a whole concept/idea of addressing problems through iterative and incremental periods lasting usually from 7 to 14 days. The benefits are clearly seen in agile teams but not all professionals have internalized those concepts into the personal workflow. If you do that it is likely to increase your productivity and focus on the deliverable.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Are you an Agilist Programmer?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;By asking that I want you to think about the concepts and how you can apply that into your workflow. Do you work with shor periods of time, constant feedback and fast learning? It might seem impossible at first or not so clear how to apply that but in this post I try to bring up the tease.&lt;/p&gt;
&lt;p&gt;The questions below reveal important aspects of your workflow. Let‚Äôs think over it by answering them:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;How do you tackle problems? Do you solve at once or break into pieces?&lt;/li&gt;
&lt;li&gt;Do you create automated tests?&lt;/li&gt;
&lt;li&gt;Are you used to create a simple MVP or you try to deliver the final version once and for all?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Your answers probably tell you something we already know: creating and maintaining a software is not an easy task. Besides technical skills it is important to plan the execution and provide a fast-learning process. I have been trying to incorporate the workflow below and I hope it helps you to deliver faster and better products.&lt;/p&gt;
&lt;h2&gt;Planning&lt;/h2&gt;
&lt;p&gt;By the time you are assigned a task to accomplish the first impulse is to start coding and only stop when everything is working properly. It happens because we &lt;em&gt;immediately focus on &lt;strong&gt;how&lt;/strong&gt; (programming) instead of &lt;strong&gt;what&lt;/strong&gt; (steps)&lt;/em&gt; need to be done. It is a very risky approach because you (i) will likely find unplanned issues that need to be addresses and/or (ii) will spend more time on things that you have not previously detected. The ideal scenario happens when we know all the meticulous steps to get the job done beforehand. However, many times we have just a broader view of the scope.&lt;/p&gt;
&lt;p&gt;Next time you get a feature/bug/improvement/task to do hold your impulse for some minutes and outline the steps you must follow to accomplish that. During the path you probably you probably will notice there exist some corner cases to be attentive or scenarios that demand an extra effort.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 63.74999999999999%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABkElEQVQ4y4VTS0/CQBDu/z959+7NmzEhMRwM0RiQBEGNMRUojwKlj+1uS30k435LZ7OLBw8fm9LZ7zEzDSpV0H9QMrfIsx2l+w3JMvPecW1gL+JFe7rgYj5FsadNvDCkdSU8MY9QsdqJK5eMHQL7JLYu3RrPoXWqUVc+MdyMn4aU7NbmGU7ZYZEntvZPZNVGLbQLXMLzoS5pu1nSR/hGzUGaepDBaSlSI8ItCNw4bg/jdUSr5cy6Q8RUA+T4bzZ9p2geGlGQQdA4xI8EdD/YHYqA3XZl+1TqE4Bopp1l6dYIIS731PSwqUr6rCV9HxQ1Wt0twiUQHwlzg1xkVOizavtnjfDaTMJXehj16eq+S8/hC8U6JuKikCeq5NGlKI9phH4nncG5CM5713TR69DZzSV1h3ekitQqIwavBzsHMBie9OnyB7eTAfVHAxqMHylaTE3TQWAut7F5pfA/Jp1oEUwXYkxqCRslTO9+vmqr7H4h7tfAq7Jezc3Jg/N6yMVuc71VcoqZFCmQAPuHdXFFfwEye9nu5stTPgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Plan the steps&quot;
        title=&quot;Plan the steps&quot;
        data-src=&quot;/static/d8857b1db6c297ba73261b0460a98433/d9199/step1.png&quot;
        data-srcset=&quot;/static/d8857b1db6c297ba73261b0460a98433/8ff5a/step1.png 240w,
/static/d8857b1db6c297ba73261b0460a98433/e85cb/step1.png 480w,
/static/d8857b1db6c297ba73261b0460a98433/d9199/step1.png 960w,
/static/d8857b1db6c297ba73261b0460a98433/07a9c/step1.png 1440w,
/static/d8857b1db6c297ba73261b0460a98433/29114/step1.png 1920w,
/static/d8857b1db6c297ba73261b0460a98433/cd13d/step1.png 1958w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It is important to highlight that you should not plan everything at once (that would take too much time/effort). Just plan the next version of your deliverable: start with the mvp, then v1, v2, v3‚Ä¶&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Hint:&lt;/em&gt; use a personal notebook/moleskine/paper to write down all the info - it clears your mind by making it free to focus on the execution phase.&lt;/p&gt;
&lt;h2&gt;Divide to Conquer&lt;/h2&gt;
&lt;p&gt;Every single problem can be broken down into small pieces and must be tackled once at a time. Trying to code everything at once will distract you to what matters: make it work. Start with simple components that work in the best scenario. Let‚Äôs see an example:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAByElEQVQoz11SXVPaUBDNf/ahv8EX39Tp+NJilQ6VoTDi52A7ndEptmgEEkhCAoTw0WhCQkJIinrcex1GJw87e2/2nD1n90aYhx7eRxhMEVH2vAd0xBq6p8doHOQg/azAHg8QRTOOSfNWIaSbcfAiQLt6BetbDubXLPqZz7C/7EIqFuCz+gr3jrMKId2Mx9zHSG1xd/VSAc3Sd7TyOWi/LxEnIccHM/d1GsLGZGBBzrnDtAKL/3GIGWXL6sF1/mFCo7pTG57v8POMckIY1ojVe90OzL7x5jChQhy9KfV7OtqtJicPzC6chwnHMFdMRGre4aZ2DU2V+VlVZM5R2hKEgNR6ROqPBhhR/Lm+4qBkEULvKLi3x3QX4dMjMcHnxxiPyRyMx0Snrg3DUCFLdY4XbqlrXrxBodmgfAuZPi6JYA11iGKV78g0DdT+VuHcj3FJj1X+UYFBIzIRjXbNnBm68rpDWVdRacs4lRo4r4uQVQmlk0/I5NeRLW1AUe+A5yU0rYX1nR182NzG2uYWDo7LeFpGCGhvvudw97zhghy4pDyk3UTsIQY6ji4yyB9+xMWvIu1vzMGTyRB75UNsZfdRPDuhu8Xdp3+fF1G0jZRkRhkiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Break a problem into small pieces&quot;
        title=&quot;Break a problem into small pieces&quot;
        data-src=&quot;/static/679ded0f865201227959f790169f1fa2/d9199/step2.png&quot;
        data-srcset=&quot;/static/679ded0f865201227959f790169f1fa2/8ff5a/step2.png 240w,
/static/679ded0f865201227959f790169f1fa2/e85cb/step2.png 480w,
/static/679ded0f865201227959f790169f1fa2/d9199/step2.png 960w,
/static/679ded0f865201227959f790169f1fa2/07a9c/step2.png 1440w,
/static/679ded0f865201227959f790169f1fa2/5068c/step2.png 1917w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Imagine you have to interact with Elasticsearch service in order to index documents and retrieve them. So, it is possible to model the issue as:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Interacting with Elasticsearch&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Create a minimum working client (or setup an existing one)&lt;/li&gt;
&lt;li&gt;Create a function that index a document&lt;/li&gt;
&lt;li&gt;Create a function that retrieve a document by id
‚Ä¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you focus on tackling each piece at a time your mind will be 100% concentrated into solving that instead of constantly worring about the big picture.&lt;/p&gt;
&lt;h2&gt;Automated Tests&lt;/h2&gt;
&lt;p&gt;Each component must be tested to ensure, at least, the minimum requirements. I will not get into the discussion about TDD or not-TDD. The bottom line is: you must ensure your components work properly.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACf0lEQVQoz21TYU/aYBDuT963fdz2Zcmiy7LEZBvR6ZYpZk5kMy5muoDDoAKC0JYCQhWk2AKF0kIpjuXZ3Tvg0z5c2ve9u+eee947yR866NsWZDmHdOYCmqbAG9jwR4OFDb2+sBHF8tdzexgHQ2F8x+e5X1KvS0g2bpGsVnCsqTjUqzjOpOD2O7CpUL/XxmSWyElj38VkMkLnpgjrrgaXwH4/+Iui0lkhh/3qNY4I8JTskOzgPAm73cJdQ4dcyKKkySI4GHtom01kcllcHoRR+vEZ51RcoRjuRDAcEJNCSUGO2MnUbl6+gkOsmAkbg1zl0qiUVViWgUz6HCaB+q6NCfm4kKrkxT3HS8F4iGDkolwsIPHrJ7EpEGCHKrqiIgM+UIvculaUBRNukZPnMvyZBlCUKzTqNdKwmEXk+wb2jzaxFn6JlY9PsRNdh2UaaBl10W4um4LRvBXMeqQrS8HJ3c49imoeNn35rOsVSKfJIyy9fYzV7SW8Xn2C5yuPsPrpFQE24dJr92YPw8kaJTu2iSYBmvd3ws+SeSMHWkWFXitDYsqycokEAZ8kDpE8i6HVqotW2ccvzGB9ApJLRZQNA34wEq175J+SHN2hjWgqjppxA2lMjilpYndM1Os62lYL49n8sU7MMB4/hnXfQNd18DWRhFIuCY25KHeSSp+h1tTFWWKdvp3EsBHdQyi8hWehENb3IuKlmZlKYttdEwGBD9w+evRg1TJNRTaNS1oE/jLGxP/XkZSnDXkTiWArFsO73V0s7+zixdp7UZkB58O82BZiHpAMA6cLh/SbBN5CHjGHfHlBlTYjX7BM7D5sh1G/rYmg+bAu1m72Pz//by3/Agb5Y0erkapgAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Automated Tests&quot;
        title=&quot;Automated Tests&quot;
        data-src=&quot;/static/2101f4bfba7793b7152acfc6ebe67ec9/d9199/step3.png&quot;
        data-srcset=&quot;/static/2101f4bfba7793b7152acfc6ebe67ec9/8ff5a/step3.png 240w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/e85cb/step3.png 480w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/d9199/step3.png 960w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/07a9c/step3.png 1440w,
/static/2101f4bfba7793b7152acfc6ebe67ec9/541fe/step3.png 1654w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Short cycles, constant improvement&lt;/h2&gt;
&lt;p&gt;You have planned the steps, divided the problem into pieces, started to solve one at a time and wrote some automated tests. Remember, all the steps must focus on the minimum requirements to reach the MVP, v1, v2, v3 and so on. That way you can iterate over the whole cycle, learn the lessons, develop, test and quick deliver a working piece of software. If you spend too much time on planning or only developing you probably will lost track of the Time to Market that many companies want to be good at.&lt;/p&gt;
&lt;p&gt;How about you? What do you use that improve your workflow?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[O estilo de vida remoto]]></title><description><![CDATA[TL;DR J√° faz tr√™s meses trabalhando remotamente e quero compartilhar o que aprendi da perspectiva de uma pessoa que nunca trabalhou‚Ä¶]]></description><link>https://vcrmartinez.com/2018/2018-01-12-O_estilo_de_vida_remoto/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-01-12-O_estilo_de_vida_remoto/</guid><pubDate>Fri, 12 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h4&gt;TL;DR&lt;/h4&gt;
&lt;p&gt;J√° faz tr√™s meses trabalhando remotamente e quero compartilhar o que aprendi da perspectiva de uma pessoa que nunca trabalhou remotamente antes.&lt;/p&gt;
&lt;p&gt;‚Äî&lt;/p&gt;
&lt;p&gt;2017 foi um ano muito dif√≠cil mas, como diz o ditado, &lt;em&gt;mar tranquilo nunca fez um bom marinheiro&lt;/em&gt;. Eu estava trabalhando com PHP e o framework Neos Flow, mas queria trabalhar com Python. Infelizmente a cidade em que moro n√£o oferece muitas oportunidades e n√£o pude aceitar o cen√°rio.&lt;/p&gt;
&lt;p&gt;A estrat√©gia foi: (i) fortalecer minhas habilidades; (ii) atualizar meu curr√≠culo; (iii) procurar empregos; (iv) encaminhar meu curr√≠culo para empresas alinhadas ao meu perfil. Poucos meses depois, tive o prazer de fazer parte de uma excelente equipe e, desde ent√£o, tenho aprendido n√£o s√≥ habilidades t√©cnicas, mas tamb√©m como me adaptar ao t√£o almejado estilo de vida remoto.&lt;/p&gt;
&lt;p&gt;Se voc√™ nunca trabalhou remotamente antes, as coisas podem parecer estranhas no in√≠cio. A nova rotina parece bastante glamorosa em posts de blog, mas n√£o √© t√£o fant√°stico: requer autodisciplina, responsabilidade, habilidades sociais e um investimento razo√°vel para montar seu espa√ßo. Por√©m, √© um caminho sem volta: flexibilidade de tempo, redu√ß√£o de custo de vida, espa√ßo de trabalho confort√°vel e mais tempo livre. Depois de experimentar isso, √© prov√°vel que voc√™ n√£o queira mais seguir a rotina di√°ria do escrit√≥rio.&lt;/p&gt;
&lt;h2&gt;Benef√≠cios&lt;/h2&gt;
&lt;p&gt;Trabalhar remotamente √© uma experi√™ncia de mudan√ßa de vida que tem me ajudado a viver diferente. At√© agora, experimentei os benef√≠cios abaixo:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Trabalhando remotamente voc√™ &lt;strong&gt;se v√™ como um cidad√£o global&lt;/strong&gt; porque, agora, n√£o importa onde a empresa est√° localizada.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Soft Skills&lt;/strong&gt; s√£o rapidamente desenvolvidas devido √† nova forma de relacionamento com as pessoas.&lt;/li&gt;
&lt;li&gt;Ao n√£o se deslocar &lt;strong&gt;voc√™ economiza um tempo extra&lt;/strong&gt; que pode ser usado para estudar, relaxar ou retomar aquele projeto paralelo que voc√™ prometeu entregar.&lt;/li&gt;
&lt;li&gt;Voc√™ adota uma &lt;strong&gt;rotina menos estressante&lt;/strong&gt;, uma vez que n√£o precisa enfrentar engarrafamentos ou rel√≥gio em seu trabalho no escrit√≥rio.&lt;/li&gt;
&lt;li&gt;A &lt;strong&gt;flexibilidade de tempo&lt;/strong&gt; torna-se poss√≠vel porque voc√™ pode configurar a rotina que funciona para voc√™.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Desvantagens&lt;/h2&gt;
&lt;p&gt;Apesar de parecer um trabalho perfeito possui alguns inconvenientes que merecem aten√ß√£o.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Voc√™ pode ser levado a uma &lt;strong&gt;rotina presa dentro de casa&lt;/strong&gt;, especialmente se trabalhar apenas em casa.&lt;/li&gt;
&lt;li&gt;√â muito prov√°vel que aconte√ßa &lt;strong&gt;excesso de trabalho&lt;/strong&gt; porque voc√™ n√£o ter√° que bater seu ponto e poder√° se sentir compelido a trabalhar o tempo todo.&lt;/li&gt;
&lt;li&gt;Sua &lt;strong&gt;produtividade&lt;/strong&gt; torna-se uma quest√£o para ficar mais atento pois as TVs, a fam√≠lia e o ambiente dom√©stico podem facilmente distra√≠-lo.&lt;/li&gt;
&lt;li&gt;O sentimento de &lt;strong&gt;solid√£o&lt;/strong&gt; pode surgir devido √† falta de pessoas por perto.&lt;/li&gt;
&lt;li&gt;Fica &lt;strong&gt;mais dif√≠cil desenvolver conex√µes com as pessoas&lt;/strong&gt; devido ao pr√≥prio regime de trabalho. N√£o existem coisas como um espa√ßo compartilhado para conversar ou um almo√ßo com colegas de trabalho.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Aprendizados&lt;/h2&gt;
&lt;p&gt;Voc√™ ponderou os pr√≥s e os contras e decidiu embarcar nessa jornada. Para ajud√°-lo, listei algumas li√ß√µes aprendidas at√© agora:&lt;/p&gt;
&lt;h5&gt;A disciplina vem com uma rotina que dura&lt;/h5&gt;
&lt;p&gt;Se voc√™ se permitir uma rotina desorganizada, sua vida ser√° uma bagun√ßa. Em uma semana comum uma pessoa tem: reuni√µes, resultados a cumprir, e-mails para responder, atividades pessoais (academia, faculdade, etc.), tarefas e assim por diante. Outras pessoas podem discordar, mas, na minha opini√£o, se voc√™ n√£o se autodisciplinar, perder√° o controle de suas responsabilidades porque nada ter√° tempo para acontecer. N√£o h√° solu√ß√£o m√°gica para se tornar uma pessoa com m√≠nimo autodisciplina. No entanto, a chave para come√ßar √© definir uma rotina que se adapte a voc√™ e cumpri-la.&lt;/p&gt;
&lt;p&gt;A chave aqui √© desenvolver um ritual que seja realizado todos os dias para fazer seu c√©rebro entrar na zona. Por exemplo, todos os dias eu (i) acordo; (ii) tomo banho; (iii) tomo caf√© da manh√£; (iv) escovo os dentes; (v) pego uma caneca com caf√©; (vi) vou ao meu escrit√≥rio em casa; (vii) abro o computador; (viii) come√ßo a trabalhar. Voc√™ pode achar que √© bobagem, mas depois de algumas semanas voc√™ vai se acostumar a trabalhar em casa.&lt;/p&gt;
&lt;h5&gt;N√£o, voc√™ n√£o pode trabalhar em seu quarto&lt;/h5&gt;
&lt;p&gt;N√£o se trata de trabalhar em seu quarto. √â sobre n√£o trabalhar em um local cheio de distra√ß√µes. √â f√°cil ser atra√≠do por uma cama confort√°vel ou por um bom programa de TV. Evite distra√ß√µes. Eles afetam drasticamente a sua produtividade. Se poss√≠vel, crie um lugar onde voc√™ automaticamente entre no clima quando entrar. N√£o precisa ser necessariamente um escrit√≥rio, mas deve ser um lugar onde voc√™ tenha privacidade para trabalhar.&lt;/p&gt;
&lt;h5&gt;Ser pontual&lt;/h5&gt;
&lt;p&gt;Se voc√™ trabalha para uma empresa verdadeiramente remota, √© comum conversar com pessoas de diferentes fusos hor√°rios. Por isso, encontrar um hor√°rio que funcione para todos pode parecer um desafio e voc√™ deve respeit√°-lo. Fa√ßa o seu melhor para chegar na hora certa. N√£o √© apenas uma quest√£o de respeito, mas tamb√©m de profissionalismo.&lt;/p&gt;
&lt;h5&gt;Invista em sua infraestrutura&lt;/h5&gt;
&lt;p&gt;Fa√ßa o poss√≠vel para ter uma conex√£o com a Internet capaz de atender as videochamadas, pois elas acontecem o tempo todo. Tamb√©m √© aconselh√°vel ter um plano de backup, como uma boa internet m√≥vel no telefone no caso de sua conex√£o cair.&lt;/p&gt;
&lt;p&gt;Al√©m da conex√£o, √© importante configurar um espa√ßo confort√°vel, pois voc√™ passar√° 8 horas ou mais trabalhando. Pense na cadeira, na mesa, na tela e no computador. Se poss√≠vel, fa√ßa de uma sala privada seu escrit√≥rio pessoal.&lt;/p&gt;
&lt;h5&gt;Solid√£o&lt;/h5&gt;
&lt;p&gt;√â bastante desafiador trabalhar remotamente se voc√™ for uma pessoa soci√°vel e franca. Basicamente, o n√∫mero de itera√ß√µes online (chats, chamadas de v√≠deo, e-mails) aumenta muito, mas o offline diminui. Isso cria uma atmosfera incomum em que voc√™ pode sentir a necessidade de ver as pessoas ao seu redor. Para equilibrar isso, voc√™ pode procurar diferentes locais para trabalhar (como escrit√≥rios de coworking) e trazer para sua rotina atividades que envolvam intera√ß√£o social (por exemplo, fazer exerc√≠cios na academia, almo√ßar em um restaurante uma vez por semana, etc).&lt;/p&gt;
&lt;h5&gt;Fam√≠lia e amigos&lt;/h5&gt;
&lt;p&gt;A distra√ß√£o pode ser um problema se voc√™ dividir o apartamento com amigos / fam√≠lia / etc, porque eles olhar√£o para voc√™ e presumir√£o que voc√™ est√° dispon√≠vel para ser interrompido / questionado / distra√≠do. √â um processo normal que quase todo mundo enfrenta porque trabalhar remotamente √© uma mudan√ßa de paradigma que tem acontecido recentemente. Estabele√ßa uma regra ou ritual claro para se distrair, caso contr√°rio, isso diminuir√° sua produtividade. Pense em algumas regras como: toda vez que me levanto para pegar um caf√©; ou voc√™ pode usar a T√©cnica Pomodoro e fazer o check-in durante as paradas; ou voc√™ pode receber uma mensagem de texto; tudo o que funciona para voc√™.&lt;/p&gt;
&lt;h5&gt;Excesso de trabalho&lt;/h5&gt;
&lt;p&gt;Trabalhar em casa d√° a sensa√ß√£o de ter mais tempo para fazer as coisas. Esse comportamento o leva a trabalhar mais horas em vez de us√°-las para fazer algo produtivo para sua pr√≥pria vida. A chave √© equilibrar suas horas de trabalho com sua vida pessoal, mantendo o controle de quanto tempo voc√™ trabalha, qu√£o produtivo voc√™ √© e quanto tempo ainda resta. N√£o ter tempo para uma vida pessoal n√£o √© saud√°vel.&lt;/p&gt;
&lt;h5&gt;Exerc√≠cio&lt;/h5&gt;
&lt;p&gt;Como diz o ditado &lt;em&gt;Mens sana in corpore sano&lt;/em&gt; (Mente s√£ em um corpo s√£o). Eu preciso te contar alguma coisa? =)&lt;/p&gt;
&lt;p&gt;Isso √© tudo, pessoal. Se voc√™ tiver alguma d√∫vida, por favor me avise.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Remote Lifestyle]]></title><description><![CDATA[TL;DR It‚Äôs been three months working remotely and I want to share what I learnt from the perspective of a person that has never worked‚Ä¶]]></description><link>https://vcrmartinez.com/2018/2018-01-12-Remote_lifestyle/</link><guid isPermaLink="false">https://vcrmartinez.com/2018/2018-01-12-Remote_lifestyle/</guid><pubDate>Fri, 12 Jan 2018 00:00:00 GMT</pubDate><content:encoded>&lt;h4&gt;TL;DR&lt;/h4&gt;
&lt;p&gt;It‚Äôs been three months working remotely and I want to share what I learnt from the perspective of a person that has never worked remotely before.&lt;/p&gt;
&lt;p&gt;‚Äî&lt;/p&gt;
&lt;p&gt;2017 was a very though year but, as the saying goes, &lt;em&gt;smooth seas never made a skilled sailor&lt;/em&gt;. I was working with PHP and the framework Neos Flow but I wanted to work with Python. Unfortunately the city I live in does not provide lots of opportunities and I could not accept the scenario.&lt;/p&gt;
&lt;p&gt;The strategy was: (i) beef up my skills; (ii) update my CV; (iii) look for jobs; (iv) send my CV to companies aligned with my profile. Few months later I was pleased to join a great team and, since then, I have been learning not only technical skills but also how to adapt myself to the so wanted remote lifestyle.&lt;/p&gt;
&lt;p&gt;If you have never worked remotely before, things might seem weird at first. The new routine seems pretty glamourous in blog posts but it is not that fancy: it requires self-discipline, accountability, soft skills and a reasonable investment to set up your space. However, it is a way with no return: time flexibility, living cost reduction, comfort work space and more free time. After experiencing that it is likely you do not want to commute ever again.&lt;/p&gt;
&lt;h2&gt;Benefits&lt;/h2&gt;
&lt;p&gt;Working remotely is a life-changing experience that has helping me to live a different life. So far, I have experienced the benefits below:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;By working remotely you &lt;strong&gt;see yourself as a global citizen&lt;/strong&gt; because, now, it does not matter where the company is based.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Soft Skills&lt;/strong&gt; are fastly developed due to the new way of relating to people.&lt;/li&gt;
&lt;li&gt;By not commuting &lt;strong&gt;you save an extra time&lt;/strong&gt; that can be used to study, relax or resume that side project you promised to deliver.&lt;/li&gt;
&lt;li&gt;You embrace a &lt;strong&gt;less stressful routine&lt;/strong&gt; once you do not have to face traffic jams or clock in your work in the office.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Time flexibility&lt;/strong&gt; becomes possible because you can set up the routine that works for you.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Drawbacks&lt;/h2&gt;
&lt;p&gt;Despite of seeming the perfect work it has some drawbacks that deserve attention.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You might be driven to a &lt;strong&gt;routine stuck at home&lt;/strong&gt; especially if you only work at home.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Overworking&lt;/strong&gt; is very likely to happen because you won‚Äôt have to clock in your work and you might feel compelled to work all time.&lt;/li&gt;
&lt;li&gt;Your &lt;strong&gt;productivity&lt;/strong&gt; becomes an issue to be more attentive because TVs, family and the home atmosphere can easily distract you.&lt;/li&gt;
&lt;li&gt;The feeling of &lt;strong&gt;loneliness&lt;/strong&gt; can emerge due to the lack of people around.&lt;/li&gt;
&lt;li&gt;It gets &lt;strong&gt;harder to develop connections with people&lt;/strong&gt; because of the work regime itself. There are no such things like a shared space to chat or a lunch time with workmates.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Lessons&lt;/h2&gt;
&lt;p&gt;You have pondered the pros and cons and decided to embark on this journey. To help you I have listed some lessons learned so far:&lt;/p&gt;
&lt;h5&gt;Discipline comes with a routine that sticks&lt;/h5&gt;
&lt;p&gt;If you allow yourself to have an unorganized routine your life will be a mess. On a common week a person have: meetings, deliverables to accomplish, emails to reply, personal activities (gym, college, etc), errands and so on. Other people might disagree but, in my opinion, if you do not get self-disciplined you will lose control of your responsibilities because nothing will have time to happen. There is no silver bullet to become a minimum self-disciplined person. However, the key to start is defining a routine that suits you and stick to it.&lt;/p&gt;
&lt;p&gt;The key here is to develop a ritual that is performed everyday in order to make your brain getting in to the zone. For example, everyday I (i) wake up; (ii) take a shower; (iii) have breakfast; (iv) brush my teeth; (v) grab a mug with coffee; (vi) go to my home office; (vii) open the computer; (viii) start working. You might think it is silly, but after some weeks you will get used to working at home.&lt;/p&gt;
&lt;h5&gt;No, you can not work in your bedroom&lt;/h5&gt;
&lt;p&gt;It is not about working in your bedroom. It is about not working in a place full of distractions. It is easy to get lured by a comfy bed or a nice TV show. Avoid distractions. They drastically impact on your productivity. If possible set up a place where you automatically get into the mood when you come in. It does not have to be an office necessarily but it must be a place where you have privacy to work.&lt;/p&gt;
&lt;h5&gt;Be on time&lt;/h5&gt;
&lt;p&gt;If you work for a true remote company it is common to talk to people from different timezones. Due to that, finding a time that works for everyone might seem a challenge and you must respect it. Do your best to be on time. It is not only a matter of respect but also a matter of professionalism.&lt;/p&gt;
&lt;h5&gt;Invest in your infrastructure&lt;/h5&gt;
&lt;p&gt;Do your best to have an Internet connection capable of taking care of video calls because they happen all the time. It is also advisable to have a backup plan like a good mobile internet on the phone in the case of your connection goes down.&lt;/p&gt;
&lt;p&gt;Besides connection, it is important to setup a comfortable space because you will spend 8 hours or more working. Think about the chair, desk, screen and computer. If possible, make a private room your personal office.&lt;/p&gt;
&lt;h5&gt;Loneliness&lt;/h5&gt;
&lt;p&gt;It is quite challenging to work remotely if you are a social-and-outspoken person. Basically the number of online iteractions (chats, video calls, emails) highly increases but the offline decreases. It creates an unusual atmosphere that you might feel the necessity to see people around. To balance that you can look for different places to work (like coworking offices) and bring to your routine activities that involve involve social interaction (e.g. doing exercises in the Gym, to have lunch in a restaurant once a week, etc).&lt;/p&gt;
&lt;h5&gt;Family and Friends&lt;/h5&gt;
&lt;p&gt;Distraction can be an issue if you share the apartment with friends/family/etc because they will look at you and assume you are available to be interrupted/asked/distracted. It is a normal process almost everybody faces because working remotely is a paradigm shift that has been happening recently. Establish a clear rule or ritual to be distracted otherwise it will slow down your productivity. Think about some rules like: every time I stand up to grab a coffee; or you can use Pomodoro Technique and check in during the stops; or you can be texted; whatever it works for you.&lt;/p&gt;
&lt;h5&gt;Overworking&lt;/h5&gt;
&lt;p&gt;Working at home give to you the sensation of having more time to get the things done. That behavior lead you to working more hours instead of using them to do something productive to your own life. The key is to balance your working hours with your personal life by keeping track of how much time you work, how productive you are and how much time left you have gotten. Not having time to a personal life is not healthy.&lt;/p&gt;
&lt;h5&gt;Exercise&lt;/h5&gt;
&lt;p&gt;As the saying goes &lt;em&gt;Mens sana in corpore sano&lt;/em&gt; (A sound mind is in a sound body). Do I need to tell you anything? =)&lt;/p&gt;
&lt;p&gt;That‚Äôs all folks. If you got any question please let me know.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Provendo arquivos est√°ticos na sua aplica√ß√£o Django com Amazon S3]]></title><description><![CDATA[√â sabido que Django n√£o prov√™ arquivos est√°ticos. Usar um middleware WSGI para endere√ßar essa quest√£o n√£o √© o jeito correto de servir‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-08-21-Provendo_arquivos_estaticos_na_sua_aplicacao_Django_com_Amazon_S3/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-08-21-Provendo_arquivos_estaticos_na_sua_aplicacao_Django_com_Amazon_S3/</guid><pubDate>Mon, 21 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;√â sabido que Django n√£o prov√™ arquivos est√°ticos. Usar um middleware WSGI para endere√ßar essa quest√£o n√£o √© o jeito correto de servir arquivos est√°ticos e, portanto, este post apresenta como voc√™ pode fazer isso usando a Amazon S3.&lt;/p&gt;
&lt;h3&gt;Django backend storages&lt;/h3&gt;
&lt;p&gt;Django usa uma arquitetura de &lt;em&gt;backend storages&lt;/em&gt; para armazenar dados (&lt;em&gt;e.g.&lt;/em&gt; &lt;a href=&quot;https://docs.djangoproject.com/en/1.11/ref/files/storage/&quot;&gt;FileSystemStorage&lt;/a&gt; √© respons√°vel por salvar arquivos no sistema de arquivos). Entretanto, voc√™ pode querer adotar uma abordagem diferente e, assim, implementar a &lt;a href=&quot;https://docs.djangoproject.com/en/1.11/howto/custom-file-storage/&quot;&gt;Storage Interface&lt;/a&gt; permite criar a sua pr√≥pria estrat√©gia. Um projeto chamado &lt;a href=&quot;https://github.com/jschneier/django-storages&quot;&gt;django-storages&lt;/a&gt; j√° pensou nesses problemas e implementou um armazenamento que envia os arquivos para a Amazon S3 com praticamennte zero esfor√ßo. Vamos us√°-lo!&lt;/p&gt;
&lt;h3&gt;Criando um bucket na Amazon S3&lt;/h3&gt;
&lt;p&gt;Acesse a Amazon S3, crie um bucket com dois diret√≥rios dentro: &lt;em&gt;static&lt;/em&gt; e &lt;em&gt;media&lt;/em&gt;. Neste exemplo assumiremos que a listagem dos objetos no S3 √© p√∫blica.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Neste post n√≥s falamos sobre diret√≥rios mas √© apenas uma abstra√ß√£o para facilitar o entendimento. A &lt;a href=&quot;http://docs.aws.amazon.com/AmazonS3/latest/UG/FolderOperations.html&quot;&gt;documenta√ß√£o do S3&lt;/a&gt; explica que &lt;em&gt;buckets&lt;/em&gt; e objetos s√£o os recursos prim√°rios e que n√£o existe a hierarquia que ocorre em um sistema de arquivos convencional.&lt;/p&gt;
&lt;h3&gt;Instala√ß√£o e requisitos&lt;/h3&gt;
&lt;p&gt;Voc√™ vai precisar instalar o &lt;a href=&quot;https://github.com/boto/boto3&quot;&gt;boto&lt;/a&gt; e o &lt;a href=&quot;https://github.com/jschneier/django-storages&quot;&gt;django-storages&lt;/a&gt;. Como explicado anteriormente, &lt;em&gt;django-storages&lt;/em&gt; vai nos ajudar a enviar arquivos para a Amazon S3. Entretanto, n√≥s precisamos instalar o &lt;em&gt;boto&lt;/em&gt; pois ele √© respons√°vel por conectar com os servi√ßos da Amazon.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Este post usa &lt;a href=&quot;https://github.com/henriquebastos/python-decouple&quot;&gt;python-decouple&lt;/a&gt; para gerenciar o ambiente local. Se voc√™ n√£o sabe como d√™ uma olhada neste &lt;a href=&quot;/pt/blog/2017/2017-08-15-Prepare_sua_aplicacao_Django_para_ser_disponibilizada_no_Heroku&quot;&gt;post&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Criando nosssos backends customizados&lt;/h3&gt;
&lt;p&gt;No nosso diret√≥rio de configura√ß√£o n√≥s vamos criar os backends respons√°veis por lidar com a Amazon S3. Crie um arquivo chamado &lt;em&gt;s3util.py&lt;/em&gt; e adicione o conte√∫do abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;conf &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; settings
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; storages&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;backends&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;s3boto &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; S3BotoStorage


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StaticStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3BotoStorage&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    location &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;STATICFILES_LOCATION


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MediaStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3BotoStorage&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    location &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MEDIAFILES_LOCATION&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Linhas 1-2: Importa os m√≥dulos.&lt;/li&gt;
&lt;li&gt;Linhas 5-10: Representa nossos storages. O atributo &lt;code class=&quot;language-text&quot;&gt;location&lt;/code&gt; √© configurado para armazenar a localiza√ß√£o dos arquivos &lt;em&gt;static&lt;/em&gt; e &lt;em&gt;media&lt;/em&gt; definidos no arquivo &lt;em&gt;settings.py&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Configurando as vari√°veis da Amazon S3&lt;/h3&gt;
&lt;p&gt;Assumindo que voc√™ j√° tem um bucket dispon√≠vel, vamos adicionar algumas vari√°veis ao arquivo &lt;em&gt;settings.py&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; decouple &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; config

&lt;span class=&quot;token comment&quot;&gt;# AWS&lt;/span&gt;
AWS_S3_SECURE_URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
AWS_QUERYSTRING_AUTH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;
AWS_PRELOAD_METADATA &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
AWS_STORAGE_BUCKET_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-BUCKET-NAME&gt;&apos;&lt;/span&gt;
AWS_ACCESS_KEY_ID &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;AWS_ACCESS_KEY_ID&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
AWS_SECRET_ACCESS_KEY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;AWS_SECRET_ACCESS_KEY&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

STATICFILES_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;STATICFILES_STORAGE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;django.contrib.staticfiles.storage.StaticFilesStorage&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
DEFAULT_FILE_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DEFAULT_FILE_STORAGE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;django.core.files.storage.FileSystemStorage&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

STATIC_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;STATIC_URL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/static/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
MEDIA_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;MEDIA_URL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/media/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

AWS_HEADERS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;x-amz-acl&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public-read&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;Cache-Control&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public, max-age=31556926&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

STATICFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;static&apos;&lt;/span&gt;
MEDIAFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;media&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Linha 1: Certifique-se de importar o m√≥dulo de configura√ß√£o. Ele vai procurar as vari√°veis de ambiente ou um arquivo &lt;code class=&quot;language-text&quot;&gt;.env&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Linha 4: Use urls com SSL para servir os objetos do S3.&lt;/li&gt;
&lt;li&gt;Linha 5: N√≥s n√£o queremos gerar uma querystring de autentica√ß√£o para o S3.&lt;/li&gt;
&lt;li&gt;Linha 6: Queremos fazer o pr√©-carregamento de metadados do S3.&lt;/li&gt;
&lt;li&gt;Linha 7: √â necess√°rio fornecer o nome do bucket.&lt;/li&gt;
&lt;li&gt;Linhas 8-9: &lt;code class=&quot;language-text&quot;&gt;config&lt;/code&gt; vai procurar pelas vari√°veis de ambiente ou por um arquivo &lt;code class=&quot;language-text&quot;&gt;.env&lt;/code&gt;. No ambiente local elas estar√£o em branco pois n√£o enviaremos para o S3. Entretanto, em produ√ß√£o n√≥s iremos configurar essas vari√°veis.&lt;/li&gt;
&lt;li&gt;Linhas 11-12: Essas vari√°veis ir√£o explicitamente definir qual storage nosso projeto vai utilizar para armazenar os arquivos est√°ticos. No ambiente local ser√° o backend comum (StaticFilesStorage e FileSystemStorage). Entretanto, em produ√ß√£o, iremos deixar configurado os backends respons√°veis por enviar os arquivos para o S3.&lt;/li&gt;
&lt;li&gt;Linhas 14-15: Aponta para as URLs de arquivos est√°ticos e m√≠dias. Em produ√ß√£o eles v√£o armazenar a URL da Amazon S3 que corresponde a cada tipo de arquivo.&lt;/li&gt;
&lt;li&gt;Linhas 17-20: Cabe√ßalhos AWS que explicitam a pol√≠tica de cache.&lt;/li&gt;
&lt;li&gt;Linhas 22-23: Vari√°veis que informam nosso backend onde encontrar os arquivos de m√≠dia e est√°ticos. Elas s√£o usadas no arquivo &lt;em&gt;s3utils.py&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Vari√°veis Locais&lt;/h3&gt;
&lt;p&gt;Em resumo, nossas vari√°veis locais v√£o acabar sendo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;AWS_S3_SECURE_URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; True
AWS_QUERYSTRING_AUTH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; False
AWS_PRELOAD_METADATA &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; True
AWS_STORAGE_BUCKET_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;BUCKET-NAME&apos;&lt;/span&gt;
AWS_ACCESS_KEY_ID &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;
AWS_SECRET_ACCESS_KEY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;

STATICFILES_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;django.contrib.staticfiles.storage.StaticFilesStorage&apos;&lt;/span&gt;
DEFAULT_FILE_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;django.core.files.storage.FileSystemStorage&apos;&lt;/span&gt;

STATIC_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/static/&apos;&lt;/span&gt;
MEDIA_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/media/&apos;&lt;/span&gt;

AWS_HEADERS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;x-amz-acl&apos;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public-read&apos;&lt;/span&gt;,
    &lt;span class=&quot;token string&quot;&gt;&apos;Cache-Control&apos;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public, max-age=31556926&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

STATICFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;static&apos;&lt;/span&gt;
MEDIAFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;media&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Vari√°veis de Produ√ß√£o&lt;/h3&gt;
&lt;p&gt;√â necess√°rio configurar as vari√°veis de produ√ß√£o:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-ACCESS-KEY&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-SECRET-KEY&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;DEFAULT_FILE_STORAGE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;config.s3util.MediaStorage&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;STATICFILES_STORAGE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;config.s3util.StaticStorage&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;MEDIA_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://s3.amazonaws.com/&amp;lt;YOUR-BUCKET-NAME&gt;/media/&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;STATIC_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://s3.amazonaws.com/&amp;lt;YOUR-BUCKET-NAME&gt;/static/&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Voc√™ pode passar m√∫ltiplas vari√°veis em apenas uma declara√ß√£o:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-ACCESS-KEY&gt;&apos;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-SECRET-KEY&gt;&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Enviando arquivos para o S3&lt;/h3&gt;
&lt;p&gt;De agora em diante, toda vez que voc√™ disponibilizar seu projeto no Heroku ele vai enviar os arquivos para a Amazon S3. Isso vai acontecer pois o Heroku executa &lt;code class=&quot;language-text&quot;&gt;$ python manage.py collectstatic&lt;/code&gt; durante o pipeline de deploy e esse comando coleta os arquivos est√°ticos e salva-os. Nosso backend de produ√ß√£o salva no S3 todos os arquivos.&lt;/p&gt;
&lt;p&gt;Se voc√™ n√£o estiver usando Heroku certifique-se de executar &lt;code class=&quot;language-text&quot;&gt;python manage.py collectstatic&lt;/code&gt; em produ√ß√£o.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Um teste pode ser feito ao configurar as vari√°veis de produ√ß√£o no ambiente local. Dessa forma, se voc√™ executar o comando &lt;code class=&quot;language-text&quot;&gt;collectstatic&lt;/code&gt; ele ir√° enviar os arquivos para o S3. Apenas certifique-se de remov√™-las ap√≥s testar.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Providing static files in your Django app with Amazon S3]]></title><description><![CDATA[It is well-known that Django does not provide static files. Using a WSGI Middleware to address the issue is not the right way to provide‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-08-21-Providing_static_files_in_your_Django_app_with_Amazon_S3/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-08-21-Providing_static_files_in_your_Django_app_with_Amazon_S3/</guid><pubDate>Mon, 21 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;It is well-known that Django does not provide static files. Using a WSGI Middleware to address the issue is not the right way to provide static files and, thus, this post show how you can do it using Amazon S3.&lt;/p&gt;
&lt;h3&gt;Django backend storages&lt;/h3&gt;
&lt;p&gt;Django uses an architecture of backend storages to store data (e.g. the &lt;a href=&quot;https://docs.djangoproject.com/en/1.11/ref/files/storage/&quot;&gt;FileSystemStorage&lt;/a&gt; is responsible for saving files in the current file system). However, you might want to adopt a different approach and, thus, by following the &lt;a href=&quot;https://docs.djangoproject.com/en/1.11/howto/custom-file-storage/&quot;&gt;Storage Interface&lt;/a&gt; it is possible to implement your own way to handle storage. A project called &lt;a href=&quot;https://github.com/jschneier/django-storages&quot;&gt;django-storages&lt;/a&gt; has already thought about common problems and implemented for us a storage that send files to Amazon S3 with almost no effort required. Let‚Äôs use it!&lt;/p&gt;
&lt;h3&gt;Creating an Amazon S3 bucket&lt;/h3&gt;
&lt;p&gt;Go to Amazon S3, create a bucket with two folders inside: &lt;em&gt;static&lt;/em&gt; and &lt;em&gt;media&lt;/em&gt;. In this example it is assumed there is a public access for listing your S3 objects.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; In this post we talk about folders but it is just an abstraction. The &lt;a href=&quot;http://docs.aws.amazon.com/AmazonS3/latest/UG/FolderOperations.html&quot;&gt;S3 documentation&lt;/a&gt; explains that buckets and objects are the primary resources and there is no such hierarchy like a typical file system.&lt;/p&gt;
&lt;h3&gt;Install the requirements&lt;/h3&gt;
&lt;p&gt;You will need to install the &lt;a href=&quot;https://github.com/boto/boto3&quot;&gt;boto&lt;/a&gt; and &lt;a href=&quot;https://github.com/jschneier/django-storages&quot;&gt;django-storages&lt;/a&gt; packages.&lt;/p&gt;
&lt;p&gt;As explained before django-storages will help us to send files to Amazon S3. However, we need to install boto because it will provide the connection to amazon services.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; This post uses &lt;a href=&quot;https://github.com/henriquebastos/python-decouple&quot;&gt;python-decouple&lt;/a&gt; to manage local environments. If you do not know how to use it check this &lt;a href=&quot;/en/blog/2017/2017-08-15-Prepare_your_Django_app_to_be_deployed_at_Heroku/&quot;&gt;post&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Creating our custom backends&lt;/h3&gt;
&lt;p&gt;In our configuration directory we will create the backends responsible to dealing with Amazon S3. Create a file called &lt;em&gt;s3util.py&lt;/em&gt; and add the content below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;conf &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; settings
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; storages&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;backends&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;s3boto &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; S3BotoStorage


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StaticStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3BotoStorage&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    location &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;STATICFILES_LOCATION


&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MediaStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3BotoStorage&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    location &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MEDIAFILES_LOCATION&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Lines 1-2: Import the modules.&lt;/li&gt;
&lt;li&gt;Lines 5-10: Represent our storages. The location attribute is set with the location of static and media files defined in the &lt;em&gt;settings.py&lt;/em&gt; file.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Configuring Amazon S3 variables&lt;/h3&gt;
&lt;p&gt;Assuming you already have an Amazon S3 bucket available, lets add some variables to &lt;em&gt;settings.py&lt;/em&gt; file.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; decouple &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; config

&lt;span class=&quot;token comment&quot;&gt;# AWS&lt;/span&gt;
AWS_S3_SECURE_URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
AWS_QUERYSTRING_AUTH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;
AWS_PRELOAD_METADATA &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;
AWS_STORAGE_BUCKET_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-BUCKET-NAME&gt;&apos;&lt;/span&gt;
AWS_ACCESS_KEY_ID &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;AWS_ACCESS_KEY_ID&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
AWS_SECRET_ACCESS_KEY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;AWS_SECRET_ACCESS_KEY&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

STATICFILES_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;STATICFILES_STORAGE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;django.contrib.staticfiles.storage.StaticFilesStorage&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
DEFAULT_FILE_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DEFAULT_FILE_STORAGE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;django.core.files.storage.FileSystemStorage&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

STATIC_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;STATIC_URL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/static/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
MEDIA_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;MEDIA_URL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/media/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

AWS_HEADERS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;x-amz-acl&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public-read&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;Cache-Control&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public, max-age=31556926&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

STATICFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;static&apos;&lt;/span&gt;
MEDIAFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;media&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Line 1: Make sure you have imported the config module. It will look for the respective env variable and, in case of absence, it looks for an .env file (check this post).&lt;/li&gt;
&lt;li&gt;Line 4: Use secure SSL urls for serving objects from S3.&lt;/li&gt;
&lt;li&gt;Line 5: We don‚Äôt want to generate S3 auth querystring.&lt;/li&gt;
&lt;li&gt;Line 6: We want to preload the S3 metadata.&lt;/li&gt;
&lt;li&gt;Line 7: It is necessary to provide the bucket name you created at Amazon S3.&lt;/li&gt;
&lt;li&gt;Lines 8-9: Config will look for env vars or an .env file with those variables. In a local environment they will be blank because we will not send files to S3 in development mode. However, in production we will set those variables.&lt;/li&gt;
&lt;li&gt;Lines 11-12: Those variables will explicit define which storage our project will use to store the static files. In local environment the default value will be the ordinary backend (StaticFilesStorage and FileSystemStorage). However, in production, we will set the backends responsible for sending the file to S3.&lt;/li&gt;
&lt;li&gt;Lines 14-15: Point to the static and media urls. In production they store the amazon s3 url that correspond to each type (static or media).&lt;/li&gt;
&lt;li&gt;Lines 17-20: AWS Headers that explicit our cache policy.&lt;/li&gt;
&lt;li&gt;Lines 22-23: Those variables tell our backend where are our media and static files. They are used in our s3util.py file.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Local Variables&lt;/h3&gt;
&lt;p&gt;In a nutshell, our local variables will end up being:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;AWS_S3_SECURE_URLS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; True
AWS_QUERYSTRING_AUTH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; False
AWS_PRELOAD_METADATA &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; True
AWS_STORAGE_BUCKET_NAME &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;BUCKET-NAME&apos;&lt;/span&gt;
AWS_ACCESS_KEY_ID &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;
AWS_SECRET_ACCESS_KEY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;

STATICFILES_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;django.contrib.staticfiles.storage.StaticFilesStorage&apos;&lt;/span&gt;
DEFAULT_FILE_STORAGE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;django.core.files.storage.FileSystemStorage&apos;&lt;/span&gt;

STATIC_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/static/&apos;&lt;/span&gt;
MEDIA_URL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/media/&apos;&lt;/span&gt;

AWS_HEADERS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;x-amz-acl&apos;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public-read&apos;&lt;/span&gt;,
    &lt;span class=&quot;token string&quot;&gt;&apos;Cache-Control&apos;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;public, max-age=31556926&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

STATICFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;static&apos;&lt;/span&gt;
MEDIAFILES_LOCATION &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;media&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Production Variables&lt;/h3&gt;
&lt;p&gt;It is necessary to set the production variables.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-ACCESS-KEY&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-SECRET-KEY&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;DEFAULT_FILE_STORAGE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;config.s3util.MediaStorage&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;STATICFILES_STORAGE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;config.s3util.StaticStorage&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;MEDIA_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://s3.amazonaws.com/&amp;lt;YOUR-BUCKET-NAME&gt;/media/&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;STATIC_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;https://s3.amazonaws.com/&amp;lt;YOUR-BUCKET-NAME&gt;/static/&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; You can pass multiple variables in one declaration:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_ACCESS_KEY_ID&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-ACCESS-KEY&gt;&apos;&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;AWS_SECRET_ACCESS_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR-SECRET-KEY&gt;&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;. -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Sending files to S3&lt;/h3&gt;
&lt;p&gt;From now on every time you push your project to Heroku it will send the files to Amazon S3. That will happen because Heroku executes &lt;code class=&quot;language-text&quot;&gt;$ python manage.py collectstatic&lt;/code&gt; during the deploy pipeline and that command will collect the static files and save it. Once our production backend saves into S3 all files will be sent to the remote server.&lt;/p&gt;
&lt;p&gt;If you are not using Heroku make sure you run &lt;code class=&quot;language-text&quot;&gt;python manage.py collectstatic&lt;/code&gt; in production.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; A test can be done locally by setting the production variables in the local environment. That way, if you run the collectstatic command it will send the files to S3. Just make sure to unset them after that.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Prepare sua aplica√ß√£o Django para ser disponibilizada no Heroku]]></title><description><![CDATA[√â bem animador construir nossos pr√≥prios projetos e v√™-los funcionar em produ√ß√£o, certo? Alguns desenvolvedores podem pensar que fazer o‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-08-15-Prepare_sua_aplicacao_Django_para_ser_disponibilizada_no_Heroku/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-08-15-Prepare_sua_aplicacao_Django_para_ser_disponibilizada_no_Heroku/</guid><pubDate>Tue, 15 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;√â bem animador construir nossos pr√≥prios projetos e v√™-los funcionar em produ√ß√£o, certo? Alguns desenvolvedores podem pensar que fazer o deploy de uma aplica√ß√£o Django √© um pesadelo. Neste post eu vou mostrar como preparar sua aplica√ß√£o para ter diferentes configura√ß√µes e efetuar o deploy no Heroku.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Requisitos:&lt;/strong&gt; Voc√™ precisa instalar o &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-cli&quot;&gt;Heroku CLI&lt;/a&gt; e o &lt;strong&gt;GIT&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Heroku&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://www.heroku.com&quot;&gt;Heroku&lt;/a&gt; √© um PaaS (Plataforma como Servi√ßo) que vai disponibilizar nosso projeto na web. √â preciso que voc√™ acesse o &lt;a href=&quot;https://dashboard.heroku.com/apps&quot;&gt;dashboard&lt;/a&gt; e crie uma nova aplica√ß√£o.&lt;/p&gt;
&lt;p&gt;Um vez criada sua aplica√ß√£o, √© necess√°rio usar o terminal para configurar as credenciais. Para isso, usamos o Heroku CLI para acessar as configura√ß√µes do app (d√™ uma olhada na &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-cli&quot;&gt;docs&lt;/a&gt; para instalar propriamente).&lt;/p&gt;
&lt;p&gt;Ap√≥s a instala√ß√£o voc√™ pode efetuar o login e j√° adicionar um banco Postgres √† sua aplica√ß√£o:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku login
heroku addons:create heroku-postgresql:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-plan-name&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-application-name&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Mais tarde usaremos o Postgres. Heroku nos ajuda a provisionar um banco de dados com um comando. √â bem f√°cil e voc√™ pode aprender sobre isso na &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-postgresql#provisioning-heroku-postgres&quot;&gt;docs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Dica:&lt;/strong&gt; O comando &lt;code class=&quot;language-text&quot;&gt;$ heroku apps&lt;/code&gt; √© bem √∫til e nos permite listar os apps que temos.&lt;/p&gt;
&lt;h2&gt;Preparando nossa aplica√ß√£o&lt;/h2&gt;
&lt;p&gt;Quando se trata de gerenciar os ambientes local e de produ√ß√£o eu gosto de usar o &lt;a href=&quot;https://github.com/henriquebastos/python-decouple&quot;&gt;python decouple&lt;/a&gt; pois ele permite gerenciar as vari√°veis de ambiente e, com isso, ter diferentes configura√ß√µes. Al√©m dele, eu uso o &lt;a href=&quot;https://github.com/kennethreitz/dj-database-url&quot;&gt;dj&lt;em&gt;database&lt;/em&gt;url&lt;/a&gt; para tornar simples o uso de diferentes bancos de dados por meio de strings de configura√ß√£o.&lt;/p&gt;
&lt;p&gt;1. Primeiro, crie dois arquivos: &lt;em&gt;.env&lt;/em&gt; e &lt;em&gt;.env-sample&lt;/em&gt;. O primeiro ser√° usado no nosso ambiente local e deve ser ignorado pelo GIT. O segundo funciona como um template:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;SECRET_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;YOUR_KEY_GOES_HERE
&lt;span class=&quot;token assign-left variable&quot;&gt;DEBUG&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;True
&lt;span class=&quot;token assign-left variable&quot;&gt;ALLOWED_HOSTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1,localhost,.herokuapp.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2. Abra seu &lt;em&gt;settings.py&lt;/em&gt;, e cole o c√≥digo abaixo:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; decouple &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Csv
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; dj_database_url &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; parse &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; dburl

SECRET_KEY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;SECRET_KEY&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
DEBUG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DEBUG&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cast&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

ALLOWED_HOSTS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ALLOWED_HOSTS&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cast&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Csv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

DEFAULT_DBURL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sqlite:///&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;BASE_DIR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;db.sqlite3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
DATABASES &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;default&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DATABASE_URL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;DEFAULT_DBURL&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cast&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dburl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As primeiras duas linhas importam os m√≥dulos enquanto as outras apenas carregam as vari√°veis de ambiente. O par√¢metro &lt;code class=&quot;language-text&quot;&gt;cast&lt;/code&gt; √© obrigat√≥rio pois vari√°veis de ambiente s√£o strings e √© importante converter o valor para o tipo de dado correto.&lt;/p&gt;
&lt;p&gt;Preste aten√ß√£o √†s vari√°veis &lt;code class=&quot;language-text&quot;&gt;DEFAULT_DBURL&lt;/code&gt; e &lt;code class=&quot;language-text&quot;&gt;DATABASES&lt;/code&gt;. A primeira usa o Sqlite no ambiente local mas no Heroku n√≥s iremos configur√°-la para armazenar a URL de configura√ß√£o do Postgres.&lt;/p&gt;
&lt;h2&gt;Subindo para o Heroku&lt;/h2&gt;
&lt;p&gt;N√≥s criamos nossa aplica√ß√£o no Heroku, adicionamos um banco de dados Postgres e configuramos o projeto para aceitar diferentes strings de configura√ß√£o. Agora √© hora de disponibilizar nossa aplica√ß√£o!&lt;/p&gt;
&lt;h6&gt;Certifique-se de que seu arquivo requirements.txt cont√©m todas as depend√™ncias&lt;/h6&gt;
&lt;p&gt;Ele deve ter, ao menos: &lt;em&gt;dj-database-url&lt;/em&gt;, &lt;em&gt;gunicorn&lt;/em&gt;, &lt;em&gt;psycopg2&lt;/em&gt;, &lt;em&gt;python-decouple&lt;/em&gt; e &lt;em&gt;pytz&lt;/em&gt;. Esse arquivo √© extremamente importante pois o Heroku olha para ele a fim de instalar as depend√™ncias.&lt;/p&gt;
&lt;h6&gt;Crie um arquivo Procfile no diret√≥rio raiz&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;web: gunicorn &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;app&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;.wsgi --log-file -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;O Procfile (sim, o arquivo n√£o tem extens√£o) informa ao Heroku como executar a aplica√ß√£o. Atente que &lt;strong&gt;&lt;app&gt;&lt;/strong&gt; deve ser substitu√≠do pelo diret√≥rio que est√° o seu arquivo &lt;strong&gt;wsgi&lt;/strong&gt;. Voc√™ pode executar o comando localmente para certificar-se de que est√° correto.&lt;/p&gt;
&lt;h6&gt;Crie um arquivo runtime.txt no diret√≥rio raiz&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;python-3.6.1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;O arquivo vai dizer ao Heroku qual vers√£o do python nosso projeto usa.&lt;/p&gt;
&lt;h6&gt;Configure suas vari√°veis de ambiente de produ√ß√£o&lt;/h6&gt;
&lt;p&gt;Lembra que nosso &lt;strong&gt;settings.py&lt;/strong&gt; carrega os dados do arquivo &lt;strong&gt;.env&lt;/strong&gt;? Bem, &lt;strong&gt;python-decouple&lt;/strong&gt; respeita a preced√™ncia das vari√°veis de ambiente em rela√ß√£o aos arquivos de configura√ß√£o. Portanto, se existir alguma vari√°vel de ambiente em produ√ß√£o a diretiva &lt;em&gt;config&lt;/em&gt; n√£o ir√° olhar para o arquivo .env.&lt;/p&gt;
&lt;p&gt;Para cada chave no arquivo &lt;em&gt;.env&lt;/em&gt; n√≥s iremos usar o &lt;em&gt;Heroku CLI&lt;/em&gt; para configurar a vari√°vel de ambiente em produ√ß√£o. N√≥s precisamos configurar quatro vari√°veis: &lt;strong&gt;SECRET_KEY&lt;/strong&gt;, &lt;strong&gt;DEBUG&lt;/strong&gt;, &lt;strong&gt;ALLOWED_HOSTS&lt;/strong&gt; e &lt;strong&gt;DATABASE_URL&lt;/strong&gt;. Abra o terminar e execute:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;SECRET_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR_SECRE_KEY&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;DEBUG&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;False -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;ALLOWED_HOSTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1,localhost,.herokuapp.com -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;DATABASE_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR_DATABASE_URL&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Notas:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SECRET_KEY √© cercado por aspas simples pois precisamos explicitamente defin√≠-la como uma string para o Heroku;&lt;/li&gt;
&lt;li&gt;Substitua &amp;#x3C;YOUR_APP&gt; pelo nome da sua aplica√ß√£o;&lt;/li&gt;
&lt;li&gt;A string &lt;em&gt;.herokuapp.com&lt;/em&gt; deve estar dentro de &lt;em&gt;ALLOWED&lt;/em&gt;HOSTS_, caso contr√°rio o Django n√£o ser√° executado no Heroku.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Como encontrar DATABASE_URL?&lt;/strong&gt; Acesse o dashboard &gt; Resources &gt; Heroku Postgres Database. Uma nova aba ir√° abrir e permitir√° voc√™ verificar &lt;em&gt;DATABASE CREDENTIALS&lt;/em&gt;.&lt;/p&gt;
&lt;h6&gt;Disponibilize seu app&lt;/h6&gt;
&lt;p&gt;O dashboard do Heroku ir√° conter instru√ß√µes de como disponibilizar seu app. De qualquer maneira, com o git voc√™ pode faz√™-lo facilmente:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku git:remote -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP_NAME&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; push heroku master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Solu√ß√£o de Problemas&lt;/h2&gt;
&lt;p&gt;Se voc√™ encontrar quaisquer problemas, apenas cheque o terminal pois o Heroku apresenta mensagens expressivas que podem te ajudar. Por exemplo, durante o deploy eu fui apresentado √† seguinte mensagem:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;remote:        django.core.exceptions.ImproperlyConfigured: You&amp;#39;re using the staticfiles app without having set the STATIC_ROOT setting to a filesystem path.
remote:
remote:  !     Error while running &amp;#39;$ python manage.py collectstatic --noinput&amp;#39;.
remote:        See traceback above for details.
remote:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ao chec√°-la percebi que havia esquecido de configurar a vari√°vel &lt;em&gt;STATIC ROOT&lt;/em&gt; no arquivo &lt;em&gt;\&lt;/em&gt;settings.py_ e instalar o middleware WSGI para servir os arquivos est√°ticos.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Django n√£o foi pensado para servir arquivos est√°ticos. Use a Amazon S3 (ou equivalente) em projetos ‚Äúreais‚Äù.&lt;/p&gt;
&lt;p&gt;Isso √© tudo, pessoal!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Prepare your Django app to be deployed at Heroku]]></title><description><![CDATA[It is really exciting to build our own projects and see it working on production environment, right? Some developers might think deploying a‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-08-15-Prepare_your_Django_app_to_be_deployed_at_Heroku/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-08-15-Prepare_your_Django_app_to_be_deployed_at_Heroku/</guid><pubDate>Tue, 15 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;It is really exciting to build our own projects and see it working on production environment, right? Some developers might think deploying a Django app to a server is a nightmare. In this post I will show how to prepare your application to have different configurations and deploy it to Heroku.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Requirements:&lt;/strong&gt; You must install &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-cli&quot;&gt;Heroku CLI&lt;/a&gt; and &lt;strong&gt;GIT&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Heroku&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://www.heroku.com&quot;&gt;Heroku&lt;/a&gt; is the PaaS that will host our project. Go to the &lt;a href=&quot;https://dashboard.heroku.com/apps&quot;&gt;dashboard&lt;/a&gt; and create your new app.&lt;/p&gt;
&lt;p&gt;Once you have created you app, it is necessary to use the terminal to set up your credentials. We need the Heroku CLI to access the app settings (check the &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-cli&quot;&gt;docs&lt;/a&gt; to install it properly).&lt;/p&gt;
&lt;p&gt;After installing you can login:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku login
heroku addons:create heroku-postgresql:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-plan-name&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;your-application-name&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Later on we will use a PostgreSQL. Heroku helps us to provide a pg database by running the command. It is quite easy and you can learn about that in the &lt;a href=&quot;https://devcenter.heroku.com/articles/heroku-postgresql#provisioning-heroku-postgres&quot;&gt;docs&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Hint:&lt;/strong&gt; The command &lt;code class=&quot;language-text&quot;&gt;$ heroku apps&lt;/code&gt; is very handy and allows us to see the apps we have.&lt;/p&gt;
&lt;h2&gt;Preparing our application&lt;/h2&gt;
&lt;p&gt;When it comes to managing local and production environments I like to use &lt;a href=&quot;https://github.com/henriquebastos/python-decouple&quot;&gt;python decouple&lt;/a&gt; because it allows me to use env vars and, thus, to have different configurations. Plus, I use &lt;a href=&quot;https://github.com/kennethreitz/dj-database-url&quot;&gt;dj&lt;em&gt;database&lt;/em&gt;url&lt;/a&gt; to make it easy to use different databases with a single configuration string.&lt;/p&gt;
&lt;p&gt;1. At first, create two files: &lt;em&gt;.env&lt;/em&gt; and &lt;em&gt;.env-sample&lt;/em&gt;. The first will be used in our local environment and must be ignored by GIT. The second works as a template:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;SECRET_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;YOUR_KEY_GOES_HERE
&lt;span class=&quot;token assign-left variable&quot;&gt;DEBUG&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;True
&lt;span class=&quot;token assign-left variable&quot;&gt;ALLOWED_HOSTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1,localhost,.herokuapp.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2. Open your &lt;em&gt;settings.py&lt;/em&gt;, import the modules we will use and use the configuration bellow:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; decouple &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Csv
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; dj_database_url &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; parse &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; dburl

SECRET_KEY &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;SECRET_KEY&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
DEBUG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DEBUG&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cast&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

ALLOWED_HOSTS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ALLOWED_HOSTS&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cast&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Csv&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

DEFAULT_DBURL &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;sqlite:///&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;BASE_DIR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;db.sqlite3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
DATABASES &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&apos;default&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DATABASE_URL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;DEFAULT_DBURL&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cast&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;dburl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first two lines import the module while the other just load the values using python-decouple lib. The &lt;code class=&quot;language-text&quot;&gt;cast&lt;/code&gt; parameter is mandatory because env vars are strings and it is important to cast the value to the proper data type.&lt;/p&gt;
&lt;p&gt;Pay attention to the &lt;code class=&quot;language-text&quot;&gt;DEFAULT_DBURL&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;DATABASES&lt;/code&gt; variables. The first uses an Sqlite in the local environment but in Heroku we will configure it to store the Postgres configuration url.&lt;/p&gt;
&lt;h2&gt;Deploying to Heroku&lt;/h2&gt;
&lt;p&gt;We have created our app in Heroku, attached a Postgres database and configured the settings to accept different configuration strings. Now it is time to deploy our application!&lt;/p&gt;
&lt;h6&gt;Make sure your requirements.txt file contains all dependencies&lt;/h6&gt;
&lt;p&gt;It must have, at least: &lt;em&gt;dj-database-url&lt;/em&gt;, &lt;em&gt;gunicorn&lt;/em&gt;, &lt;em&gt;psycopg2&lt;/em&gt;, &lt;em&gt;python-decouple&lt;/em&gt; and &lt;em&gt;pytz&lt;/em&gt;. This file is extremely important because Heroku looks for the requirements file to install the dependencies.&lt;/p&gt;
&lt;h6&gt;Create a Procfile in the app root directory&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;web: gunicorn &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;app&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;.wsgi --log-file -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A Procfile (yes, without any extension) tells Heroku how to run your application. Pay attention that &lt;strong&gt;&lt;app&gt;&lt;/strong&gt; must be replaced by the directory your &lt;strong&gt;wsgi&lt;/strong&gt; file is placed. Run the command locally to make sure it is correct.&lt;/p&gt;
&lt;h6&gt;Create runtime.txt in the app root directory&lt;/h6&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;python-3.6.1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The file will tell to Heroku which version of python our project uses.&lt;/p&gt;
&lt;h6&gt;Configure your production env vars&lt;/h6&gt;
&lt;p&gt;Do you remember that our &lt;strong&gt;settings.py&lt;/strong&gt; looks for an &lt;strong&gt;.env&lt;/strong&gt; file? Well, &lt;strong&gt;python-decouple&lt;/strong&gt; respect the environment variables precedence over &lt;strong&gt;config files&lt;/strong&gt;. Thus, if there is an env var set in production the config directive will not look for an .env file.&lt;/p&gt;
&lt;p&gt;For each key in &lt;em&gt;.env&lt;/em&gt; file we will use the &lt;em&gt;Heroku CLI&lt;/em&gt; to set the env var in production. We need to setup four variables: &lt;strong&gt;SECRET_KEY&lt;/strong&gt;, &lt;strong&gt;DEBUG&lt;/strong&gt;, &lt;strong&gt;ALLOWED_HOSTS&lt;/strong&gt; and &lt;strong&gt;DATABASE_URL&lt;/strong&gt;. Open the terminal and execute:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;SECRET_KEY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR_SECRE_KEY&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;DEBUG&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;False -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;ALLOWED_HOSTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1,localhost,.herokuapp.com -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
heroku config:set &lt;span class=&quot;token assign-left variable&quot;&gt;DATABASE_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;YOUR_DATABASE_URL&gt;&apos;&lt;/span&gt; -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Notes:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;SECRET_KEY is surrounded by single quotes because we have to explicitly define it as a string to heroku;&lt;/li&gt;
&lt;li&gt;replace &amp;#x3C;YOUR_APP&gt; by your app name;&lt;/li&gt;
&lt;li&gt;the string &lt;em&gt;.herokuapp.com&lt;/em&gt; must be in ALLOWED_HOSTS otherwise Django will not be executed in Heroku.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;How to find the DATABASE_URL?&lt;/strong&gt; Go to your app dashboard &gt; Resources &gt; Heroku Postgres Database. A new tab will open and allow you to check your DATABASE CREDENTIALS.&lt;/p&gt;
&lt;h6&gt;Deploy your app&lt;/h6&gt;
&lt;p&gt;In your Heroku app dashboard will contain instructions to deploy it. By using git you can deploy it easily:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;heroku git:remote -a &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;YOUR_APP_NAME&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; push heroku master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Troubleshooting&lt;/h2&gt;
&lt;p&gt;If you face any problems just check the terminal because Heroku shows expressive messages that can help you. For example, during the deploy I got the message below:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;remote:        django.core.exceptions.ImproperlyConfigured: You&amp;#39;re using the staticfiles app without having set the STATIC_ROOT setting to a filesystem path.
remote:
remote:  !     Error while running &amp;#39;$ python manage.py collectstatic --noinput&amp;#39;.
remote:        See traceback above for details.
remote:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By checking that I realized I forgot to set the STATIC&lt;em&gt;ROOT variable in _settings.py&lt;/em&gt; and install a WSGI middleware to provide the static files.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Django is not meant to provide static files. Use AWS S3 to do that for production-ready projects.&lt;/p&gt;
&lt;p&gt;That‚Äôs all folks!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Integrando PyCharm com Pyenv]]></title><description><![CDATA[PyCharm √© minha IDE favorita e, sem d√∫vidas, uma ferramenta poderosa. Ela te d√° excelentes atalhos e um grupo de ferramentas que previnem o‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-08-04-Integrando_PyCharm_com_Pyenv/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-08-04-Integrando_PyCharm_com_Pyenv/</guid><pubDate>Fri, 04 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;PyCharm √© minha IDE favorita e, sem d√∫vidas, uma ferramenta poderosa. Ela te d√° excelentes atalhos e um grupo de ferramentas que previnem o programador de ter que ficar trocando de telas a todo momento. Uma delas √© um terminal embutido que evita que voc√™ fique trocando de contexto da IDE para o terminal do linux e vice-versa.&lt;/p&gt;
&lt;p&gt;Como voc√™ pode ver na imagem abaixo, o terminal dentro do PyCharm mostra o virtualenv atual que eu estou trabalhando.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABHUlEQVQoz5XS7UrDMBQG4N6Maz67NpO1XdtlSZO1kwkqIv7w/m/j9WRsojDG/PFwICHvySHJeuvw8v6BcT+h21q03YB8kf8oigJlaaCXBlyZP3u/LR4WEEIi2/o9Xj+/EOYj+l2kUA+pSwgidYV1vcG6G6GrBlItoWjtmnRmWT0ic3HGfHxDmJ7RuAlNeMLgDnBuRj14tMN40iS9v6nfBWTtpoMsNHrOYAQH0wpKKmglaQQOwc/EbZzlqIxBVlMgFwKKNHkOSVWcSSnvxqlptaKR0yOkBUE0KVLYP4Iu0i1NChysRU434zQyoy6MsVM3fql3SNMwyigrGnk+HDDGPXyIJCBOE6zzsDuHnr5RN2xP9Zq0l9RtBxs8fIz4BgBT/bsjgzbpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Terminal do PyCharm com virtualenv&quot;
        title=&quot;Terminal do PyCharm com virtualenv&quot;
        data-src=&quot;/static/153a8f5294fb8799158eb303ef9b9a08/d9199/terminal.png&quot;
        data-srcset=&quot;/static/153a8f5294fb8799158eb303ef9b9a08/8ff5a/terminal.png 240w,
/static/153a8f5294fb8799158eb303ef9b9a08/e85cb/terminal.png 480w,
/static/153a8f5294fb8799158eb303ef9b9a08/d9199/terminal.png 960w,
/static/153a8f5294fb8799158eb303ef9b9a08/3f20e/terminal.png 1275w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Entretando, voc√™ pode acabar lidando com alguns erros no primeiro uso caso o seu ambiente local n√£o esteja devidamente configurado. Como eu uso &lt;a href=&quot;https://github.com/pyenv/pyenv&quot;&gt;Pyenv&lt;/a&gt; para gerenciar tanto minhas vers√µes do Python como minhas &lt;em&gt;virtualenvs&lt;/em&gt;, eu tive que configurar o ambiente para ter o terminal integrado com o PyCharm. √â bem f√°cil:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACl0lEQVQozzWS6VITQRSF51UsLUMSQAJZZ98yk2WyEWAmIQkCJcqmpahlWRaKQvkeFpAEVHzD4+kJ/DjVM933fvfc2y39OL/A+cVPXF5eYjKZYjy9wZ+7v7i7+4fx7RTT37eY3Nzg6nrM8wnGjJlMuc/1mrpi/K+ra3w9+47Tb2eQbK8C168iGmxja/cVBtt7CDefoz8YoTcUGqI3GCLaHGAj6iHs9bHR20S4HiJqd7DTbGGj1cajx0+Qml+E5BAYdNqoNToEB5A1F4bh4uXBPt6cvMPh0TEOqKPj1zj59BmjnRdQdRO65cAwbVj81lQdibkkVnIFSIrtwwlWEYSH6IzewuvuQ/d7CFh1LYzQH27Fa3O1i343RMWrQ3PKqNQb0G0Wdz2oBCeeJrC8koOk8SfohHDCj9gafUFzcAqlvoeirEBmdb/WQHt1LU5yuFdnkm/ZcCu1eM8gXDUsJBJzWFhgy6JKwIRas4PIr6FRb8GwyyixDVkzYHs++qMRypxzSbfi/QoBrWodlnBICeAcW158tgTJsG14VVazAwYEUK2AiR5hM2C54mM9CmGL1ui4pGg8N2FyhiYdCpiIy+YLkFUNkqyoWMpkCKpCdxuxFEMAmaxZcOmk2V2HootkZ+acUgSI4AdgOp1GrlCElC/JSKZSnAeBThBLAIveEKXgCH70Hs3hB5Rq+5AbxyhYLQJVgmbuHoDJZBLZXB6SGH56fv4e2IilGD6KtB+3x7XAGMtxoVg+crIBhQCF7gRINczYcYqmRNuSpuvxQFWTM2KCavoEujwsIpPNx1q+VyabQ64oxyDxDk1RxOQYdJe3nOA7pEPXE8M2YIob43MQTjRW1U0rri6ksa1Y5mx9eNgiVrRcUk06VuPz/5YPxClvh3DhAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Passos para configurar pyenv e PyCharm&quot;
        title=&quot;Passos para configurar pyenv e PyCharm&quot;
        data-src=&quot;/static/60ad0994acb2e20bcf9444786fe52d72/d9199/setup-pyenv.png&quot;
        data-srcset=&quot;/static/60ad0994acb2e20bcf9444786fe52d72/8ff5a/setup-pyenv.png 240w,
/static/60ad0994acb2e20bcf9444786fe52d72/e85cb/setup-pyenv.png 480w,
/static/60ad0994acb2e20bcf9444786fe52d72/d9199/setup-pyenv.png 960w,
/static/60ad0994acb2e20bcf9444786fe52d72/9cea8/setup-pyenv.png 1278w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;V√° em &lt;code class=&quot;language-text&quot;&gt;Preferences&lt;/code&gt; &gt; &lt;code class=&quot;language-text&quot;&gt;Project Interpreter&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Clique na engrenagem e selecione &lt;strong&gt;Add local&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Aponte para o arquivo python que fica dentro do seu virtualenv. Como eu esotu usando pyenv, o caminho √© &lt;code class=&quot;language-text&quot;&gt;~/.pyenv/versions/&amp;lt;virtualenv-name&amp;gt;/bin/python3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Pode ser que voc√™ precise reiniciar o PyCharm.&lt;/li&gt;
&lt;/ol&gt;
&lt;h5&gt;Voc√™ n√£o usa o Pyenv?&lt;/h5&gt;
&lt;p&gt;&lt;del&gt;Basta instalar e seguir o tutorial&lt;/del&gt;. Voc√™ s√≥ precisa substituir o caminho pelo caminho do seu virtualenv. =)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Integrating PyCharm with Pyenv]]></title><description><![CDATA[PyCharm is my favorite IDE and undoubtedly a powerful tool. It gives you great shortcuts and a set of tools that prevent the programmer from‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-08-04-Integrating_PyCharm_with_Pyenv/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-08-04-Integrating_PyCharm_with_Pyenv/</guid><pubDate>Fri, 04 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;PyCharm is my favorite IDE and undoubtedly a powerful tool. It gives you great shortcuts and a set of tools that prevent the programmer from dealing with many windows. One of them is the built-in terminal that increase our productivity once it is not necessary to shift from the IDE to the terminal and vice versa.&lt;/p&gt;
&lt;p&gt;As you can see in the image below the terminal inside PyCharm shows the current virtualenv I am working with.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABHUlEQVQoz5XS7UrDMBQG4N6Maz67NpO1XdtlSZO1kwkqIv7w/m/j9WRsojDG/PFwICHvySHJeuvw8v6BcT+h21q03YB8kf8oigJlaaCXBlyZP3u/LR4WEEIi2/o9Xj+/EOYj+l2kUA+pSwgidYV1vcG6G6GrBlItoWjtmnRmWT0ic3HGfHxDmJ7RuAlNeMLgDnBuRj14tMN40iS9v6nfBWTtpoMsNHrOYAQH0wpKKmglaQQOwc/EbZzlqIxBVlMgFwKKNHkOSVWcSSnvxqlptaKR0yOkBUE0KVLYP4Iu0i1NChysRU434zQyoy6MsVM3fql3SNMwyigrGnk+HDDGPXyIJCBOE6zzsDuHnr5RN2xP9Zq0l9RtBxs8fIz4BgBT/bsjgzbpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;PyCharm Terminal with virtualenv&quot;
        title=&quot;PyCharm Terminal with virtualenv&quot;
        data-src=&quot;/static/153a8f5294fb8799158eb303ef9b9a08/d9199/terminal.png&quot;
        data-srcset=&quot;/static/153a8f5294fb8799158eb303ef9b9a08/8ff5a/terminal.png 240w,
/static/153a8f5294fb8799158eb303ef9b9a08/e85cb/terminal.png 480w,
/static/153a8f5294fb8799158eb303ef9b9a08/d9199/terminal.png 960w,
/static/153a8f5294fb8799158eb303ef9b9a08/3f20e/terminal.png 1275w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;However, you might get some errors at first if your local environment is not set up properly. Once I use &lt;a href=&quot;https://github.com/pyenv/pyenv&quot;&gt;Pyenv&lt;/a&gt; to manage my python versions and &lt;em&gt;virtualenvs&lt;/em&gt; I had to set up the environment in order to have the terminal integrated with PyCharm. It is quite easy:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.83333333333334%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACl0lEQVQozzWS6VITQRSF51UsLUMSQAJZZ98yk2WyEWAmIQkCJcqmpahlWRaKQvkeFpAEVHzD4+kJ/DjVM933fvfc2y39OL/A+cVPXF5eYjKZYjy9wZ+7v7i7+4fx7RTT37eY3Nzg6nrM8wnGjJlMuc/1mrpi/K+ra3w9+47Tb2eQbK8C168iGmxja/cVBtt7CDefoz8YoTcUGqI3GCLaHGAj6iHs9bHR20S4HiJqd7DTbGGj1cajx0+Qml+E5BAYdNqoNToEB5A1F4bh4uXBPt6cvMPh0TEOqKPj1zj59BmjnRdQdRO65cAwbVj81lQdibkkVnIFSIrtwwlWEYSH6IzewuvuQ/d7CFh1LYzQH27Fa3O1i343RMWrQ3PKqNQb0G0Wdz2oBCeeJrC8koOk8SfohHDCj9gafUFzcAqlvoeirEBmdb/WQHt1LU5yuFdnkm/ZcCu1eM8gXDUsJBJzWFhgy6JKwIRas4PIr6FRb8GwyyixDVkzYHs++qMRypxzSbfi/QoBrWodlnBICeAcW158tgTJsG14VVazAwYEUK2AiR5hM2C54mM9CmGL1ui4pGg8N2FyhiYdCpiIy+YLkFUNkqyoWMpkCKpCdxuxFEMAmaxZcOmk2V2HootkZ+acUgSI4AdgOp1GrlCElC/JSKZSnAeBThBLAIveEKXgCH70Hs3hB5Rq+5AbxyhYLQJVgmbuHoDJZBLZXB6SGH56fv4e2IilGD6KtB+3x7XAGMtxoVg+crIBhQCF7gRINczYcYqmRNuSpuvxQFWTM2KCavoEujwsIpPNx1q+VyabQ64oxyDxDk1RxOQYdJe3nOA7pEPXE8M2YIob43MQTjRW1U0rri6ksa1Y5mx9eNgiVrRcUk06VuPz/5YPxClvh3DhAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image lazyload&quot;
        alt=&quot;Steps to setup pyenv and PyCharm&quot;
        title=&quot;Steps to setup pyenv and PyCharm&quot;
        data-src=&quot;/static/60ad0994acb2e20bcf9444786fe52d72/d9199/setup-pyenv.png&quot;
        data-srcset=&quot;/static/60ad0994acb2e20bcf9444786fe52d72/8ff5a/setup-pyenv.png 240w,
/static/60ad0994acb2e20bcf9444786fe52d72/e85cb/setup-pyenv.png 480w,
/static/60ad0994acb2e20bcf9444786fe52d72/d9199/setup-pyenv.png 960w,
/static/60ad0994acb2e20bcf9444786fe52d72/9cea8/setup-pyenv.png 1278w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Go to Preferences &gt; Project Interpreter&lt;/li&gt;
&lt;li&gt;Click on the gear and select &lt;strong&gt;Add local&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Point to the python file inside your virtualenv. Once I am using pyenv, the path is &lt;code class=&quot;language-text&quot;&gt;~/.pyenv/versions/&amp;lt;virtualenv-name&amp;gt;/bin/python3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;You might need to restart your PyCharm.&lt;/li&gt;
&lt;/ol&gt;
&lt;h5&gt;Don‚Äôt you use Pyenv?&lt;/h5&gt;
&lt;p&gt;&lt;del&gt;Install it and follow the tutorial&lt;/del&gt;. You just need to replace the path by your virtualenv path.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Git hooks, issue tracker e Git Flow]]></title><description><![CDATA[Na Agilize o fluxo comum de trabalho do desenvolvedor envolve o uso do Jira para gerenciamento das tarefas, Git & Git Flow para‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-05-07-Git_hooks_issue_tracker_e_Git_Flow/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-05-07-Git_hooks_issue_tracker_e_Git_Flow/</guid><pubDate>Sun, 07 May 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Na &lt;a href=&quot;https://www.agilize.com.br/&quot;&gt;Agilize&lt;/a&gt; o fluxo comum de trabalho do desenvolvedor envolve o uso do Jira para gerenciamento das tarefas, Git &amp;#x26; Git Flow para versionamento de c√≥digo, Slack para comunica√ß√£o e ferramentas como IDE, Editor de Texto e Terminal. Basicamente, a sprint √© mantida no Jira com cards que descrevem as funcionalidades, bugs, spikes e chores seguindo algumas conven√ß√µes do SCRUM e, ent√£o, o programador atribui um card para si.&lt;/p&gt;
&lt;p&gt;Durante o fluxo de desenvolvimento existe uma conven√ß√£o de que &lt;strong&gt;commits devem ter o c√≥digo do card que o programador est√° trabalhando&lt;/strong&gt;. Ap√≥s alguns commits a conven√ß√£o se torna chata de manter (pois voc√™ tem que digitar o c√≥digo do card a todo momento). Existe uma forma de automatizar isso com Git Hooks.&lt;/p&gt;
&lt;h2&gt;Git Hooks&lt;/h2&gt;
&lt;p&gt;Git permite executir um script toda vez que um evento acontecer no reposit√≥rio. Por exemplo, √© poss√≠vel configurar o editor de texto com uma mensagem de template que deve ser preenchida. Este &lt;a href=&quot;https://www.atlassian.com/git/tutorials/git-hooks&quot;&gt;tutorial&lt;/a&gt; explica o poder do Git Hooks e disponibiliza um trecho de c√≥digo que ser√° customizado neste post para endere√ßar nossas necessidades.&lt;/p&gt;
&lt;p&gt;Dentro do nosso reposit√≥rio existe um diret√≥rio &lt;em&gt;.git/hooks&lt;/em&gt; que cont√©m alguns scripts de exemplo que podem ser usados como playground. Eles terminam com &lt;em&gt;.sample&lt;/em&gt; para n√£o serem interpretados pelo Git.&lt;/p&gt;
&lt;p&gt;Crie um arquivo chamado &lt;em&gt;prepare-commit-msg&lt;/em&gt; que vai conter o c√≥digo abaixo para automatizar a mensagem de commit.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/usr/bin/env python3&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; sys, os, re
from subprocess &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; check_output

&lt;span class=&quot;token comment&quot;&gt;# Setup&lt;/span&gt;
branch_regex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; r&lt;span class=&quot;token string&quot;&gt;&apos;.+/(AGZ-\d+).*&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Collect the parameters&lt;/span&gt;
commit_msg_filepath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sys.argv&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Figure out which branch we&apos;re on&lt;/span&gt;
branch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; check_output&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;git&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;symbolic-ref&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;--short&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;HEAD&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;.strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Populate the commit message with the issue #, if there is one&lt;/span&gt;
issue_match &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; re.match&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;branch_regex, branch.decode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;utf-8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;, re.M&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;re.I&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; issue_match:
    issue_code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; issue_match.group&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    with open&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;commit_msg_filepath, &lt;span class=&quot;token string&quot;&gt;&apos;r+&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; as f:
        content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; f.read&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        f.seek&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        f.write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s %s&quot;&lt;/span&gt; % &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;issue_code, content&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Depois de executar &lt;em&gt;git commit&lt;/em&gt; o arquivo acima ser√° executado para popular a mensagem de commit e, ent√£o, permitir-nos adotar o template nos nossos commits. O script √© chamado com tr√™s argumentos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Nome do arquivo&lt;/li&gt;
&lt;li&gt;O nome de um arquivo tempor√°rio que vai conter a mensagem&lt;/li&gt;
&lt;li&gt;O tipo do commit&lt;/li&gt;
&lt;li&gt;O hash SHA1 do commit&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Na Agilize o c√≥digo do card segue a regex na linha 6. Como usamos o &lt;a href=&quot;http://nvie.com/posts/a-successful-git-branching-model/&quot;&gt;gitflow&lt;/a&gt; para gerenciar as branches, elas sempre seguir√£o alguns padr√µes como &lt;em&gt;feature/AGZ-1256&lt;/em&gt;, &lt;em&gt;hotfix/AGZ-981&lt;/em&gt;, &lt;em&gt;release/AGZ-453&lt;/em&gt;. Portanto, commits n√£o s√£o criados nas branch master ou dev. Devido a isso, a vari√°vel na linha 6 define a regex que ir√° usar o nome da branch para criar nossa mensagem de commit. Se voc√™ quiser aplicar isso para a sua empresa basta atualizar a regex (veja a linha 17).&lt;/p&gt;
&lt;p&gt;As linhas 15 e 16 checam se a branch atual n√£o √© master / dev e cont√©m o c√≥digo do card. As linhas finais apenas criam a mensagem com o c√≥digo.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Obs:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Ao fazer commit o cursor geralmente come√ßa no in√≠cio da linha mas voc√™ pode fazer com que o cursor comece imediatamente depois da mensagem de template. Apenas adicione o trecho de c√≥digo abaixo ao seu arquivo &lt;em&gt;.bashrc&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GIT_EDITOR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;vim -c&apos;startinsert|norm! ggA&apos;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Refer√™ncias&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.atlassian.com/git/tutorials/git-hooks&quot;&gt;Git hooks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/41232722/open-git-commit-editor-to-specific-cursor-location&quot;&gt;Open git commit editor to specific cursor location&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Git hooks, issue tracker and Git Flow]]></title><description><![CDATA[At Agilize a common developer workflow involves the usage of Jira for issue tracking, Git + Git Flow for versioning code, Slack for‚Ä¶]]></description><link>https://vcrmartinez.com/2017/2017-05-07-Git_hooks_issue_tracker_and_Git_Flow/</link><guid isPermaLink="false">https://vcrmartinez.com/2017/2017-05-07-Git_hooks_issue_tracker_and_Git_Flow/</guid><pubDate>Sun, 07 May 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;At &lt;a href=&quot;https://www.agilize.com.br/&quot;&gt;Agilize&lt;/a&gt; a common developer workflow involves the usage of Jira for issue tracking, Git + Git Flow for versioning code, Slack for communication and programmer‚Äôs tools like IDE, Text Editor and Terminal. Basically, a prioritized sprint is maintained in Jira full of cards that describe the features, bugs, spikes and chores following some conventions of SCRUM and the software engineer assign himself to a card. During the development there is a convention that &lt;strong&gt;commits must have the issue code the engineer is working on&lt;/strong&gt;. After some commits the convention gets boring (you have to type the issue code all time). Hopefully there is a way to automate that.&lt;/p&gt;
&lt;h2&gt;Git Hooks&lt;/h2&gt;
&lt;p&gt;Git allows us to run a script every time a particular event occurs in the repository. For instance, it is possible to setup the text editor with a template message. This &lt;a href=&quot;https://www.atlassian.com/git/tutorials/git-hooks&quot;&gt;tutorial&lt;/a&gt; explains the power of git hooks and provides a snippet that will be customized in this post to address our necessities.&lt;/p&gt;
&lt;p&gt;Inside your repository there is a folder &lt;em&gt;.git/hooks&lt;/em&gt; that contains some sample scripts that can be used as a playground and they end with &lt;em&gt;.sample&lt;/em&gt; in order to not be interpreted by Git. Create a file named &lt;em&gt;prepare-commit-msg&lt;/em&gt; that will contain the code below to automate the commit message.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/usr/bin/env python3&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; sys, os, re
from subprocess &lt;span class=&quot;token function&quot;&gt;import&lt;/span&gt; check_output

&lt;span class=&quot;token comment&quot;&gt;# Setup&lt;/span&gt;
branch_regex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; r&lt;span class=&quot;token string&quot;&gt;&apos;.+/(AGZ-\d+).*&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Collect the parameters&lt;/span&gt;
commit_msg_filepath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sys.argv&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Figure out which branch we&apos;re on&lt;/span&gt;
branch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; check_output&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;git&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;symbolic-ref&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;--short&apos;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&apos;HEAD&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;.strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Populate the commit message with the issue #, if there is one&lt;/span&gt;
issue_match &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; re.match&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;branch_regex, branch.decode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;utf-8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;, re.M&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;re.I&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; issue_match:
    issue_code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; issue_match.group&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    with open&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;commit_msg_filepath, &lt;span class=&quot;token string&quot;&gt;&apos;r+&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; as f:
        content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; f.read&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        f.seek&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        f.write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s %s&quot;&lt;/span&gt; % &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;issue_code, content&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After typing &lt;em&gt;git commit&lt;/em&gt; the file above is called to populate the commit message and, thus, enables us to adopt a template in our commits. The script is called with three arguments:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;File name&lt;/li&gt;
&lt;li&gt;The name of a temporary file that contains the message&lt;/li&gt;
&lt;li&gt;The type of commit&lt;/li&gt;
&lt;li&gt;The commit SHA1 hash&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;At Agilize the issue code follows the regex in the line 6. Once we use &lt;a href=&quot;http://nvie.com/posts/a-successful-git-branching-model/&quot;&gt;gitflow&lt;/a&gt; to manage our branches they will always follow some examples like &lt;em&gt;feature/AGZ-1256&lt;/em&gt;, &lt;em&gt;hotfix/AGZ-981&lt;/em&gt;, &lt;em&gt;release/AGZ-453&lt;/em&gt;. Therefore, commits are not created in the master or dev branches. Due to that, the variable in the line 6 defines a regex that will use the branch name to create our commit message. If you want to apply that to your company it just takes to update the regex (pay attention to the regex group in line 17).&lt;/p&gt;
&lt;p&gt;The lines 15 and 16 check if the current branch is not master/dev and contains the issue code. The final lines just create the message with the code.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Obs:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You can make the cursor start right after the template message. Just add the snippet below to your &lt;em&gt;.bashrc&lt;/em&gt; file.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;GIT_EDITOR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;vim -c&apos;startinsert|norm! ggA&apos;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;References&lt;/h4&gt;
&lt;p&gt;Want more resources? Check out the links below:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.atlassian.com/git/tutorials/git-hooks&quot;&gt;https://www.atlassian.com/git/tutorials/git-hooks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/41232722/open-git-commit-editor-to-specific-cursor-location&quot;&gt;http://stackoverflow.com/questions/41232722/open-git-commit-editor-to-specific-cursor-location&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Maintaining 200+ spiders and still having time to sleep]]></title><link>https://vcrmartinez.com/2016/2016-11-25-Maintaining-200-spiders-and-still-having-time-to-sleep/Maintaining-200-spiders-and-still-having-time-to-sleep/</link><guid isPermaLink="false">https://vcrmartinez.com/2016/2016-11-25-Maintaining-200-spiders-and-still-having-time-to-sleep/Maintaining-200-spiders-and-still-having-time-to-sleep/</guid><pubDate>Fri, 25 Nov 2016 03:00:00 GMT</pubDate><content:encoded></content:encoded></item><item><title><![CDATA[Crawling the web like a boss]]></title><link>https://vcrmartinez.com/2016/2016-10-15-Crawling-the-web-like-a-boss/2016-10-15-Crawling-the-web-like-a-boss/</link><guid isPermaLink="false">https://vcrmartinez.com/2016/2016-10-15-Crawling-the-web-like-a-boss/2016-10-15-Crawling-the-web-like-a-boss/</guid><pubDate>Sat, 15 Oct 2016 03:00:00 GMT</pubDate><content:encoded></content:encoded></item></channel></rss>