{"componentChunkName":"component---src-templates-blog-post-js","path":"/pt/blog/2020/2020-04-23-Nginx_com_certbot_direto_ao_ponto/","result":{"data":{"site":{"siteMetadata":{"title":null,"siteUrl":"https://vcrmartinez.com","social":{"twitter":"vcrmartinez","github":"victormartinez","linkedin":"vcrmartinez","speakerdeck":"victormartinez"}}},"markdownRemark":{"id":"b855379b-e060-570e-ba12-6cf22104c732","excerpt":"Trabalhar em uma equipe sem experiência em DevOps obriga você a gerenciar para fazer as coisas em relação à infraestrutura. Tivemos que instalar e configurar…","html":"<p>Trabalhar em uma equipe sem experiência em DevOps obriga você a gerenciar para fazer as coisas em relação à infraestrutura. Tivemos que instalar e configurar uma instância do <a href=\"https://www.rabbitmq.com/\">RabbitMQ</a> atrás de um <a href=\"https://www.nginx.com/\">Nginx</a> com HTTPS. Esta é uma postagem direta sobre como instalar e configurar o proxy reverso com <a href=\"https://letsencrypt.org\">Let’s Encrypt</a>.</p>\n<h2>Nginx</h2>\n<p>Neste tutorial, o Nginx funciona como um proxy reverso, encaminhando solicitações externas da Internet para o serviço interno. Vamos começar.</p>\n<p><strong>1. Crie um registro <code class=\"language-text\">A</code> em seu provedor de DNS:</strong></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Type</th>\n<th align=\"center\">Name</th>\n<th>Content</th>\n<th>TTL</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">A</td>\n<td align=\"center\">yourwebsite</td>\n<td>123.456.78.91</td>\n<td>Auto</td>\n</tr>\n</tbody>\n</table>\n<p><strong>2. Instale o Nginx e habilite-o:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> nginx-full\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> nginx</code></pre></div>\n<p>Gerencie a sua instância do nginx com os comandos abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart nginx\n<span class=\"token function\">sudo</span> systemctl reload nginx\n<span class=\"token function\">sudo</span> systemctl status nginx</code></pre></div>\n<p><strong>3. Crie um arquivo de configuração no diretório</strong> <code class=\"language-text\">/etc/nginx/sites-available/</code><strong>. Um bom padrão é nomeá-lo de acordo com o DNS do seu serviço:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/etc/nginx/sites-available/yourwebsite.com</code></pre></div>\n<p><strong>4. Substitua o conteúdo abaixo de acordo com suas necessidades:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n  server_name &lt;YOUR-DNS&gt;;\n  access_log /var/log/nginx/access.log;\n  error_log /var/log/nginx/error.log;\n  location / {\n          client_body_buffer_size 128k;\n          proxy_send_timeout   90;\n          proxy_read_timeout   90;\n          proxy_buffer_size    4k;\n          proxy_buffers     16 32k;\n          proxy_busy_buffers_size 64k;\n          proxy_temp_file_write_size 64k;\n          proxy_connect_timeout 30s;\n          proxy_pass   http://&lt;YOUR-LOCAL&gt;:&lt;PORT&gt;;\n          proxy_set_header   Host   $host;\n          proxy_set_header   X-Real-IP  $remote_addr;\n          proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n}</code></pre></div>\n<p><strong>5. Crie um link simbólico para o diretório sites-enabled:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /etc/nginx/sites-available/<span class=\"token operator\">&lt;</span>your-filename<span class=\"token operator\">></span> /etc/nginx/sites-enabled/<span class=\"token operator\">&lt;</span>your-filename<span class=\"token operator\">></span></code></pre></div>\n<p><strong>6. Carregue a configuração e cheque o status:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl reload nginx\n<span class=\"token function\">sudo</span> systemctl status nginx</code></pre></div>\n<p>A saída abaixo ilustra que nosso Nginx está funcionando corretamente (dados sensíveis foram omitidos).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> nginx.service - A high performance web server and a reverse proxy server\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\n   Active: active (running) since Tue 2019-08-13 18:18:09 UTC; 3 months 7 days ago\n     Docs: man:nginx(8)\n Main PID: 6027 (nginx)\n    Tasks: 5 (limit: 4915)\n   CGroup: /system.slice/nginx.service\n           ├─5198 nginx: worker process\n           ├─5199 nginx: worker process\n           ├─5200 nginx: worker process\n           ├─5201 nginx: worker process\n           └─6027 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;\n\nAug 13 18:18:09 systemd[1]: Starting A high performance web server and a reverse proxy server...\nAug 13 18:18:09 systemd[1]: Started A high performance web server and a reverse proxy server.\nAug 13 18:53:04 systemd[1]: Reloading A high performance web server and a reverse proxy server.\nAug 13 18:53:04 systemd[1]: Reloaded A high performance web server and a reverse proxy server.\nAug 13 18:58:21 systemd[1]: Reloading A high performance web server and a reverse proxy server.\nAug 13 18:58:21 systemd[1]: Reloaded A high performance web server and a reverse proxy server.</code></pre></div>\n<h2>Certbot</h2>\n<p>Para permitir HTTPs no seu website você precisa ter um certificado de um Autoridade Certificadora (CA - Certificate Authority). Nós podemos usar o Let’s Encrypt e o cliente do Certbot para configurar o ambiente.</p>\n<p><strong>1. Instale o Certbot com o plugin do Nginx:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> python-certbot-nginx</code></pre></div>\n<p><strong>2. Execute o certbot passando seu domínio como parâmetro:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> certbot --nginx -d <span class=\"token operator\">&lt;</span>YOUR-DOMAIN<span class=\"token operator\">></span></code></pre></div>\n<p><strong>3. Garanta que a renovação automática está configurada no cronjob do Linux:</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> /etc/cron.d/certbot</code></pre></div>\n<p>Voilà!</p>\n<h2>Links</h2>\n<p>Você pode achar útil os links abaixo:</p>\n<ul>\n<li><a href=\"https://tecadmin.net/auto-renew-lets-encrypt-certificates/\">Certbot.org</a></li>\n<li><a href=\"https://tecadmin.net/auto-renew-lets-encrypt-certificates/\">Techmonger: Certbot Auto Renew/</a></li>\n<li><a href=\"https://tecadmin.net/auto-renew-lets-encrypt-certificates/\">Tecadmin: Auto renew lets encrypt certificates</a></li>\n</ul>","frontmatter":{"title":"Nginx + Certbox: direto ao ponto","date":"2020-04-23T00:00:00","description":null,"tags":["nginx","certbot","https","reverse proxy"],"rating":null,"image_url":null,"image_author":null},"fields":{"slug":"/2020/2020-04-23-Nginx_com_certbot_direto_ao_ponto/"},"timeToRead":3}},"pageContext":{"id":"b855379b-e060-570e-ba12-6cf22104c732","language":"pt","intl":{"language":"pt","languages":["en","pt"],"messages":{"of":"de","or":"ou","Next":"Próximo","Previous":"Anterior","reading":"leitura","Comments":"Comentários","Featured_image_credits":"Créditos da imagem de destaque","Not_Found":"Não Encontrado","Not_Found_Text":"A página que você está procurando pode ter sido removida, ter seu nome alterado ou estar temporariamente indisponível.","Not_Found_Nav":"Você pode ir para","Warning_deprecated":"Atenção: esse post foi escrito a algum tempo e pode não ser mais válido, ok?"},"routed":true,"originalPath":"/blog/2020/2020-04-23-Nginx_com_certbot_direto_ao_ponto/","redirect":true,"defaultLanguage":"en"}}},"staticQueryHashes":["2841359383"]}